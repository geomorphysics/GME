<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ray_profiles.py &#8212; GME 1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/pydoctheme.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script src="../../_static/sidebar.js"></script>
    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="ray_velocities.py" href="ray_velocities.html" />
    <link rel="prev" title="ray_geodesics.py" href="ray_geodesics.html" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <link rel="shortcut icon" type="image/png" href="../../_static/favicon.png" />
    <meta name="viewport" content="width=device-width,initial-scale=0.8">
    
    

  </head><body>
    <!-- <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="responsive-menu"><a href="#sidebar-anchor" title="Navigation">&#9776;</a></li>
        <li><a href="../../index.html">GME 1.0 documentation</a> &#187;</li>
          <li><a href="../Python.html" >Python package <cite>gme</cite></a> &#187;</li>
          <li><a href="index.html" accesskey="U"><cite>gme</cite> sub-package <cite>plot</cite></a> &#187;</li> 
      </ul>
    </div> -->
    <!-- 
        <div class="badge">
            <a href="https://github.com/geomorphysics/GME/">Fork me on GitHub</a>
            <img src="../../_static/right-red@2x.png">
        </div>
     -->
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-gme.plot.ray_profiles">
<span id="ray-profiles-py"></span><h1><code class="docutils literal notranslate"><span class="pre">ray_profiles.py</span></code><a class="headerlink" href="#module-gme.plot.ray_profiles" title="Permalink to this headline">¶</a></h1>
<hr class="docutils" />
<p>Visualization.</p>
<p>Provides classes to generate a range of graphics for GME visualization.
A base class extends <a class="reference external" href="/Users/colinstark/Projects/GMPLib/modules/plot_utils.html#gmplib.plot_utils.GraphingBase" title="(in GMPLib v1.0)"><code class="xref py py-class docutils literal notranslate"><span class="pre">gmplib.plot_utils.GraphingBase</span></code></a>
provided by <code class="xref py py-mod docutils literal notranslate"><span class="pre">GMPLib</span></code>; the other classes build on this.
Each is tailored to a particular category of GME problem,
such as single ray tracing or for tracking knickpoints.</p>
<hr class="docutils" />
<dl class="simple">
<dt>Requires Python packages/modules:</dt><dd><ul class="simple">
<li><p><a class="reference external" href="https://numpy.org/doc/stable/reference/index.html#module-numpy" title="(in NumPy v1.21)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">numpy</span></code></a>, <a class="reference external" href="https://docs.sympy.org/latest/modules/index.html#module-sympy" title="(in SymPy v1.9)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sympy</span></code></a></p></li>
<li><p><a class="reference external" href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.html#module-matplotlib.pyplot" title="(in Matplotlib v3.5.0)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">matplotlib.pyplot</span></code></a></p></li>
<li><p><a class="reference internal" href="../core/symbols.html#module-gme.core.symbols" title="gme.core.symbols"><code class="xref py py-mod docutils literal notranslate"><span class="pre">gme.core.symbols</span></code></a>, <a class="reference internal" href="base.html#module-gme.plot.base" title="gme.plot.base"><code class="xref py py-mod docutils literal notranslate"><span class="pre">gme.plot.base</span></code></a></p></li>
</ul>
</dd>
</dl>
<hr class="docutils" />
<dl class="py class">
<dt class="sig sig-object py" id="gme.plot.ray_profiles.RayProfiles">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">gme.plot.ray_profiles.</span></span><span class="sig-name descname"><span class="pre">RayProfiles</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dpi</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">font_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">11</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#gme.plot.ray_profiles.RayProfiles" title="Permalink to this definition">¶</a></dt>
<dd><p>Subclasses <code class="xref py py-class docutils literal notranslate"><span class="pre">gme.plot.Graphing</span></code>.</p>
<dl class="py method">
<dt class="sig sig-object py" id="gme.plot.ray_profiles.RayProfiles.profile_h">
<span class="sig-name descname"><span class="pre">profile_h</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">gmes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gmeq</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sub</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fig_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dpi</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_limits</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eta_label_xy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_legend</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_profile_points</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">profile_subsetting</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_etaxi_label</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_pub_label</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pub_label</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pub_label_xy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(0.93,</span> <span class="pre">0.33)</span></span></em><span class="sig-paren">)</span> &#x2192; <a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.10)"><span class="pre">None</span></a><a class="headerlink" href="#gme.plot.ray_profiles.RayProfiles.profile_h" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot a time-invariant topographic profile solution of Hamilton’s equations.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="gme.plot.ray_profiles.RayProfiles.profile_h_rays">
<span class="sig-name descname"><span class="pre">profile_h_rays</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">gmes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gmeq</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sub</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fig_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dpi</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_limits</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_limits</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_points</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">101</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_direct</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_rays</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_schematic</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_legend</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_fault_bdry</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_compute_xivh_ratio</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_one_ray</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_t_sampling</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_etaxi_label</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_pub_label</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pub_label</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pub_label_xy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(0.93,</span> <span class="pre">0.33)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eta_label_xy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(0.5,</span> <span class="pre">0.8)</span></span></em><span class="sig-paren">)</span> &#x2192; <a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.10)"><span class="pre">None</span></a><a class="headerlink" href="#gme.plot.ray_profiles.RayProfiles.profile_h_rays" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot a set of erosion rays for a time-invariant topographic profile solution of Hamilton’s equations.</p>
<p>Hamilton’s equations are integrated once (from the left boundary to the divide)
and a time-invariant profile is constructed by repeating
the ray trajectory, with a suitable truncation and vertical initial offset, multiple times at the left boundary:
the set of end of truncated rays constitutes the ‘steady-state’ topographic profile.
The point of truncation of each trajectory corresponds to the effective time lag imposed by the choice of vertical initial
offset (which is controlled by the vertical slip rate).</p>
<p>Visualization of this profile includes: (i) plotting a subsampling of the terminated points of the ray truncations;
(ii) plotting a continuous curve generated by integrating the surface gradient implied by the erosion-front normal
covector values <span class="math notranslate nohighlight">\(\mathbf{\widetilde{p}}\)</span> values generated by solving Hamilton’s equations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fig</strong> (<a class="reference external" href="https://matplotlib.org/api/figure_api.html#matplotlib.figure.Figure" title="(in Matplotlib v3.5.0)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Matplotlib</span> <span class="pre">figure</span></code></a>) – reference to figure instantiated by <a class="reference external" href="/Users/colinstark/Projects/GMPLib/modules/plot_utils.html#gmplib.plot_utils.GraphingBase.create_figure" title="(in GMPLib v1.0)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">GMPLib</span> <span class="pre">create_figure</span></code></a></p></li>
<li><p><strong>gmes</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">OneRaySolution</span></code>) – instance of single ray solution class defined in <code class="xref py py-mod docutils literal notranslate"><span class="pre">ode_raytracing</span></code></p></li>
<li><p><strong>gmeq</strong> (<a class="reference internal" href="../core/equations.html#gme.core.equations.Equations" title="gme.core.equations.Equations"><code class="xref py py-class docutils literal notranslate"><span class="pre">Equations</span></code></a>) – GME model equations class instance defined in <a class="reference internal" href="../core/equations.html#module-gme.core.equations" title="gme.core.equations"><code class="xref py py-mod docutils literal notranslate"><span class="pre">equations</span></code></a></p></li>
<li><p><strong>sub</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.10)"><em>dict</em></a>) – dictionary of model parameter values to be used for equation substitutions</p></li>
<li><p><strong>do_direct</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)"><em>bool</em></a>) – plot directly integrated ray trajectory (from <span class="math notranslate nohighlight">\(\mathbf{\widetilde{p}}\)</span> values) as a solid curve</p></li>
<li><p><strong>ray_subsetting</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><em>int</em></a>) – optional ray subsampling rate (typically far more rays are computed than should be plotted)</p></li>
<li><p><strong>do_schematic</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)"><em>bool</em></a>) – optionally plot in more schematic form for expository purposes?</p></li>
<li><p><strong>do_simple</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)"><em>bool</em></a>) – optionally simplify?</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="gme.plot.ray_profiles.RayProfiles.profile_ray">
<span class="sig-name descname"><span class="pre">profile_ray</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">gmes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gmeq</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sub</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fig_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dpi</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_limits</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eta_label_xy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_points</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">101</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aspect</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_schematic</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_ndim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_simple</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_t_sampling</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_etaxi_label</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_pub_label</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pub_label</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pub_label_xy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(0.15,</span> <span class="pre">0.5)</span></span></em><span class="sig-paren">)</span> &#x2192; <a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.10)"><span class="pre">None</span></a><a class="headerlink" href="#gme.plot.ray_profiles.RayProfiles.profile_ray" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot a set of erosion rays for a time-invariant topographic profile solution of Hamilton’s equations.</p>
<p>Hamilton’s equations are integrated once (from the left boundary to the divide)
and a time-invariant profile is constructed by repeating
the ray trajectory, with a suitable truncation and vertical initial offset, multiple times at the left boundary:
the set of end of truncated rays constitutes the ‘steady-state’ topographic profile.
The point of truncation of each trajectory corresponds to the effective time lag imposed by the choice of vertical initial
offset (which is controlled by the vertical slip rate).</p>
<p>Visualization of this profile includes: (i) plotting a subsampling of the terminated points of the ray truncations;
(ii) plotting a continuous curve generated by integrating the surface gradient implied by the erosion-front normal
covector values <span class="math notranslate nohighlight">\(\mathbf{\widetilde{p}}\)</span> values generated by solving Hamilton’s equations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fig</strong> (<a class="reference external" href="https://matplotlib.org/api/figure_api.html#matplotlib.figure.Figure" title="(in Matplotlib v3.5.0)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Matplotlib</span> <span class="pre">figure</span></code></a>) – reference to figure instantiated by <a class="reference external" href="/Users/colinstark/Projects/GMPLib/modules/plot_utils.html#gmplib.plot_utils.GraphingBase.create_figure" title="(in GMPLib v1.0)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">GMPLib</span> <span class="pre">create_figure</span></code></a></p></li>
<li><p><strong>gmes</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">OneRaySolution</span></code>) – instance of single ray solution class defined in <code class="xref py py-mod docutils literal notranslate"><span class="pre">ode_raytracing</span></code></p></li>
<li><p><strong>gmeq</strong> (<a class="reference internal" href="../core/equations.html#gme.core.equations.Equations" title="gme.core.equations.Equations"><code class="xref py py-class docutils literal notranslate"><span class="pre">Equations</span></code></a>) – GME model equations class instance defined in <a class="reference internal" href="../core/equations.html#module-gme.core.equations" title="gme.core.equations"><code class="xref py py-mod docutils literal notranslate"><span class="pre">equations</span></code></a></p></li>
<li><p><strong>sub</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.10)"><em>dict</em></a>) – dictionary of model parameter values to be used for equation substitutions</p></li>
<li><p><strong>do_direct</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)"><em>bool</em></a>) – plot directly integrated ray trajectory (from <span class="math notranslate nohighlight">\(\mathbf{\widetilde{p}}\)</span> values) as a solid curve</p></li>
<li><p><strong>do_schematic</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)"><em>bool</em></a>) – optionally plot in more schematic form for expository purposes?</p></li>
<li><p><strong>do_simple</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)"><em>bool</em></a>) – optionally simplify?</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<div class="section" id="code">
<h2>Code<a class="headerlink" href="#code" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">---------------------------------------------------------------------</span>

<span class="sd">Visualization.</span>

<span class="sd">Provides classes to generate a range of graphics for GME visualization.</span>
<span class="sd">A base class extends :class:`gmplib.plot_utils.GraphingBase &lt;plot_utils.GraphingBase&gt;`</span>
<span class="sd">provided by :mod:`GMPLib`; the other classes build on this.</span>
<span class="sd">Each is tailored to a particular category of GME problem,</span>
<span class="sd">such as single ray tracing or for tracking knickpoints.</span>

<span class="sd">---------------------------------------------------------------------</span>

<span class="sd">Requires Python packages/modules:</span>
<span class="sd">  -  :mod:`numpy`, :mod:`sympy`</span>
<span class="sd">  -  :mod:`matplotlib.pyplot`</span>
<span class="sd">  -  :mod:`gme.core.symbols`, :mod:`gme.plot.base`</span>

<span class="sd">---------------------------------------------------------------------</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="c1"># Numpy</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># SymPy</span>
<span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">deg</span><span class="p">,</span> <span class="n">tan</span>

<span class="c1"># MatPlotLib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># GME</span>
<span class="kn">from</span> <span class="nn">gme.core.symbols</span> <span class="kn">import</span> <span class="n">Ci</span><span class="p">,</span> <span class="n">xiv_0</span><span class="p">,</span> <span class="n">xih_0</span>
<span class="kn">from</span> <span class="nn">gme.plot.base</span> <span class="kn">import</span> <span class="n">Graphing</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;RayProfiles&#39;</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">RayProfiles</span><span class="p">(</span><span class="n">Graphing</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Subclasses :class:`gme.plot.Graphing &lt;plot.Graphing&gt;`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">profile_ray</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">gmes</span><span class="p">,</span> <span class="n">gmeq</span><span class="p">,</span> <span class="n">sub</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">fig_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">y_limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">eta_label_xy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_points</span><span class="o">=</span><span class="mi">101</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="c1"># do_direct=True,</span>
                        <span class="n">do_schematic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">do_ndim</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">do_simple</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">do_t_sampling</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">do_etaxi_label</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">do_pub_label</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pub_label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">pub_label_xy</span><span class="o">=</span><span class="p">(</span><span class="mf">0.15</span><span class="p">,</span><span class="mf">0.50</span><span class="p">)</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot a set of erosion rays for a time-invariant topographic profile solution of Hamilton&#39;s equations.</span>

<span class="sd">        Hamilton&#39;s equations are integrated once (from the left boundary to the divide)</span>
<span class="sd">        and a time-invariant profile is constructed by repeating</span>
<span class="sd">        the ray trajectory, with a suitable truncation and vertical initial offset, multiple times at the left boundary:</span>
<span class="sd">        the set of end of truncated rays constitutes the &#39;steady-state&#39; topographic profile.</span>
<span class="sd">        The point of truncation of each trajectory corresponds to the effective time lag imposed by the choice of vertical initial</span>
<span class="sd">        offset (which is controlled by the vertical slip rate).</span>

<span class="sd">        Visualization of this profile includes: (i) plotting a subsampling of the terminated points of the ray truncations;</span>
<span class="sd">        (ii) plotting a continuous curve generated by integrating the surface gradient implied by the erosion-front normal</span>
<span class="sd">        covector values :math:`\mathbf{\widetilde{p}}` values generated by solving Hamilton&#39;s equations.</span>

<span class="sd">        Args:</span>
<span class="sd">            fig (:obj:`Matplotlib figure &lt;matplotlib.figure.Figure&gt;`):</span>
<span class="sd">                reference to figure instantiated by :meth:`GMPLib create_figure &lt;plot_utils.GraphingBase.create_figure&gt;`</span>
<span class="sd">            gmes (:class:`~.ode_raytracing.OneRaySolution`):</span>
<span class="sd">                    instance of single ray solution class defined in :mod:`~.ode_raytracing`</span>
<span class="sd">            gmeq (:class:`~.equations.Equations`):</span>
<span class="sd">                    GME model equations class instance defined in :mod:`~.equations`</span>
<span class="sd">            sub (dict): dictionary of model parameter values to be used for equation substitutions</span>
<span class="sd">            do_direct (bool): plot directly integrated ray trajectory (from :math:`\mathbf{\widetilde{p}}` values) as a solid curve</span>
<span class="sd">            do_schematic (bool):</span>
<span class="sd">                optionally plot in more schematic form for expository purposes?</span>
<span class="sd">            do_simple (bool): optionally simplify?</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_figure</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">fig_size</span><span class="o">=</span><span class="n">fig_size</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="c1"># pub_label_xy = [0.15,0.50] if pub_label_xy is None else pub_label_xy</span>

        <span class="n">t_array</span>  <span class="o">=</span> <span class="n">gmes</span><span class="o">.</span><span class="n">t_array</span>
        <span class="n">rx_array</span> <span class="o">=</span> <span class="n">gmes</span><span class="o">.</span><span class="n">rx_array</span>
        <span class="c1"># rz_array = gmes.rz_array</span>
        <span class="c1"># v_array = n.sqrt(gmes.rdotx_array**2 + gmes.rdotz_array**2)</span>

        <span class="k">if</span> <span class="n">do_t_sampling</span><span class="p">:</span>
            <span class="n">t_begin</span><span class="p">,</span> <span class="n">t_end</span> <span class="o">=</span> <span class="n">t_array</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">t_rsmpld_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">t_begin</span><span class="p">,</span> <span class="n">t_end</span><span class="p">,</span> <span class="n">n_points</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x_rsmpld_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rx_array</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rx_array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">n_points</span><span class="p">)</span>
            <span class="n">t_rsmpld_array</span> <span class="o">=</span> <span class="n">gmes</span><span class="o">.</span><span class="n">t_interp_x</span><span class="p">(</span><span class="n">x_rsmpld_array</span><span class="p">)</span>
        <span class="n">rx_rsmpld_array</span> <span class="o">=</span> <span class="n">gmes</span><span class="o">.</span><span class="n">rx_interp_t</span><span class="p">(</span><span class="n">t_rsmpld_array</span><span class="p">)</span>
        <span class="n">rz_rsmpld_array</span> <span class="o">=</span> <span class="n">gmes</span><span class="o">.</span><span class="n">rz_interp_t</span><span class="p">(</span><span class="n">t_rsmpld_array</span><span class="p">)</span>
        <span class="n">v_rsmpld_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">gmes</span><span class="o">.</span><span class="n">rdotx_interp_t</span><span class="p">(</span><span class="n">t_rsmpld_array</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
                                <span class="o">+</span> <span class="n">gmes</span><span class="o">.</span><span class="n">rdotz_interp_t</span><span class="p">(</span><span class="n">t_rsmpld_array</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Plot arrow-annotated rays</span>
        <span class="n">xi_vh_ratio</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">tan</span><span class="p">(</span><span class="n">Ci</span><span class="p">)</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">sub</span><span class="p">))</span> <span class="k">if</span> <span class="n">do_ndim</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">xiv_0</span><span class="o">/</span><span class="n">xih_0</span><span class="p">)</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">sub</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_rays_with_arrows_simple</span><span class="p">(</span> <span class="n">axes</span><span class="p">,</span> <span class="n">sub</span><span class="p">,</span> <span class="n">xi_vh_ratio</span><span class="p">,</span>
                                          <span class="n">t_rsmpld_array</span><span class="p">,</span> <span class="n">rx_rsmpld_array</span><span class="p">,</span> <span class="n">rz_rsmpld_array</span><span class="p">,</span> <span class="n">v_rsmpld_array</span><span class="p">,</span>
                                          <span class="n">n_rays</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_t</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                          <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">sf</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">do_one_ray</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;0.5&#39;</span> <span class="p">)</span>

        <span class="n">axes</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="n">aspect</span> <span class="k">if</span> <span class="n">aspect</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Distance, $x/L_{\mathrm</span><span class="si">{c}</span><span class="s1">}$  [-]&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Elevation, $z/L_{\mathrm</span><span class="si">{c}</span><span class="s1">}$  [-]&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">eta_label_xy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">eta_label_xy</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.92</span><span class="p">,</span><span class="mf">0.15</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">do_schematic</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">do_simple</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">do_etaxi_label</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">*</span><span class="n">eta_label_xy</span><span class="p">,</span>
                         <span class="sa">rf</span><span class="s1">&#39;$\eta=</span><span class="si">{</span><span class="n">gmeq</span><span class="o">.</span><span class="n">eta_</span><span class="si">}</span><span class="s1">$&#39;</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;$\quad\mathsf</span><span class="si">{Ci}</span><span class="s1">=$&#39;</span><span class="o">+</span><span class="sa">rf</span><span class="s1">&#39;$</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">deg</span><span class="p">(</span><span class="n">Ci</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">sub</span><span class="p">))))</span><span class="si">}</span><span class="s1">\degree$&#39;</span><span class="p">,</span>
                         <span class="n">transform</span><span class="o">=</span><span class="n">axes</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
                         <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                         <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">do_pub_label</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">*</span><span class="n">pub_label_xy</span><span class="p">,</span> <span class="n">pub_label</span><span class="p">,</span>
                         <span class="n">transform</span><span class="o">=</span><span class="n">axes</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">y_limits</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">*</span><span class="n">y_limits</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">profile_h_rays</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">gmes</span><span class="p">,</span> <span class="n">gmeq</span><span class="p">,</span> <span class="n">sub</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">fig_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">x_limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_points</span><span class="o">=</span><span class="mi">101</span><span class="p">,</span>
                        <span class="n">do_direct</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">n_rays</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="c1">#profile_subsetting=5,</span>
                        <span class="n">do_schematic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">do_legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1">#do_profile_points=True,</span>
                        <span class="n">do_fault_bdry</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">do_compute_xivh_ratio</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">do_one_ray</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">do_t_sampling</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">do_etaxi_label</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">do_pub_label</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pub_label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                        <span class="n">pub_label_xy</span><span class="o">=</span><span class="p">(</span><span class="mf">0.93</span><span class="p">,</span><span class="mf">0.33</span><span class="p">),</span> <span class="n">eta_label_xy</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.8</span><span class="p">)</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot a set of erosion rays for a time-invariant topographic profile solution of Hamilton&#39;s equations.</span>

<span class="sd">        Hamilton&#39;s equations are integrated once (from the left boundary to the divide)</span>
<span class="sd">        and a time-invariant profile is constructed by repeating</span>
<span class="sd">        the ray trajectory, with a suitable truncation and vertical initial offset, multiple times at the left boundary:</span>
<span class="sd">        the set of end of truncated rays constitutes the &#39;steady-state&#39; topographic profile.</span>
<span class="sd">        The point of truncation of each trajectory corresponds to the effective time lag imposed by the choice of vertical initial</span>
<span class="sd">        offset (which is controlled by the vertical slip rate).</span>

<span class="sd">        Visualization of this profile includes: (i) plotting a subsampling of the terminated points of the ray truncations;</span>
<span class="sd">        (ii) plotting a continuous curve generated by integrating the surface gradient implied by the erosion-front normal</span>
<span class="sd">        covector values :math:`\mathbf{\widetilde{p}}` values generated by solving Hamilton&#39;s equations.</span>

<span class="sd">        Args:</span>
<span class="sd">            fig (:obj:`Matplotlib figure &lt;matplotlib.figure.Figure&gt;`):</span>
<span class="sd">                reference to figure instantiated by :meth:`GMPLib create_figure &lt;plot_utils.GraphingBase.create_figure&gt;`</span>
<span class="sd">            gmes (:class:`~.ode_raytracing.OneRaySolution`):</span>
<span class="sd">                    instance of single ray solution class defined in :mod:`~.ode_raytracing`</span>
<span class="sd">            gmeq (:class:`~.equations.Equations`):</span>
<span class="sd">                    GME model equations class instance defined in :mod:`~.equations`</span>
<span class="sd">            sub (dict): dictionary of model parameter values to be used for equation substitutions</span>
<span class="sd">            do_direct (bool): plot directly integrated ray trajectory (from :math:`\mathbf{\widetilde{p}}` values) as a solid curve</span>
<span class="sd">            ray_subsetting (int): optional ray subsampling rate (typically far more rays are computed than should be plotted)</span>
<span class="sd">            do_schematic (bool):</span>
<span class="sd">                optionally plot in more schematic form for expository purposes?</span>
<span class="sd">            do_simple (bool): optionally simplify?</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_figure</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">fig_size</span><span class="o">=</span><span class="n">fig_size</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
        <span class="c1"># pub_label_xy = [0.93,0.33] if pub_label_xy is None else pub_label_xy</span>
        <span class="c1"># eta_label_xy = [0.5,0.8] if eta_label_xy is None else eta_label_xy</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

        <span class="n">t_array</span>  <span class="o">=</span> <span class="n">gmes</span><span class="o">.</span><span class="n">t_array</span> <span class="c1">#[::ray_subsetting]</span>
        <span class="n">rx_array</span> <span class="o">=</span> <span class="n">gmes</span><span class="o">.</span><span class="n">rx_array</span> <span class="c1">#[::ray_subsetting]</span>
        <span class="c1"># rz_array = gmes.rz_array #[::ray_subsetting]</span>

        <span class="k">if</span> <span class="n">do_t_sampling</span><span class="p">:</span>
            <span class="n">t_begin</span><span class="p">,</span> <span class="n">t_end</span> <span class="o">=</span> <span class="n">t_array</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">t_rsmpld_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">t_begin</span><span class="p">,</span> <span class="n">t_end</span><span class="p">,</span> <span class="n">n_points</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x_rsmpld_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rx_array</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rx_array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">n_points</span><span class="p">)</span>
            <span class="n">t_rsmpld_array</span> <span class="o">=</span> <span class="n">gmes</span><span class="o">.</span><span class="n">t_interp_x</span><span class="p">(</span><span class="n">x_rsmpld_array</span><span class="p">)</span>
        <span class="n">rx_rsmpld_array</span> <span class="o">=</span> <span class="n">gmes</span><span class="o">.</span><span class="n">rx_interp_t</span><span class="p">(</span><span class="n">t_rsmpld_array</span><span class="p">)</span>
        <span class="n">rz_rsmpld_array</span> <span class="o">=</span> <span class="n">gmes</span><span class="o">.</span><span class="n">rz_interp_t</span><span class="p">(</span><span class="n">t_rsmpld_array</span><span class="p">)</span>

        <span class="c1"># Plot arrow-annotated rays</span>
        <span class="n">xi_vh_ratio</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">tan</span><span class="p">(</span><span class="n">Ci</span><span class="p">)</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">sub</span><span class="p">))</span> <span class="k">if</span> <span class="n">do_compute_xivh_ratio</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">xiv_0</span><span class="o">/</span><span class="n">xih_0</span><span class="p">)</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">sub</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_rays_with_arrows_simple</span><span class="p">(</span> <span class="n">axes</span><span class="p">,</span> <span class="n">sub</span><span class="p">,</span> <span class="n">xi_vh_ratio</span><span class="p">,</span>
                                           <span class="n">t_rsmpld_array</span><span class="p">,</span> <span class="n">rx_rsmpld_array</span><span class="p">,</span> <span class="n">rz_rsmpld_array</span><span class="p">,</span>
                                           <span class="n">n_rays</span><span class="o">=</span><span class="n">n_rays</span><span class="p">,</span> <span class="n">n_t</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                           <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span> <span class="k">if</span> <span class="n">do_schematic</span> <span class="k">else</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span>
                                           <span class="n">sf</span><span class="o">=</span><span class="mf">0.5</span> <span class="k">if</span> <span class="n">do_schematic</span> <span class="k">else</span> <span class="mi">1</span><span class="p">,</span> <span class="n">do_one_ray</span><span class="o">=</span><span class="n">do_one_ray</span> <span class="p">)</span>

        <span class="k">if</span> <span class="n">do_schematic</span><span class="p">:</span>
            <span class="c1"># For schematic fig, also plot mirror-image topo profile on opposite side of drainage divide</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_rays_with_arrows_simple</span><span class="p">(</span> <span class="n">axes</span><span class="p">,</span> <span class="n">sub</span><span class="p">,</span> <span class="n">xi_vh_ratio</span><span class="p">,</span>
                                               <span class="n">t_rsmpld_array</span><span class="p">,</span> <span class="mi">2</span><span class="o">-</span><span class="n">rx_rsmpld_array</span><span class="p">,</span> <span class="n">rz_rsmpld_array</span><span class="p">,</span>
                                               <span class="n">n_rays</span><span class="o">=</span><span class="n">n_rays</span><span class="p">,</span> <span class="n">n_t</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                               <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span> <span class="k">if</span> <span class="n">do_schematic</span> <span class="k">else</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span>
                                               <span class="n">sf</span><span class="o">=</span><span class="mf">0.5</span> <span class="k">if</span> <span class="n">do_schematic</span> <span class="k">else</span> <span class="mi">1</span><span class="p">,</span> <span class="n">do_labels</span><span class="o">=</span><span class="kc">False</span> <span class="p">)</span>

        <span class="c1"># # Markers = topo profile from ray terminations</span>
        <span class="c1"># if not do_schematic and not do_one_ray:</span>
        <span class="c1">#     plt.plot( gmes.x_array[::profile_subsetting], gmes.h_array[::profile_subsetting],</span>
        <span class="c1">#                 &#39;k&#39;+(&#39;s&#39; if do_profile_points else &#39;-&#39;),</span>
        <span class="c1">#                 ms=3, label=r&#39;$T(\mathbf{r})$ from rays $\mathbf{r}(t)$&#39; )</span>

        <span class="c1"># Solid line = topo profile from direct integration of gradient array</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">do_direct</span> <span class="ow">or</span> <span class="n">do_schematic</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">do_one_ray</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">gmes</span><span class="o">.</span><span class="n">h_x_array</span><span class="p">,(</span><span class="n">gmes</span><span class="o">.</span><span class="n">h_z_array</span><span class="o">-</span><span class="n">gmes</span><span class="o">.</span><span class="n">h_z_array</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span>
                     <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$T(\mathbf</span><span class="si">{r}</span><span class="s1">)$&#39;</span> <span class="k">if</span> <span class="n">do_schematic</span> <span class="k">else</span> <span class="sa">r</span><span class="s1">&#39;$T(\mathbf</span><span class="si">{r}</span><span class="s1">)$&#39;</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">do_schematic</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>  <span class="n">gmes</span><span class="o">.</span><span class="n">h_x_array</span><span class="p">,(</span><span class="n">gmes</span><span class="o">.</span><span class="n">h_z_array</span><span class="o">-</span><span class="n">gmes</span><span class="o">.</span><span class="n">h_z_array</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="mf">0.26</span><span class="p">,</span> <span class="s1">&#39;0.75&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>  <span class="n">gmes</span><span class="o">.</span><span class="n">h_x_array</span><span class="p">,(</span><span class="n">gmes</span><span class="o">.</span><span class="n">h_z_array</span><span class="o">-</span><span class="n">gmes</span><span class="o">.</span><span class="n">h_z_array</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="mf">0.13</span><span class="p">,</span> <span class="s1">&#39;0.5&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">2</span><span class="o">-</span><span class="n">gmes</span><span class="o">.</span><span class="n">h_x_array</span><span class="p">,(</span><span class="n">gmes</span><span class="o">.</span><span class="n">h_z_array</span><span class="o">-</span><span class="n">gmes</span><span class="o">.</span><span class="n">h_z_array</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">2</span><span class="o">-</span><span class="n">gmes</span><span class="o">.</span><span class="n">h_x_array</span><span class="p">,(</span><span class="n">gmes</span><span class="o">.</span><span class="n">h_z_array</span><span class="o">-</span><span class="n">gmes</span><span class="o">.</span><span class="n">h_z_array</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="mf">0.13</span><span class="p">,</span> <span class="s1">&#39;0.5&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">2</span><span class="o">-</span><span class="n">gmes</span><span class="o">.</span><span class="n">h_x_array</span><span class="p">,(</span><span class="n">gmes</span><span class="o">.</span><span class="n">h_z_array</span><span class="o">-</span><span class="n">gmes</span><span class="o">.</span><span class="n">h_z_array</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="mf">0.26</span><span class="p">,</span> <span class="s1">&#39;0.75&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

        <span class="n">axes</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Distance, $x/L_{\mathrm</span><span class="si">{c}</span><span class="s1">}$  [-]&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span> <span class="k">if</span> <span class="n">do_schematic</span> <span class="k">else</span> <span class="mi">16</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Elevation, $z/L_{\mathrm</span><span class="si">{c}</span><span class="s1">}$  [-]&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span> <span class="k">if</span> <span class="n">do_schematic</span> <span class="k">else</span> <span class="mi">16</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">do_schematic</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">do_one_ray</span> <span class="ow">and</span> <span class="n">do_legend</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span> <span class="k">if</span> <span class="n">do_schematic</span> <span class="k">else</span> <span class="p">(</span><span class="mf">0.065</span><span class="p">,</span><span class="mf">0.45</span><span class="p">),</span>
                       <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span> <span class="k">if</span> <span class="n">do_schematic</span> <span class="k">else</span> <span class="mi">11</span><span class="p">,</span>
                       <span class="n">framealpha</span><span class="o">=</span><span class="mf">0.95</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">do_schematic</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">do_etaxi_label</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">*</span><span class="n">eta_label_xy</span><span class="p">,</span>
                         <span class="sa">rf</span><span class="s1">&#39;$\eta=</span><span class="si">{</span><span class="n">gmeq</span><span class="o">.</span><span class="n">eta_</span><span class="si">}</span><span class="s1">$&#39;</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;$\quad\mathsf</span><span class="si">{Ci}</span><span class="s1">=$&#39;</span><span class="o">+</span><span class="sa">rf</span><span class="s1">&#39;$</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">deg</span><span class="p">(</span><span class="n">Ci</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">sub</span><span class="p">))))</span><span class="si">}</span><span class="s1">\degree$&#39;</span><span class="p">,</span>
                         <span class="n">transform</span><span class="o">=</span><span class="n">axes</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
                         <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                         <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">do_pub_label</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">*</span><span class="n">pub_label_xy</span><span class="p">,</span> <span class="n">pub_label</span><span class="p">,</span>
                         <span class="n">transform</span><span class="o">=</span><span class="n">axes</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">x_limits</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">*</span><span class="n">x_limits</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">y_limits</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">*</span><span class="n">y_limits</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">do_schematic</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">x_</span><span class="p">,</span><span class="n">align_</span> <span class="ow">in</span> <span class="p">[(</span><span class="mf">0.03</span><span class="p">,</span><span class="s1">&#39;center&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mf">1.97</span><span class="p">,</span><span class="s1">&#39;center&#39;</span><span class="p">)]:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x_</span><span class="p">,</span><span class="mf">0.45</span><span class="p">,</span> <span class="s1">&#39;rays initiated&#39;</span><span class="p">,</span> <span class="c1">#transform=axes.transAxes,</span>
                         <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="n">align_</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                         <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.53</span><span class="p">,</span> <span class="s1">&#39;rays annihilated&#39;</span><span class="p">,</span> <span class="c1">#transform=axes.transAxes,</span>
                     <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                     <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;0.25&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">x_</span><span class="p">,</span><span class="n">align_</span> <span class="ow">in</span> <span class="p">[(</span><span class="o">-</span><span class="mf">0.03</span><span class="p">,</span><span class="s1">&#39;right&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mf">2.03</span><span class="p">,</span><span class="s1">&#39;left&#39;</span><span class="p">)]:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x_</span><span class="p">,</span><span class="mf">0.17</span><span class="p">,</span> <span class="s1">&#39;fault slip b.c.&#39;</span> <span class="k">if</span> <span class="n">do_fault_bdry</span> <span class="k">else</span> <span class="s1">&#39;const. erosion rate&#39;</span><span class="p">,</span>
                         <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="n">align_</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                         <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.46</span><span class="p">,</span><span class="mf">0.38</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;surface isochrone $T(\mathbf</span><span class="si">{r}</span><span class="s1">)=\mathrm</span><span class="si">{past}</span><span class="s1">$&#39;</span><span class="p">,</span>
                     <span class="c1">#transform=axes.transAxes,</span>
                     <span class="n">rotation</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                     <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;0.2&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.52</span><span class="p">,</span><span class="mf">0.05</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;surface isochrone $T(\mathbf</span><span class="si">{r}</span><span class="s1">)=\mathrm</span><span class="si">{now}</span><span class="s1">$&#39;</span><span class="p">,</span>
                     <span class="c1">#transform=axes.transAxes,</span>
                     <span class="n">rotation</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                     <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">x_</span><span class="p">,</span><span class="n">y_</span><span class="p">,</span><span class="n">dx_</span><span class="p">,</span><span class="n">dy_</span><span class="p">,</span><span class="n">shape_</span> <span class="ow">in</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mf">0.15</span><span class="p">,</span><span class="s1">&#39;left&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mf">0.15</span><span class="p">,</span><span class="s1">&#39;left&#39;</span><span class="p">),</span>
                                         <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mf">0.15</span><span class="p">,</span><span class="s1">&#39;left&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mf">0.15</span><span class="p">,</span><span class="s1">&#39;right&#39;</span><span class="p">),</span>
                                         <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mf">0.15</span><span class="p">,</span><span class="s1">&#39;right&#39;</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mf">0.15</span><span class="p">,</span><span class="s1">&#39;right&#39;</span><span class="p">)]:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span> <span class="n">x_</span><span class="p">,</span><span class="n">y_</span><span class="p">,</span><span class="n">dx_</span><span class="p">,</span><span class="n">dy_</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.04</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span>
                           <span class="n">length_includes_head</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">shape_</span><span class="p">,</span>
                           <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">profile_h</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">gmes</span><span class="p">,</span> <span class="n">gmeq</span><span class="p">,</span> <span class="n">sub</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">fig_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">y_limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">eta_label_xy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1"># n_points=101,</span>
                    <span class="c1"># do_direct=True,</span>
                    <span class="n">do_legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">do_profile_points</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">profile_subsetting</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                    <span class="c1"># do_t_sampling=True,</span>
                    <span class="n">do_etaxi_label</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">do_pub_label</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pub_label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">pub_label_xy</span><span class="o">=</span><span class="p">(</span><span class="mf">0.93</span><span class="p">,</span><span class="mf">0.33</span><span class="p">)</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot a time-invariant topographic profile solution of Hamilton&#39;s equations.</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_figure</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">fig_size</span><span class="o">=</span><span class="n">fig_size</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
        <span class="c1"># pub_label_xy = [0.93,0.33] if pub_label_xy is None else pub_label_xy</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

        <span class="c1"># t_array  = gmes.t_array #[::ray_subsetting]</span>
        <span class="c1"># rx_array = gmes.rx_array #[::ray_subsetting]</span>
        <span class="c1"># rz_array = gmes.rz_array #[::ray_subsetting]</span>
        <span class="c1"># print()</span>

        <span class="c1"># if do_t_sampling:</span>
        <span class="c1">#     t_begin, t_end = t_array[0], t_array[-1]</span>
        <span class="c1">#     # t_rsmpld_array = np.linspace(t_begin, t_end, n_points)</span>
        <span class="c1"># else:</span>
        <span class="c1">#     x_rsmpld_array = np.linspace(rx_array[0], rx_array[-1], n_points)</span>
        <span class="c1">#     t_rsmpld_array = gmes.t_interp_x(x_rsmpld_array)</span>
        <span class="c1"># # rx_rsmpld_array = gmes.rx_interp_t(t_rsmpld_array)</span>
        <span class="c1"># # rz_rsmpld_array = gmes.rz_interp_t(t_rsmpld_array)</span>

        <span class="c1"># Markers = topo profile from ray terminations</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="n">gmes</span><span class="o">.</span><span class="n">x_array</span><span class="p">[::</span><span class="n">profile_subsetting</span><span class="p">],</span> <span class="n">gmes</span><span class="o">.</span><span class="n">h_array</span><span class="p">[::</span><span class="n">profile_subsetting</span><span class="p">],</span>
                    <span class="s1">&#39;k&#39;</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;s&#39;</span> <span class="k">if</span> <span class="n">do_profile_points</span> <span class="k">else</span> <span class="s1">&#39;-&#39;</span><span class="p">),</span>
                    <span class="n">ms</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$T(\mathbf</span><span class="si">{r}</span><span class="s1">)$ from rays $\mathbf</span><span class="si">{r}</span><span class="s1">(t)$&#39;</span> <span class="p">)</span>

        <span class="c1"># Solid line = topo profile from direct integration of gradient array</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">gmes</span><span class="o">.</span><span class="n">h_x_array</span><span class="p">,(</span><span class="n">gmes</span><span class="o">.</span><span class="n">h_z_array</span><span class="o">-</span><span class="n">gmes</span><span class="o">.</span><span class="n">h_z_array</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span>
                 <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$T(\mathbf</span><span class="si">{r}</span><span class="s1">)$ by integration&#39;</span> <span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Distance, $x/L_{\mathrm</span><span class="si">{c}</span><span class="s1">}$  [-]&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Elevation, $z/L_{\mathrm</span><span class="si">{c}</span><span class="s1">}$  [-]&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">do_legend</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="p">(</span><span class="mf">0.38</span><span class="p">,</span><span class="mf">0.75</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">framealpha</span><span class="o">=</span><span class="mf">0.95</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">eta_label_xy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">eta_label_xy</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.92</span><span class="p">,</span><span class="mf">0.15</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">do_etaxi_label</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">*</span><span class="n">eta_label_xy</span><span class="p">,</span>
                     <span class="sa">rf</span><span class="s1">&#39;$\eta=</span><span class="si">{</span><span class="n">gmeq</span><span class="o">.</span><span class="n">eta_</span><span class="si">}</span><span class="s1">$&#39;</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;$\quad\mathsf</span><span class="si">{Ci}</span><span class="s1">=$&#39;</span><span class="o">+</span><span class="sa">rf</span><span class="s1">&#39;$</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">deg</span><span class="p">(</span><span class="n">Ci</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">sub</span><span class="p">))))</span><span class="si">}</span><span class="s1">\degree$&#39;</span><span class="p">,</span>
                     <span class="n">transform</span><span class="o">=</span><span class="n">axes</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
                     <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                     <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">do_pub_label</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">*</span><span class="n">pub_label_xy</span><span class="p">,</span> <span class="n">pub_label</span><span class="p">,</span>
                     <span class="n">transform</span><span class="o">=</span><span class="n">axes</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                     <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">y_limits</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">*</span><span class="n">y_limits</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
    <a id="sidebar-anchor"></a>
    

<div id="searchbox" style="display: none" role="search">
    <a class="biglink" href="../../index.html">
        <img src="../../_static/gme_icon.png" />
    </a>
  <h3></h3>
    <form class="search" action="../../search.html" method="get">
      <div class="ui action left icon input">
        <i class="search icon"></i>
        <input type="text" name="q" placeholder="Search...">
        <div class="ui teal button"></div>
      </div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<!-- <br> -->
<script type="text/javascript">$('#searchbox').show(0);</script><h3><a href="../../index.html">Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Presentations.html">  Presentations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Publications.html">  Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Design.html">  Software design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Dependencies.html">  Dependencies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Installation.html">  Installation and set-up</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Running.html">  Running the notebooks</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../Python.html">  Python package docs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../core/index.html">Core</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ode/index.html">ODE integration</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Plotting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../knickpoints/index.html">Knickpoint detection and tracking [in development]</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Notebooks.html">  Notebook docs</a></li>
</ul>

    <!-- <h3><a href="../../index.html">This page</a></h3> -->
    <!-- <ul>
<li><a class="reference internal" href="#"><code class="docutils literal notranslate"><span class="pre">ray_profiles.py</span></code></a><ul>
<li><a class="reference internal" href="#code">Code</a></li>
</ul>
</li>
</ul>
 -->
    <p class="biglink">
        <h3><a href="../../genindex.html"> Index</a></h3>
    </p>
  <br>
  <!-- <p class="biglink"><a class="biglink" href="../../py-modindex.html">
         Module index</a>
  <br><br> -->
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="ray_velocities.html" title="ray_velocities.py"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ray_geodesics.html" title="ray_geodesics.py"
             accesskey="P">previous</a> |</li>
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2021, CPS.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.0.3.
    </div>
  </body>
</html>