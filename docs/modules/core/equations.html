<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>equations.py &#8212; GME 1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/pydoctheme.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script src="../../_static/sidebar.js"></script>
    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="equation_utils.py" href="equation_utils.html" />
    <link rel="prev" title="symbols.py" href="symbols.html" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <link rel="shortcut icon" type="image/png" href="../../_static/favicon.png" />
    <meta name="viewport" content="width=device-width,initial-scale=0.8">
    
    

  </head><body>
    <!-- <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="responsive-menu"><a href="#sidebar-anchor" title="Navigation">&#9776;</a></li>
        <li><a href="../../index.html">GME 1.0 documentation</a> &#187;</li>
          <li><a href="../Python.html" >Python package <cite>gme</cite></a> &#187;</li>
          <li><a href="index.html" accesskey="U"><cite>gme.core</cite></a> &#187;</li> 
      </ul>
    </div> -->
    <!-- 
        <div class="badge">
            <a href="https://github.com/geomorphysics/GME/">Fork me on GitHub</a>
            <img src="../../_static/right-red@2x.png">
        </div>
     -->
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-gme.core.equations">
<span id="equations-py"></span><h1><code class="docutils literal notranslate"><span class="pre">equations.py</span></code><a class="headerlink" href="#module-gme.core.equations" title="Permalink to this headline">¶</a></h1>
<hr class="docutils" />
<p>Equation definitions and derivations using <a class="reference external" href="https://docs.sympy.org/latest/modules/index.html#module-sympy" title="(in SymPy v1.9)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">SymPy</span></code></a>.</p>
<hr class="docutils" />
<p>This module provides a derivation of GME theory using <a class="reference external" href="https://docs.sympy.org/latest/modules/index.html#module-sympy" title="(in SymPy v1.9)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">SymPy</span></code></a>
for a 2D slice of a 3D landscape along a channel transect.</p>
<p>Starting from a model equation for the surface-normal erosion rate in terms of
the tilt angle of the topographic surface and the distance downstream
(used to infer the flow component of the model erosion process), we derive
the fundamental function (of a co-Finsler metric space), the corresponding Hamiltonian,
and the equivalent metric tensor.
The rest of the equations are derived from these core results.</p>
<hr class="docutils" />
<dl class="simple">
<dt>Requires Python packages/modules:</dt><dd><ul class="simple">
<li><p><a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/index.html#module-scipy" title="(in SciPy v1.7.1)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">scipy</span></code></a>, <a class="reference external" href="https://docs.sympy.org/latest/modules/index.html#module-sympy" title="(in SymPy v1.9)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sympy</span></code></a></p></li>
<li><p><code class="xref py py-mod docutils literal notranslate"><span class="pre">gmplib.utils</span></code></p></li>
<li><p><a class="reference internal" href="symbols.html#module-gme.core.symbols" title="gme.core.symbols"><code class="xref py py-mod docutils literal notranslate"><span class="pre">gme.core.symbols</span></code></a></p></li>
</ul>
</dd>
</dl>
<hr class="docutils" />
<dl class="py class">
<dt class="sig sig-object py" id="gme.core.equations.EquationSubset">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">gme.core.equations.</span></span><span class="sig-name descname"><span class="pre">EquationSubset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">gmeq</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parameters</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_ndim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_revert</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#gme.core.equations.EquationSubset" title="Permalink to this definition">¶</a></dt>
<dd><p>TBD</p>
<dl class="py method">
<dt class="sig sig-object py" id="gme.core.equations.EquationSubset.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">gmeq</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parameters</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_ndim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_revert</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#gme.core.equations.EquationSubset.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>TBD</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="gme.core.equations.Equations">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">gme.core.equations.</span></span><span class="sig-name descname"><span class="pre">Equations</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parameters</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eta_</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span> <span class="pre">/</span> <span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mu_</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span> <span class="pre">/</span> <span class="pre">4</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">beta_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'sin'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">varphi_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'ramp'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ibc_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'convex-up'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_raw</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_idtx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_geodesic</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_nothing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_new_varphi_model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#gme.core.equations.Equations" title="Permalink to this definition">¶</a></dt>
<dd><p>Class to solve the set of GME equations (using <a class="reference external" href="https://docs.sympy.org/latest/modules/index.html#module-sympy" title="(in SymPy v1.9)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">SymPy</span></code></a>)
and to provide them in a form (sometimes lambdified) that can be used for
numerical evaluation.</p>
<p>Much of the derivation sequence here keeps <span class="math notranslate nohighlight">\(\eta\)</span> and <span class="math notranslate nohighlight">\(\mu\)</span> unspecified,
up until the Hamiltonian is defined, but eventually values for these
parameters need to be substituted in order to make further progress.
In this documentation, we set <span class="math notranslate nohighlight">\(\eta=3/2\)</span>, for now.</p>
<dl class="simple">
<dt>TODO: provide solutions for both <span class="math notranslate nohighlight">\(\eta=1/2\)</span> and</dt><dd><p><span class="math notranslate nohighlight">\(\eta=3/2\)</span> where appropriate.</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="gme.core.equations.Equations.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parameters</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eta_</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span> <span class="pre">/</span> <span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mu_</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span> <span class="pre">/</span> <span class="pre">4</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">beta_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'sin'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">varphi_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'ramp'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ibc_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'convex-up'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_raw</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_idtx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_geodesic</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_nothing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_new_varphi_model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#gme.core.equations.Equations.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize class instance.
Define/derive all the GME equations (unless <cite>‘do_nothing’</cite> is true)
using <a class="reference external" href="https://docs.sympy.org/latest/modules/index.html#module-sympy" title="(in SymPy v1.9)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">SymPy</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>parameters</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.10)"><em>dict</em></a>) – dictionary of model parameter values to be
used for equation substitutions
(used when defining geodesic equations)</p></li>
<li><p><strong>eta</strong> (<a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.numbers.Rational" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Rational</span></code></a>) – exponent in slope component of erosion model (equivalent of
gradient exponent <span class="math notranslate nohighlight">\(n\)</span> in SPIM)</p></li>
<li><p><strong>mu</strong> (<a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.numbers.Rational" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Rational</span></code></a>) – exponent in flow component of erosion model
(equivalent of area exponent <span class="math notranslate nohighlight">\(m\)</span> in SPIM)</p></li>
<li><p><strong>beta_type</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a>) – choice of slope component of erosion model
(<cite>‘sin’</cite> or <cite>‘tan’</cite>)</p></li>
<li><p><strong>varphi_type</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a>) – choice of flow component of erosion model
(<cite>‘ramp’</cite> or <cite>‘ramp-flat’</cite>)</p></li>
<li><p><strong>ibc_type</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a>) – choice of initial boundary shape
(<cite>‘convex-up’</cite> or <cite>‘concave-up’</cite>,
i.e., concave vs convex in mathematical parlance)</p></li>
<li><p><strong>do_raw</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)"><em>bool</em></a>) – suppress substitution of <span class="math notranslate nohighlight">\(eta\)</span> value
when defining <cite>xi_varphi_beta_eqn</cite>?</p></li>
<li><p><strong>do_idtx</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)"><em>bool</em></a>) – generate indicatrix and figuratrix equations?</p></li>
<li><p><strong>do_geodesic</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)"><em>bool</em></a>) – generate geodesic equations?</p></li>
<li><p><strong>do_nothing</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)"><em>bool</em></a>) – just create the class instance and set its data,
but don’t run any of the equation definition methods</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">GME</span> <span class="pre">equations</span></span></dt>
<dd><p>See below</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a> etc</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="gme.core.equations.Equations.define_Fstar_eqns">
<span class="sig-name descname"><span class="pre">define_Fstar_eqns</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#gme.core.equations.Equations.define_Fstar_eqns" title="Permalink to this definition">¶</a></dt>
<dd><p>Define the fundamental function</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.Okubo_Fstar_eqn">
<span class="sig-name descname"><span class="pre">Okubo_Fstar_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.Okubo_Fstar_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\dfrac{\sqrt{p_{x}^{2} + p_{z}^{2}}}{F^{*}} = \dfrac{p_{x}^{- \eta} \left(p_{x}^{2} + p_{z}^{2}\right)^{\frac{\eta}{2}}}{\varphi{\left(\mathbf{r} \right)}}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.Fstar_eqn">
<span class="sig-name descname"><span class="pre">Fstar_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.Fstar_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(F^{*} = p_{x}^{\eta} \left(p_{x}^{2} + p_{z}^{2}\right)^{\frac{1}{2} - \frac{\eta}{2}} \varphi{\left(\mathbf{r} \right)}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="gme.core.equations.Equations.define_H_eqns">
<span class="sig-name descname"><span class="pre">define_H_eqns</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#gme.core.equations.Equations.define_H_eqns" title="Permalink to this definition">¶</a></dt>
<dd><p>Define the Hamiltonian</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.H_eqn">
<span class="sig-name descname"><span class="pre">H_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.H_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(H = \dfrac{p_{x}^{2 \eta} \left(p_{x}^{2} + p_{z}^{2}\right)^{1 - \eta} \varphi^{2}{\left(\mathbf{r} \right)}}{2}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.H_varphi_rx_eqn">
<span class="sig-name descname"><span class="pre">H_varphi_rx_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.H_varphi_rx_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(H = \dfrac{\varphi_0^{2} p_{x}^{2 \eta} x_{1}^{- 4 \mu} \left(p_{x}^{2} + p_{z}^{2}\right)^{1 - \eta} \left(\varepsilon x_{1}^{2 \mu} + \left(x_{1} - {r}^x\right)^{2 \mu}\right)^{2}}{2}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="gme.core.equations.Equations.define_Hamiltons_eqns">
<span class="sig-name descname"><span class="pre">define_Hamiltons_eqns</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#gme.core.equations.Equations.define_Hamiltons_eqns" title="Permalink to this definition">¶</a></dt>
<dd><p>Define Hamilton’s equations</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.hamiltons_eqns">
<span class="sig-name descname"><span class="pre">hamiltons_eqns</span></span><a class="headerlink" href="#gme.core.equations.Equations.hamiltons_eqns" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\left[\begin{matrix}\
\dot{r}^x = \varphi_0^{2} p_{x}^{2 \eta - 1} x_{1}^{- 4 \mu} \left(p_{x}^{2} + p_{z}^{2}\right)^{- \eta} \left(\eta p_{z}^{2} + p_{x}^{2}\right)
\left(\varepsilon x_{1}^{2 \mu} + \left(x_{1} - {r}^x\right)^{2 \mu}\right)^{2}\\
\dot{r}^z = - \varphi_0^{2} p_{x}^{2 \eta} p_{z} x_{1}^{- 4 \mu} \left(\eta - 1\right) \left(p_{x}^{2} + p_{z}^{2}\right)^{- \eta}
\left(\varepsilon x_{1}^{2 \mu} + \left(x_{1} - {r}^x\right)^{2 \mu}\right)^{2}\\
\dot{p}_x = 2 \mu \varphi_0^{2} p_{x}^{2 \eta} x_{1}^{- 4 \mu} \left(p_{x}^{2} + p_{z}^{2}\right)^{1 - \eta} \left(x_{1} - {r}^x\right)^{2 \mu - 1}
\left(\varepsilon x_{1}^{2 \mu} + \left(x_{1} - {r}^x\right)^{2 \mu}\right)\\
\dot{p}_z = 0
\end{matrix}\right]\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/matrices/immutablematrices.html#sympy.matrices.immutable.ImmutableDenseMatrix" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Matrix</span></code></a> of <a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="gme.core.equations.Equations.define_g_eqns">
<span class="sig-name descname"><span class="pre">define_g_eqns</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#gme.core.equations.Equations.define_g_eqns" title="Permalink to this definition">¶</a></dt>
<dd><p>Define equations for the metric tensor <span class="math notranslate nohighlight">\(g\)</span> and its dual  <span class="math notranslate nohighlight">\(g^*\)</span></p>
<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.gstar_varphi_pxpz_eqn">
<span class="sig-name descname"><span class="pre">gstar_varphi_pxpz_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.gstar_varphi_pxpz_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(g^{*} = \left[\begin{matrix}\
\dfrac{2 p_{x}^{3} \varphi^{2}{\left(\mathbf{r} \right)}}{\left(p_{x}^{2} + p_{z}^{2}\right)^{\frac{3}{2}}} \
- \dfrac{3 p_{x}^{3} \left(p_{x}^{2} + \dfrac{3 p_{z}^{2}}{2}\right) \varphi^{2}{\left(\mathbf{r} \right)}}{\left(p_{x}^{2} + p_{z}^{2}\right)^{\frac{5}{2}}} \
+ \dfrac{2 p_{x} \left(p_{x}^{2} + \dfrac{3 p_{z}^{2}}{2}\right) \varphi^{2}{\left(\mathbf{r} \right)}}{\left(p_{x}^{2} + p_{z}^{2}\right)^{\frac{3}{2}}} \
&amp; \dfrac{3 p_{x}^{4} p_{z} \varphi^{2}{\left(\mathbf{r} \right)}}{2 \left(p_{x}^{2} + p_{z}^{2}\right)^{\frac{5}{2}}} \
- \dfrac{3 p_{x}^{2} p_{z} \varphi^{2}{\left(\mathbf{r} \right)}}{2 \left(p_{x}^{2} + p_{z}^{2}\right)^{\frac{3}{2}}}\\ \
\dfrac{3 p_{x}^{2} p_{z} \varphi^{2}{\left(\mathbf{r} \right)}}{\left(p_{x}^{2} + p_{z}^{2}\right)^{\frac{3}{2}}} \
- \dfrac{3 p_{x}^{2} p_{z} \left(p_{x}^{2} + \dfrac{3 p_{z}^{2}}{2}\right) \varphi^{2}{\left(\mathbf{r} \right)}}{\left(p_{x}^{2} + p_{z}^{2}\right)^{\frac{5}{2}}} \
&amp; \dfrac{3 p_{x}^{3} p_{z}^{2} \varphi^{2}{\left(\mathbf{r} \right)}}{2 \left(p_{x}^{2} + p_{z}^{2}\right)^{\frac{5}{2}}} \
- \dfrac{p_{x}^{3} \varphi^{2}{\left(\mathbf{r} \right)}}{2 \left(p_{x}^{2} + p_{z}^{2}\right)^{\frac{3}{2}}}\
\end{matrix}\right]\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.det_gstar_varphi_pxpz_eqn">
<span class="sig-name descname"><span class="pre">det_gstar_varphi_pxpz_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.det_gstar_varphi_pxpz_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\det\left(g^*\right) \
= \dfrac{p_{x}^{4} \left(- \dfrac{p_{x}^{2}}{2} \
+ \dfrac{3 p_{z}^{2}}{4}\right) \varphi^{4}{\left(\mathbf{r} \right)}}{p_{x}^{6} + 3 p_{x}^{4} p_{z}^{2} + 3 p_{x}^{2} p_{z}^{4} + p_{z}^{6}}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.g_varphi_pxpz_eqn">
<span class="sig-name descname"><span class="pre">g_varphi_pxpz_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.g_varphi_pxpz_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(g = \left[\begin{matrix}\
\dfrac{2 \left(p_{x}^{2} - 2 p_{z}^{2}\right) \sqrt{p_{x}^{2} + p_{z}^{2}}}{p_{x} \left(2 p_{x}^{2} - 3 p_{z}^{2}\right) \varphi^{2}{\left(\mathbf{r} \right)}} \
&amp; - \dfrac{6 p_{z}^{3} \sqrt{p_{x}^{2} + p_{z}^{2}}}{p_{x}^{2} \left(2 p_{x}^{2} - 3 p_{z}^{2}\right) \varphi^{2}{\left(\mathbf{r} \right)}}\\ \
- \dfrac{6 p_{z}^{3} \sqrt{p_{x}^{2} + p_{z}^{2}}}{p_{x}^{2} \left(2 p_{x}^{2} - 3 p_{z}^{2}\right) \varphi^{2}{\left(\mathbf{r} \right)}} \
&amp; - \dfrac{4 p_{x}^{6} + 14 p_{x}^{4} p_{z}^{2} + 22 p_{x}^{2} p_{z}^{4} + 12 p_{z}^{6}}{p_{x}^{3} \sqrt{p_{x}^{2} + p_{z}^{2}} \left(2 p_{x}^{2} - 3 p_{z}^{2}\right) \varphi^{2}{\left(\mathbf{r} \right)}}\
\end{matrix}\right]\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.gstar_eigen_varphi_pxpz">
<span class="sig-name descname"><span class="pre">gstar_eigen_varphi_pxpz</span></span><a class="headerlink" href="#gme.core.equations.Equations.gstar_eigen_varphi_pxpz" title="Permalink to this definition">¶</a></dt>
<dd><p>eigenvalues and eigenvectors of <span class="math notranslate nohighlight">\(g^{*}\)</span> in one object</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>list of <a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.expr.Expr" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Expr</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.gstar_eigenvalues">
<span class="sig-name descname"><span class="pre">gstar_eigenvalues</span></span><a class="headerlink" href="#gme.core.equations.Equations.gstar_eigenvalues" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\left[\begin{matrix}\
\dfrac{\varphi_0^{2} p_{x} x_{1}^{- 4 \mu} \left(\varepsilon x_{1}^{2 \mu} + \left(x_{1} - {r}^x\right)^{2 \mu}\right)^{2} \left(- 3 \left(p_{x}^{2} + p_{z}^{2}\right) \sqrt{p_{x}^{12} + 4 p_{x}^{10} p_{z}^{2} + 10 p_{x}^{8} p_{z}^{4} + 20 p_{x}^{6} p_{z}^{6} + 25 p_{x}^{4} p_{z}^{8} + 16 p_{x}^{2} p_{z}^{10} + 4 p_{z}^{12}} + \left(p_{x}^{2} + 6 p_{z}^{2}\right) \left(p_{x}^{6} + 3 p_{x}^{4} p_{z}^{2} + 3 p_{x}^{2} p_{z}^{4} + p_{z}^{6}\right)\right)}{4 \left(p_{x}^{2} + p_{z}^{2}\right)^{\frac{3}{2}} \left(p_{x}^{6} + 3 p_{x}^{4} p_{z}^{2} + 3 p_{x}^{2} p_{z}^{4} + p_{z}^{6}\right)}\\\
\dfrac{\varphi_0^{2} p_{x} x_{1}^{- 4 \mu} \left(\varepsilon x_{1}^{2 \mu} + \left(x_{1} - {r}^x\right)^{2 \mu}\right)^{2} \left(3 \left(p_{x}^{2} + p_{z}^{2}\right) \sqrt{p_{x}^{12} + 4 p_{x}^{10} p_{z}^{2} + 10 p_{x}^{8} p_{z}^{4} + 20 p_{x}^{6} p_{z}^{6} + 25 p_{x}^{4} p_{z}^{8} + 16 p_{x}^{2} p_{z}^{10} + 4 p_{z}^{12}} + \left(p_{x}^{2} + 6 p_{z}^{2}\right) \left(p_{x}^{6} + 3 p_{x}^{4} p_{z}^{2} + 3 p_{x}^{2} p_{z}^{4} + p_{z}^{6}\right)\right)}{4 \left(p_{x}^{2} + p_{z}^{2}\right)^{\frac{3}{2}} \left(p_{x}^{6} + 3 p_{x}^{4} p_{z}^{2} + 3 p_{x}^{2} p_{z}^{4} + p_{z}^{6}\right)}\
\end{matrix}\right]\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/matrices/immutablematrices.html#sympy.matrices.immutable.ImmutableDenseMatrix" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Matrix</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.gstar_eigenvectors">
<span class="sig-name descname"><span class="pre">gstar_eigenvectors</span></span><a class="headerlink" href="#gme.core.equations.Equations.gstar_eigenvectors" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\left[\
\begin{matrix}\dfrac{p_{x} p_{z}^{3} \left(p_{x}^{6} + 2 p_{x}^{4} p_{z}^{2} + 3 p_{x}^{2} p_{z}^{4} + 2 p_{z}^{6} + \sqrt{p_{x}^{12} + 4 p_{x}^{10} p_{z}^{2} + 10 p_{x}^{8} p_{z}^{4} + 20 p_{x}^{6} p_{z}^{6} + 25 p_{x}^{4} p_{z}^{8} + 16 p_{x}^{2} p_{z}^{10} + 4 p_{z}^{12}}\right)}{p_{x}^{10} + 3 p_{x}^{8} p_{z}^{2} + 7 p_{x}^{6} p_{z}^{4} + 11 p_{x}^{4} p_{z}^{6} + p_{x}^{4} \sqrt{p_{x}^{12} + 4 p_{x}^{10} p_{z}^{2} + 10 p_{x}^{8} p_{z}^{4} + 20 p_{x}^{6} p_{z}^{6} + 25 p_{x}^{4} p_{z}^{8} + 16 p_{x}^{2} p_{z}^{10} + 4 p_{z}^{12}} + 10 p_{x}^{2} p_{z}^{8} + p_{x}^{2} p_{z}^{2} \sqrt{p_{x}^{12} + 4 p_{x}^{10} p_{z}^{2} + 10 p_{x}^{8} p_{z}^{4} + 20 p_{x}^{6} p_{z}^{6} + 25 p_{x}^{4} p_{z}^{8} + 16 p_{x}^{2} p_{z}^{10} + 4 p_{z}^{12}} + 4 p_{z}^{10} + 2 p_{z}^{4} \sqrt{p_{x}^{12} + 4 p_{x}^{10} p_{z}^{2} + 10 p_{x}^{8} p_{z}^{4} + 20 p_{x}^{6} p_{z}^{6} + 25 p_{x}^{4} p_{z}^{8} + 16 p_{x}^{2} p_{z}^{10} + 4 p_{z}^{12}}}\\ \
1 \
\end{matrix}\
\right] \\ \
\left[\
\begin{matrix}\dfrac{p_{x} p_{z}^{3} \left(p_{x}^{6} + 2 p_{x}^{4} p_{z}^{2} + 3 p_{x}^{2} p_{z}^{4} + 2 p_{z}^{6} - \sqrt{p_{x}^{12} + 4 p_{x}^{10} p_{z}^{2} + 10 p_{x}^{8} p_{z}^{4} + 20 p_{x}^{6} p_{z}^{6} + 25 p_{x}^{4} p_{z}^{8} + 16 p_{x}^{2} p_{z}^{10} + 4 p_{z}^{12}}\right)}{p_{x}^{10} + 3 p_{x}^{8} p_{z}^{2} + 7 p_{x}^{6} p_{z}^{4} + 11 p_{x}^{4} p_{z}^{6} - p_{x}^{4} \sqrt{p_{x}^{12} + 4 p_{x}^{10} p_{z}^{2} + 10 p_{x}^{8} p_{z}^{4} + 20 p_{x}^{6} p_{z}^{6} + 25 p_{x}^{4} p_{z}^{8} + 16 p_{x}^{2} p_{z}^{10} + 4 p_{z}^{12}} + 10 p_{x}^{2} p_{z}^{8} - p_{x}^{2} p_{z}^{2} \sqrt{p_{x}^{12} + 4 p_{x}^{10} p_{z}^{2} + 10 p_{x}^{8} p_{z}^{4} + 20 p_{x}^{6} p_{z}^{6} + 25 p_{x}^{4} p_{z}^{8} + 16 p_{x}^{2} p_{z}^{10} + 4 p_{z}^{12}} + 4 p_{z}^{10} - 2 p_{z}^{4} \sqrt{p_{x}^{12} + 4 p_{x}^{10} p_{z}^{2} + 10 p_{x}^{8} p_{z}^{4} + 20 p_{x}^{6} p_{z}^{6} + 25 p_{x}^{4} p_{z}^{8} + 16 p_{x}^{2} p_{z}^{10} + 4 p_{z}^{12}}}\\ \
1 \
\end{matrix}\right]\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>list containing pair of <a class="reference external" href="https://docs.sympy.org/latest/modules/matrices/immutablematrices.html#sympy.matrices.immutable.ImmutableDenseMatrix" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Matrix</span></code></a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="gme.core.equations.Equations.define_geodesic_eqns">
<span class="sig-name descname"><span class="pre">define_geodesic_eqns</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#gme.core.equations.Equations.define_geodesic_eqns" title="Permalink to this definition">¶</a></dt>
<dd><p>Define geodesic equations</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>parameters</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.10)"><em>dict</em></a>) – dictionary of model parameter values to be used for equation substitutions</p>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.dg_rk_ij_mat">
<span class="sig-name descname"><span class="pre">dg_rk_ij_mat</span></span><a class="headerlink" href="#gme.core.equations.Equations.dg_rk_ij_mat" title="Permalink to this definition">¶</a></dt>
<dd><p>Derivatives of the components of the metric tensor:
these values are used to construct the Christoffel tensor.
Too unwieldy to display here.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/matrices/immutablematrices.html#sympy.matrices.immutable.ImmutableDenseMatrix" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.ImmutableDenseMatrix</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.christoffel_ij_k_rx_rdot_lambda">
<span class="sig-name descname"><span class="pre">christoffel_ij_k_rx_rdot_lambda</span></span><a class="headerlink" href="#gme.core.equations.Equations.christoffel_ij_k_rx_rdot_lambda" title="Permalink to this definition">¶</a></dt>
<dd><p>The Christoffel tensor coefficients, as a <cite>lambda</cite> function,
for each component <span class="math notranslate nohighlight">\(r^x\)</span>, <span class="math notranslate nohighlight">\({\dot{r}^x}\)</span> and <span class="math notranslate nohighlight">\({\dot{r}^z}\)</span>.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>function</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.christoffel_ij_k_lambda">
<span class="sig-name descname"><span class="pre">christoffel_ij_k_lambda</span></span><a class="headerlink" href="#gme.core.equations.Equations.christoffel_ij_k_lambda" title="Permalink to this definition">¶</a></dt>
<dd><p>The Christoffel tensor coefficients, as a <cite>lambda</cite> function, in a compact and indexable form.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>function</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.geodesic_eqns">
<span class="sig-name descname"><span class="pre">geodesic_eqns</span></span><a class="headerlink" href="#gme.core.equations.Equations.geodesic_eqns" title="Permalink to this definition">¶</a></dt>
<dd><p>Ray geodesic equations, but expressed indirectly as a pair of coupled 1st-order vector ODEs
rather than a 2nd-order vector ODE for ray acceleration.
The 1st-order ODE form is easier to solve numerically.</p>
<p><span class="math notranslate nohighlight">\(\dot{r}^x = v^{x}\)</span></p>
<p><span class="math notranslate nohighlight">\(\dot{r}^z = v^{z}\)</span></p>
<p><span class="math notranslate nohighlight">\(\dot{v}^x = \dots\)</span></p>
<p><span class="math notranslate nohighlight">\(\dot{v}^z = \dots\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>list of <a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.vdotx_lambdified">
<span class="sig-name descname"><span class="pre">vdotx_lambdified</span></span><a class="headerlink" href="#gme.core.equations.Equations.vdotx_lambdified" title="Permalink to this definition">¶</a></dt>
<dd><p>lambdified version of <span class="math notranslate nohighlight">\(\dot{v}^x\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>function</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.vdotz_lambdified">
<span class="sig-name descname"><span class="pre">vdotz_lambdified</span></span><a class="headerlink" href="#gme.core.equations.Equations.vdotz_lambdified" title="Permalink to this definition">¶</a></dt>
<dd><p>lambdified version of <span class="math notranslate nohighlight">\(\dot{v}^z\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>function</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="gme.core.equations.Equations.define_ibc_eqns">
<span class="sig-name descname"><span class="pre">define_ibc_eqns</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#gme.core.equations.Equations.define_ibc_eqns" title="Permalink to this definition">¶</a></dt>
<dd><p>Define initial profile equations</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.boundary_eqns">
<span class="sig-name descname"><span class="pre">boundary_eqns</span></span><a class="headerlink" href="#gme.core.equations.Equations.boundary_eqns" title="Permalink to this definition">¶</a></dt>
<dd><dl>
<dt>‘planar’:</dt><dd><p>‘h’: <span class="math notranslate nohighlight">\(h = \dfrac{h_{0} x}{x_{1}}\)</span></p>
<p>‘gradh’: <span class="math notranslate nohighlight">\(\dfrac{d}{d x} h{\left(x \right)} = \dfrac{h_{0}}{x_{1}}\)</span></p>
</dd>
<dt>‘convex-up’:</dt><dd><p>‘h’: <span class="math notranslate nohighlight">\(h = \dfrac{h_{0} \tanh{\left(\dfrac{\kappa_\mathrm{h} x}{x_{1}} \right)}}{\tanh{\left(\dfrac{\kappa_\mathrm{h}}{x_{1}} \right)}}\)</span></p>
<p>‘gradh’: <span class="math notranslate nohighlight">\(\dfrac{d}{d x} h{\left(x \right)} = \dfrac{\kappa_\mathrm{h} h_{0} \left(1 - \tanh^{2}{\left(\dfrac{\kappa_\mathrm{h} x}{x_{1}} \right)}\right)}{x_{1} \tanh{\left(\dfrac{\kappa_\mathrm{h}}{x_{1}} \right)}}\)</span></p>
</dd>
<dt>‘concave-up’:</dt><dd><p>‘h’: <span class="math notranslate nohighlight">\(h = h_{0} \left(1 + \dfrac{\tanh{\left(\dfrac{\kappa_\mathrm{h} x}{x_{1}} - \kappa_\mathrm{h} \right)}}{\tanh{\left(\dfrac{\kappa_\mathrm{h}}{x_{1}} \right)}}\right)\)</span></p>
<p>‘gradh’: <span class="math notranslate nohighlight">\(\dfrac{d}{d x} h{\left(x \right)} = \dfrac{\kappa_\mathrm{h} h_{0} \left(1 - \tanh^{2}{\left(\dfrac{\kappa_\mathrm{h} x}{x_{1}} - \kappa_\mathrm{h} \right)}\right)}{x_{1} \tanh{\left(\dfrac{\kappa_\mathrm{h}}{x_{1}} \right)}}\)</span></p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><cite>dict</cite> of <a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="gme.core.equations.Equations.define_idtx_fgtx_eqns">
<span class="sig-name descname"><span class="pre">define_idtx_fgtx_eqns</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#gme.core.equations.Equations.define_idtx_fgtx_eqns" title="Permalink to this definition">¶</a></dt>
<dd><p>Define indicatrix and figuratrix equations</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.pz_cosbeta_varphi_eqn">
<span class="sig-name descname"><span class="pre">pz_cosbeta_varphi_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.pz_cosbeta_varphi_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(p_{z}^{4} = \dfrac{\cos^{4}{\left(\beta \right)}}{\varphi^{4} \left(1 - \cos^{2}{\left(\beta \right)}\right)^{3}}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.cosbetasqrd_pz_varphi_solns">
<span class="sig-name descname"><span class="pre">cosbetasqrd_pz_varphi_solns</span></span><a class="headerlink" href="#gme.core.equations.Equations.cosbetasqrd_pz_varphi_solns" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\left[
-\frac{ \left(  -6 \varphi^{4} p_{z}^{4} \sqrt[3]{27 \varphi^{8} p_{z}^{8} - 18 \varphi^{4} p_{z}^{4}
+ \sqrt{729 \varphi^{16} p_{z}^{16} - 108 \varphi^{12} p_{z}^{12}} + 2} - 12 \sqrt[3]{2} \varphi^{4} p_{z}^{4}
+ 2^{\frac{2}{3}} \left(27 \varphi^{8} p_{z}^{8} - 18 \varphi^{4} p_{z}^{4}
+ \sqrt{729 \varphi^{16} p_{z}^{16} - 108 \varphi^{12} p_{z}^{12}} + 2\right)^{\frac{2}{3}}
+ 2 \sqrt[3]{27 \varphi^{8} p_{z}^{8} - 18 \varphi^{4} p_{z}^{4} + \sqrt{729 \varphi^{16} p_{z}^{16}
- 108 \varphi^{12} p_{z}^{12}} + 2} + 2 \sqrt[3]{2} \right)
}{6 \varphi^{4} p_{z}^{4} \sqrt[3]{27 \varphi^{8} p_{z}^{8}
- 18 \varphi^{4} p_{z}^{4} + \sqrt{729 \varphi^{16} p_{z}^{16} - 108 \varphi^{12} p_{z}^{12}} + 2}}
,\dots \right]\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>list of <a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.expr.Expr" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Expr</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.fgtx_cossqrdbeta_pz_varphi_eqn">
<span class="sig-name descname"><span class="pre">fgtx_cossqrdbeta_pz_varphi_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.fgtx_cossqrdbeta_pz_varphi_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\cos^{2}{\left(\beta \right)}
= - \frac{- 6 \varphi^{4} p_{z}^{4} \sqrt[3]{27 \varphi^{8} p_{z}^{8} - 18 \varphi^{4} p_{z}^{4}
+ \sqrt{729 \varphi^{16} p_{z}^{16} - 108 \varphi^{12} p_{z}^{12}} + 2} - 12 \sqrt[3]{2} \varphi^{4} p_{z}^{4}
+ 2^{\frac{2}{3}} \left(27 \varphi^{8} p_{z}^{8} - 18 \varphi^{4} p_{z}^{4} + \sqrt{729 \varphi^{16} p_{z}^{16}
- 108 \varphi^{12} p_{z}^{12}} + 2\right)^{\frac{2}{3}} + 2 \sqrt[3]{27 \varphi^{8} p_{z}^{8}
- 18 \varphi^{4} p_{z}^{4} + \sqrt{729 \varphi^{16} p_{z}^{16} - 108 \varphi^{12} p_{z}^{12}} + 2}
+ 2 \sqrt[3]{2}}{6 \varphi^{4} p_{z}^{4} \sqrt[3]{27 \varphi^{8} p_{z}^{8} - 18 \varphi^{4} p_{z}^{4}
+ \sqrt{729 \varphi^{16} p_{z}^{16} - 108 \varphi^{12} p_{z}^{12}} + 2}}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.fgtx_tanbeta_pz_varphi_eqn">
<span class="sig-name descname"><span class="pre">fgtx_tanbeta_pz_varphi_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.fgtx_tanbeta_pz_varphi_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\tan{\left(\beta \right)}
= \sqrt{\frac{- 12 \sqrt[3]{2} \varphi^{4} p_{z}^{4} + 2^{\frac{2}{3}} \left(27 \varphi^{8} p_{z}^{8}
- 18 \varphi^{4} p_{z}^{4} + \sqrt{729 \varphi^{16} p_{z}^{16} - 108 \varphi^{12} p_{z}^{12}} + 2\right)^{\frac{2}{3}}
+ 2 \sqrt[3]{27 \varphi^{8} p_{z}^{8} - 18 \varphi^{4} p_{z}^{4} + \sqrt{729 \varphi^{16} p_{z}^{16}
- 108 \varphi^{12} p_{z}^{12}} + 2} + 2 \sqrt[3]{2}}{6 \varphi^{4} p_{z}^{4} \sqrt[3]{27 \varphi^{8} p_{z}^{8}
- 18 \varphi^{4} p_{z}^{4} + \sqrt{729 \varphi^{16} p_{z}^{16} - 108 \varphi^{12} p_{z}^{12}} + 2}
+ 12 \sqrt[3]{2} \varphi^{4} p_{z}^{4} - 2^{\frac{2}{3}} \left(27 \varphi^{8} p_{z}^{8}
- 18 \varphi^{4} p_{z}^{4} + \sqrt{729 \varphi^{16} p_{z}^{16} - 108 \varphi^{12} p_{z}^{12}} + 2\right)^{\frac{2}{3}}
- 2 \sqrt[3]{27 \varphi^{8} p_{z}^{8} - 18 \varphi^{4} p_{z}^{4} + \sqrt{729 \varphi^{16} p_{z}^{16}
- 108 \varphi^{12} p_{z}^{12}} + 2} - 2 \sqrt[3]{2}}}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.fgtx_px_pz_varphi_eqn">
<span class="sig-name descname"><span class="pre">fgtx_px_pz_varphi_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.fgtx_px_pz_varphi_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(p_{x}
= - p_{z} \sqrt{\frac{- 12 \sqrt[3]{2} \varphi^{4} p_{z}^{4} + 2^{\frac{2}{3}} \left(27 \varphi^{8} p_{z}^{8}
- 18 \varphi^{4} p_{z}^{4} + \sqrt{729 \varphi^{16} p_{z}^{16} - 108 \varphi^{12} p_{z}^{12}} + 2\right)^{\frac{2}{3}}
+ 2 \sqrt[3]{27 \varphi^{8} p_{z}^{8} - 18 \varphi^{4} p_{z}^{4} + \sqrt{729 \varphi^{16} p_{z}^{16}
- 108 \varphi^{12} p_{z}^{12}} + 2} + 2 \sqrt[3]{2}}{6 \varphi^{4} p_{z}^{4} \sqrt[3]{27 \varphi^{8} p_{z}^{8}
- 18 \varphi^{4} p_{z}^{4} + \sqrt{729 \varphi^{16} p_{z}^{16} - 108 \varphi^{12} p_{z}^{12}} + 2}
+ 12 \sqrt[3]{2} \varphi^{4} p_{z}^{4} - 2^{\frac{2}{3}} \left(27 \varphi^{8} p_{z}^{8}
- 18 \varphi^{4} p_{z}^{4} + \sqrt{729 \varphi^{16} p_{z}^{16} - 108 \varphi^{12} p_{z}^{12}} + 2\right)^{\frac{2}{3}}
- 2 \sqrt[3]{27 \varphi^{8} p_{z}^{8} - 18 \varphi^{4} p_{z}^{4} + \sqrt{729 \varphi^{16} p_{z}^{16}
- 108 \varphi^{12} p_{z}^{12}} + 2} - 2 \sqrt[3]{2}}}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.idtx_rdotx_pz_varphi_eqn">
<span class="sig-name descname"><span class="pre">idtx_rdotx_pz_varphi_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.idtx_rdotx_pz_varphi_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\({r}^x = \dfrac{\sqrt{6} \left(- 81 \cdot 2^{\frac{2}{3}} \varphi^{12} p_{z}^{12} \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} - 378 \varphi^{12} p_{z}^{12} - 9 \cdot 2^{\frac{2}{3}} \sqrt{3} \varphi^{10} p_{z}^{10} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} - 42 \sqrt{3} \varphi^{10} p_{z}^{10} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} + 45 \sqrt[3]{2} \varphi^{8} p_{z}^{8} \left(27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2\right)^{\frac{2}{3}} + 96 \cdot 2^{\frac{2}{3}} \varphi^{8} p_{z}^{8} \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} + 306 \varphi^{8} p_{z}^{8} + \sqrt[3]{2} \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} \left(27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2\right)^{\frac{2}{3}} + 2 \cdot 2^{\frac{2}{3}} \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} + 6 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 20 \sqrt[3]{2} \varphi^{4} p_{z}^{4} \left(27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2\right)^{\frac{2}{3}} - 26 \cdot 2^{\frac{2}{3}} \varphi^{4} p_{z}^{4} \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} - 64 \varphi^{4} p_{z}^{4} + 2 \sqrt[3]{2} \left(27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2\right)^{\frac{2}{3}} + 2 \cdot 2^{\frac{2}{3}} \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} + 4\right)}{72 \varphi^{4} p_{z}^{5} \left(\frac{\sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2}}{6 \varphi^{4} p_{z}^{4} \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} + 12 \sqrt[3]{2} \varphi^{4} p_{z}^{4} - 2^{\frac{2}{3}} \left(27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2\right)^{\frac{2}{3}} - 2 \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} - 2 \sqrt[3]{2}}\right)^{\frac{3}{2}} \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} \left(- 54 \cdot 2^{\frac{2}{3}} \varphi^{12} p_{z}^{12} - 6 \cdot 2^{\frac{2}{3}} \sqrt{3} \varphi^{10} p_{z}^{10} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} + 6 \varphi^{8} p_{z}^{8} \left(27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2\right)^{\frac{2}{3}} + 33 \sqrt[3]{2} \varphi^{8} p_{z}^{8} \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} + 78 \cdot 2^{\frac{2}{3}} \varphi^{8} p_{z}^{8} + \sqrt[3]{2} \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} + 2 \cdot 2^{\frac{2}{3}} \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 12 \varphi^{4} p_{z}^{4} \left(27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2\right)^{\frac{2}{3}} - 18 \sqrt[3]{2} \varphi^{4} p_{z}^{4} \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} - 24 \cdot 2^{\frac{2}{3}} \varphi^{4} p_{z}^{4} + 2 \left(27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2\right)^{\frac{2}{3}} + 2 \sqrt[3]{2} \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} + 2 \cdot 2^{\frac{2}{3}}\right)}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.idtx_rdotz_pz_varphi_eqn">
<span class="sig-name descname"><span class="pre">idtx_rdotz_pz_varphi_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.idtx_rdotz_pz_varphi_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\({r}^z = \dfrac{\sqrt{6} \sqrt{\frac{- 12 \sqrt[3]{2} \varphi^{4} p_{z}^{4} + 2^{\frac{2}{3}} \left(27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2\right)^{\frac{2}{3}} + 2 \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} + 2 \sqrt[3]{2}}{6 \varphi^{4} p_{z}^{4} \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} + 12 \sqrt[3]{2} \varphi^{4} p_{z}^{4} - 2^{\frac{2}{3}} \left(27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2\right)^{\frac{2}{3}} - 2 \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} - 2 \sqrt[3]{2}}} \left(27 \cdot 2^{\frac{2}{3}} \varphi^{8} p_{z}^{8} + 3 \cdot 2^{\frac{2}{3}} \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 12 \sqrt[3]{2} \varphi^{4} p_{z}^{4} \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} - 18 \cdot 2^{\frac{2}{3}} \varphi^{4} p_{z}^{4} + 2 \left(27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2\right)^{\frac{2}{3}} + 2 \sqrt[3]{2} \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} + 2 \cdot 2^{\frac{2}{3}}\right)}{72 \varphi^{4} p_{z}^{5} \left(\frac{\sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2}}{6 \varphi^{4} p_{z}^{4} \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} + 12 \sqrt[3]{2} \varphi^{4} p_{z}^{4} - 2^{\frac{2}{3}} \left(27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2\right)^{\frac{2}{3}} - 2 \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} - 2 \sqrt[3]{2}}\right)^{\frac{3}{2}} \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} \left(- 6 \varphi^{4} p_{z}^{4} \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} - 12 \sqrt[3]{2} \varphi^{4} p_{z}^{4} + 2^{\frac{2}{3}} \left(27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2\right)^{\frac{2}{3}} + 2 \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} + 2 \sqrt[3]{2}\right)}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="gme.core.equations.Equations.define_nodimensionalized_Hamiltons_eqns">
<span class="sig-name descname"><span class="pre">define_nodimensionalized_Hamiltons_eqns</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#gme.core.equations.Equations.define_nodimensionalized_Hamiltons_eqns" title="Permalink to this definition">¶</a></dt>
<dd><p>TBD</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="gme.core.equations.Equations.define_p_eqns">
<span class="sig-name descname"><span class="pre">define_p_eqns</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#gme.core.equations.Equations.define_p_eqns" title="Permalink to this definition">¶</a></dt>
<dd><p>Define normal slowness <span class="math notranslate nohighlight">\(p\)</span> and derive related equations</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.p_covec_eqn">
<span class="sig-name descname"><span class="pre">p_covec_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.p_covec_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\mathbf{\widetilde{p}} := [p_x, p_z]\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.px_p_beta_eqn">
<span class="sig-name descname"><span class="pre">px_p_beta_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.px_p_beta_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(p_x = p \sin\beta\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.pz_p_beta_eqn">
<span class="sig-name descname"><span class="pre">pz_p_beta_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.pz_p_beta_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(p_z = p \cos\beta\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.p_norm_pxpz_eqn">
<span class="sig-name descname"><span class="pre">p_norm_pxpz_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.p_norm_pxpz_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(p = \sqrt{p_x^2+p_z^2}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.tanbeta_pxpz_eqn">
<span class="sig-name descname"><span class="pre">tanbeta_pxpz_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.tanbeta_pxpz_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\tan\beta = -\dfrac{p_x}{p_z}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.sinbeta_pxpz_eqn">
<span class="sig-name descname"><span class="pre">sinbeta_pxpz_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.sinbeta_pxpz_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\sin\beta = \dfrac{p_x}{\sqrt{p_x^2+p_z^2}}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.cosbeta_pxpz_eqn">
<span class="sig-name descname"><span class="pre">cosbeta_pxpz_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.cosbeta_pxpz_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\cos\beta = \dfrac{-p_z}{\sqrt{p_x^2+p_z^2}}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.pz_px_tanbeta_eqn">
<span class="sig-name descname"><span class="pre">pz_px_tanbeta_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.pz_px_tanbeta_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(p_z = -\dfrac{p_x}{\tan\beta}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.px_pz_tanbeta_eqn">
<span class="sig-name descname"><span class="pre">px_pz_tanbeta_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.px_pz_tanbeta_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(p_x = -{p_z}{\tan\beta}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.p_pz_cosbeta_eqn">
<span class="sig-name descname"><span class="pre">p_pz_cosbeta_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.p_pz_cosbeta_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(p = -\dfrac{p_z}{\cos\beta}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="gme.core.equations.Equations.define_pdot_eqns">
<span class="sig-name descname"><span class="pre">define_pdot_eqns</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#gme.core.equations.Equations.define_pdot_eqns" title="Permalink to this definition">¶</a></dt>
<dd><p>Define equations for <span class="math notranslate nohighlight">\(\dot{p}\)</span>, the rate of change of normal slowness</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.pdotx_pxpz_eqn">
<span class="sig-name descname"><span class="pre">pdotx_pxpz_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.pdotx_pxpz_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\dot{p}_x = 2 \mu \varphi_0^{2} p_{x}^{2 \eta} x_{1}^{- 4 \mu} \left(p_{x}^{2} + p_{z}^{2}\right)^{1 - \eta}
\left(x_{1} - {r}^x\right)^{2 \mu - 1} \left(\varepsilon x_{1}^{2 \mu} + \left(x_{1} - {r}^x\right)^{2 \mu}\right)\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.pdotz_pxpz_eqn">
<span class="sig-name descname"><span class="pre">pdotz_pxpz_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.pdotz_pxpz_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\dot{p}_z = 0\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.pdot_covec_eqn">
<span class="sig-name descname"><span class="pre">pdot_covec_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.pdot_covec_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\mathbf{\dot{\widetilde{p}}} = \left[\begin{matrix}2 \mu \varphi_0^{2} p_{x}^{2 \eta} x_{1}^{- 4 \mu}
\left(p_{x}^{2} + p_{z}^{2}\right)^{1 - \eta} \left(x_{1} - {r}^x\right)^{2 \mu - 1}
\left(\varepsilon x_{1}^{2 \mu} + \left(x_{1} - {r}^x\right)^{2 \mu}\right) &amp; 0\end{matrix}\right]\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="gme.core.equations.Equations.define_psi_eqns">
<span class="sig-name descname"><span class="pre">define_psi_eqns</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#gme.core.equations.Equations.define_psi_eqns" title="Permalink to this definition">¶</a></dt>
<dd><p>Define equations for anisotropy angle <span class="math notranslate nohighlight">\(\psi)\)</span></p>
<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.psi_alpha_beta_eqn">
<span class="sig-name descname"><span class="pre">psi_alpha_beta_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.psi_alpha_beta_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\tan{\left(\beta \right)} = \dfrac{\xi^{\downarrow} + v^{z}}{v^{x}}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="gme.core.equations.Equations.define_px_poly_eqn">
<span class="sig-name descname"><span class="pre">define_px_poly_eqn</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">eta_choice</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_ndim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#gme.core.equations.Equations.define_px_poly_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p>TODO: remove ref to xiv_0</p>
<p>Define polynomial form of function combining normal-slowness covector components <span class="math notranslate nohighlight">\((p_x,p_z)\)</span>
(where the latter is given in terms of the vertical erosion rate <span class="math notranslate nohighlight">\(\xi^{\downarrow} = -\dfrac{1}{p_z}\)</span>)
and the erosion model flow component <span class="math notranslate nohighlight">\(\varphi(\mathbf{r})\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>eta_choice</strong> (<a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.numbers.Rational" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Rational</span></code></a>) – value of <span class="math notranslate nohighlight">\(\eta\)</span> to use instead value given at instantiation; otherwise the latter value is used</p>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.poly_px_xiv_varphi_eqn">
<span class="sig-name descname"><span class="pre">poly_px_xiv_varphi_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.poly_px_xiv_varphi_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\operatorname{Poly}{\left( \left(\xi^{\downarrow}\right)^{4} \varphi^{4}{\left(\mathbf{r} \right)} p_{x}^{6}
-  \left(\xi^{\downarrow}\right)^{4} p_{x}^{2} -  \left(\xi^{\downarrow}\right)^{2}, p_{x},
domain=\mathbb{Z}\left[\varphi{\left(\mathbf{r} \right)}, \xi^{\downarrow}\right] \right)}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/polys/reference.html#sympy.polys.polytools.Poly" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Poly</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.poly_px_xiv_eqn">
<span class="sig-name descname"><span class="pre">poly_px_xiv_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.poly_px_xiv_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\varphi_0^{4} \left(\xi^{\downarrow{0}}\right)^{4} p_{x}^{6} \left(\varepsilon
+ \left(\frac{x_{1} - {r}^x}{x_{1}}\right)^{2 \mu}\right)^{4}
- \left(\xi^{\downarrow{0}}\right)^{4} p_{x}^{2}
- \left(\xi^{\downarrow{0}}\right)^{2} = 0\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="gme.core.equations.Equations.define_r_eqns">
<span class="sig-name descname"><span class="pre">define_r_eqns</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#gme.core.equations.Equations.define_r_eqns" title="Permalink to this definition">¶</a></dt>
<dd><p>Define equations for ray position <span class="math notranslate nohighlight">\(\vec{r}\)</span></p>
<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.rx_r_alpha_eqn">
<span class="sig-name descname"><span class="pre">rx_r_alpha_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.rx_r_alpha_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(r^x = r\cos\alpha\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.rz_r_alpha_eqn">
<span class="sig-name descname"><span class="pre">rz_r_alpha_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.rz_r_alpha_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(r^z = r\sin\alpha\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="gme.core.equations.Equations.define_rdot_eqns">
<span class="sig-name descname"><span class="pre">define_rdot_eqns</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#gme.core.equations.Equations.define_rdot_eqns" title="Permalink to this definition">¶</a></dt>
<dd><p>Define equations for <span class="math notranslate nohighlight">\(\dot{r}\)</span>, the rate of change of position</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.rdotx_rdot_alpha_eqn">
<span class="sig-name descname"><span class="pre">rdotx_rdot_alpha_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.rdotx_rdot_alpha_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(v^{x} = v \cos{\left(\alpha \right)}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.rdotz_rdot_alpha_eqn">
<span class="sig-name descname"><span class="pre">rdotz_rdot_alpha_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.rdotz_rdot_alpha_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(v^{z} = v \sin{\left(\alpha \right)}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.rdotx_pxpz_eqn">
<span class="sig-name descname"><span class="pre">rdotx_pxpz_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.rdotx_pxpz_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(v^{x} = p_{x}^{2 \eta - 1} \left(p_{x}^{2} + p_{z}^{2}\right)^{- \eta} \left(\eta p_{z}^{2} + p_{x}^{2}\right) \varphi^{2}{\left(\mathbf{r} \right)}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.rdotz_pxpz_eqn">
<span class="sig-name descname"><span class="pre">rdotz_pxpz_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.rdotz_pxpz_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(v^{z} = - p_{x}^{2 \eta} p_{z} \left(\eta - 1\right) \left(p_{x}^{2} + p_{z}^{2}\right)^{- \eta} \varphi^{2}{\left(\mathbf{r} \right)}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.rdotz_on_rdotx_eqn">
<span class="sig-name descname"><span class="pre">rdotz_on_rdotx_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.rdotz_on_rdotx_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\dfrac{v^{z}}{v^{x}} = - \dfrac{p_{x} p_{z} \left(\eta - 1\right)}{\eta p_{z}^{2} + p_{x}^{2}}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.rdotz_on_rdotx_tanbeta_eqn">
<span class="sig-name descname"><span class="pre">rdotz_on_rdotx_tanbeta_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.rdotz_on_rdotx_tanbeta_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\dfrac{v^{z}}{v^{x}} =   \dfrac{\left(\eta - 1\right) \tan{\left(\beta \right)}}{\eta + \tan^{2}{\left(\beta \right)}}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.rdot_vec_eqn">
<span class="sig-name descname"><span class="pre">rdot_vec_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.rdot_vec_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\mathbf{v} = \left[\begin{matrix}p_{x}^{2 \eta - 1} \left(p_{x}^{2} + p_{z}^{2}\right)^{- \eta} \left(\eta p_{z}^{2} + p_{x}^{2}\right) \varphi^{2}{\left(\mathbf{r} \right)}\\- p_{x}^{2 \eta} p_{z} \left(\eta - 1\right) \left(p_{x}^{2} + p_{z}^{2}\right)^{- \eta} \varphi^{2}{\left(\mathbf{r} \right)}\end{matrix}\right]\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.rdot_p_unity_eqn">
<span class="sig-name descname"><span class="pre">rdot_p_unity_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.rdot_p_unity_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(p_{x} v^{x} + p_{z} v^{z} = 1\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="gme.core.equations.Equations.define_tanalpha_eqns">
<span class="sig-name descname"><span class="pre">define_tanalpha_eqns</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#gme.core.equations.Equations.define_tanalpha_eqns" title="Permalink to this definition">¶</a></dt>
<dd><p>Define equations for ray angle <span class="math notranslate nohighlight">\(\tan(\alpha)\)</span></p>
<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.tanalpha_pxpz_eqn">
<span class="sig-name descname"><span class="pre">tanalpha_pxpz_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.tanalpha_pxpz_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\tan{\left(\alpha \right)} = \dfrac{v^{z}}{v^{x}}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.tanalpha_beta_eqn">
<span class="sig-name descname"><span class="pre">tanalpha_beta_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.tanalpha_beta_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\tan{\left(\alpha \right)} = - \dfrac{p_{x} p_{z} \left(\eta - 1\right)}{\eta p_{z}^{2} + p_{x}^{2}}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.tanalpha_rdot_eqn">
<span class="sig-name descname"><span class="pre">tanalpha_rdot_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.tanalpha_rdot_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\tan{\left(\alpha \right)} = \dfrac{\left(\eta - 1\right) \tan{\left(\beta \right)}}{\eta + \tan^{2}{\left(\beta \right)}}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="gme.core.equations.Equations.define_tanbeta_eqns">
<span class="sig-name descname"><span class="pre">define_tanbeta_eqns</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#gme.core.equations.Equations.define_tanbeta_eqns" title="Permalink to this definition">¶</a></dt>
<dd><p>Define equations for surface tilt angle <span class="math notranslate nohighlight">\(\beta)\)</span></p>
<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.tanbeta_alpha_eqns">
<span class="sig-name descname"><span class="pre">tanbeta_alpha_eqns</span></span><a class="headerlink" href="#gme.core.equations.Equations.tanbeta_alpha_eqns" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\left[ \tan{\left(\beta \right)} \
= \dfrac{\eta - \sqrt{\eta^{2} - 4 \eta \tan^{2}{\left(\alpha \right)} - 2 \eta + 1} - 1}{2 \tan{\left(\alpha \right)}},
\tan{\left(\beta \right)} = \dfrac{\eta + \sqrt{\eta^{2} - 4 \eta \tan^{2}{\left(\alpha \right)} - 2 \eta + 1} - 1}{2 \tan{\left(\alpha \right)}}\right]\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>list of <a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.tanbeta_alpha_eqn">
<span class="sig-name descname"><span class="pre">tanbeta_alpha_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.tanbeta_alpha_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\tan{\left(\beta \right)}
= \dfrac{\eta - \sqrt{\eta^{2} - 4 \eta \tan^{2}{\left(\alpha \right)} - 2 \eta + 1} - 1}{2 \tan{\left(\alpha \right)}}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.tanalpha_crit_eqns">
<span class="sig-name descname"><span class="pre">tanalpha_crit_eqns</span></span><a class="headerlink" href="#gme.core.equations.Equations.tanalpha_crit_eqns" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\left[ \tan{\left(\alpha_c \right)} = - \frac{\sqrt{\eta - 2 + \frac{1}{\eta}}}{2},
\tan{\left(\alpha_c \right)} = \frac{\sqrt{\eta - 2 + \frac{1}{\eta}}}{2}\right]\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>list of <a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.tanalpha_crit_eqn">
<span class="sig-name descname"><span class="pre">tanalpha_crit_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.tanalpha_crit_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\tan{\left(\alpha_c \right)} = \dfrac{\eta - 1}{2 \sqrt{\eta}}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.tanbeta_crit_eqns">
<span class="sig-name descname"><span class="pre">tanbeta_crit_eqns</span></span><a class="headerlink" href="#gme.core.equations.Equations.tanbeta_crit_eqns" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\left[ \tan{\left(\beta_c \right)} = - \dfrac{\eta - 1}{\sqrt{\eta - 2 + \frac{1}{\eta}}},
\tan{\left(\beta_c \right)} = \dfrac{\eta - 1}{\sqrt{\eta - 2 + \frac{1}{\eta}}}\right]\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>list of <a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.tanbeta_crit_eqn">
<span class="sig-name descname"><span class="pre">tanbeta_crit_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.tanbeta_crit_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\tan{\left(\beta_c \right)} = \sqrt{\eta}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.tanbeta_rdotxz_pz_eqn">
<span class="sig-name descname"><span class="pre">tanbeta_rdotxz_pz_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.tanbeta_rdotxz_pz_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\tan{\left(\beta \right)} = \dfrac{v^{z} - \frac{1}{p_{z}}}{v^{x}}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.tanbeta_rdotxz_xiv_eqn">
<span class="sig-name descname"><span class="pre">tanbeta_rdotxz_xiv_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.tanbeta_rdotxz_xiv_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\tan{\left(\beta \right)} = \dfrac{\xi^{\downarrow} + v^{z}}{v^{x}}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="gme.core.equations.Equations.define_varphi_model_eqn">
<span class="sig-name descname"><span class="pre">define_varphi_model_eqn</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">do_new</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#gme.core.equations.Equations.define_varphi_model_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p>Define flow component of erosion model function</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.varphi_model_ramp_eqn">
<span class="sig-name descname"><span class="pre">varphi_model_ramp_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.varphi_model_ramp_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\varphi{\left(\mathbf{r} \right)} = \varphi_0 \left(\varepsilon + \left(\dfrac{x_{1} - {r}^x}{x_{1}}\right)^{2 \mu}\right)\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.varphi_model_rampflat_eqn">
<span class="sig-name descname"><span class="pre">varphi_model_rampflat_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.varphi_model_rampflat_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p>:math:`` TBD</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.varphi_rx_eqn">
<span class="sig-name descname"><span class="pre">varphi_rx_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.varphi_rx_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p>specific choice of <span class="math notranslate nohighlight">\(\varphi\)</span> model from the above</p>
<ul class="simple">
<li><p>pure “channel” model <cite>varphi_model_ramp_eqn</cite> if <cite>self.varphi_type==’ramp’</cite></p></li>
<li><p>“hillslope-channel” model <cite>varphi_model_rampflat_eqn</cite> if <cite>self.varphi_type==’ramp-flat’</cite></p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="gme.core.equations.Equations.define_varphi_related_eqns">
<span class="sig-name descname"><span class="pre">define_varphi_related_eqns</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#gme.core.equations.Equations.define_varphi_related_eqns" title="Permalink to this definition">¶</a></dt>
<dd><p>Define further equations related to normal slowness <span class="math notranslate nohighlight">\(p\)</span></p>
<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.p_varphi_beta_eqn">
<span class="sig-name descname"><span class="pre">p_varphi_beta_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.p_varphi_beta_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(p = \dfrac{1}{\varphi(\mathbf{r})|\sin\beta|^\eta}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.p_varphi_pxpz_eqn">
<span class="sig-name descname"><span class="pre">p_varphi_pxpz_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.p_varphi_pxpz_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\sqrt{p_{x}^{2} + p_{z}^{2}} = \dfrac{\left(  {\sqrt{p_{x}^{2} + p_{z}^{2}}}  \right)^{\eta}}{\varphi{\left(\mathbf{r} \right)}{p_{x}}^\eta}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.p_rx_pxpz_eqn">
<span class="sig-name descname"><span class="pre">p_rx_pxpz_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.p_rx_pxpz_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\sqrt{p_{x}^{2} + p_{z}^{2}}
= \dfrac{p_{x}^{- \eta} x_{1}^{2 \mu} \left(p_{x}^{2} + p_{z}^{2}\right)^{\frac{\eta}{2}}}{\varphi_0 \left(\varepsilon x_{1}^{2 \mu} + \left(x_{1} - {r}^x\right)^{2 \mu}\right)}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.p_rx_tanbeta_eqn">
<span class="sig-name descname"><span class="pre">p_rx_tanbeta_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.p_rx_tanbeta_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\sqrt{p_{x}^{2} + \dfrac{p_{x}^{2}}{\tan^{2}{\left(\beta \right)}}}
= \dfrac{p_{x}^{- \eta} x_{1}^{2 \mu} \left(p_{x}^{2}
+ \dfrac{p_{x}^{2}}{\tan^{2}{\left(\beta \right)}}\right)^{\frac{\eta}{2}}}{\varphi_0 \left(\varepsilon x_{1}^{2 \mu} + \left(x_{1} - {r}^x\right)^{2 \mu}\right)}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.px_beta_eqn">
<span class="sig-name descname"><span class="pre">px_beta_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.px_beta_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(p_{x} = \dfrac{p_{x}^{- \eta} x_{1}^{2 \mu} \left(p_{x}^{2}
+ \dfrac{p_{x}^{2}}{\tan^{2}{\left(\beta \right)}}\right)^{\frac{\eta}{2}} \sin{\left(\beta \right)}}{\varphi_0 \left(\varepsilon x_{1}^{2 \mu} + \left(x_{1} - {r}^x\right)^{2 \mu}\right)}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.pz_beta_eqn">
<span class="sig-name descname"><span class="pre">pz_beta_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.pz_beta_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(p_{z} = - \dfrac{p_{x}^{- \eta} x_{1}^{2 \mu} \left(p_{x}^{2}
+ \dfrac{p_{x}^{2}}{\tan^{2}{\left(\beta \right)}}\right)^{\frac{\eta}{2}} \cos{\left(\beta \right)}}{\varphi_0 \left(\varepsilon x_{1}^{2 \mu} + \left(x_{1} - {r}^x\right)^{2 \mu}\right)}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.xiv_pxpz_eqn">
<span class="sig-name descname"><span class="pre">xiv_pxpz_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.xiv_pxpz_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\xi^{\downarrow} = \dfrac{p_z}{p_x^{2} + p_z^{2}}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.px_varphi_beta_eqn">
<span class="sig-name descname"><span class="pre">px_varphi_beta_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.px_varphi_beta_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(p_{x} = \dfrac{\sin{\left(\beta \right)} \left|{\sin{\left(\beta \right)}}\right|^{- \eta}}{\varphi{\left(\mathbf{r} \right)}}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.pz_varphi_beta_eqn">
<span class="sig-name descname"><span class="pre">pz_varphi_beta_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.pz_varphi_beta_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(p_{z} = - \dfrac{\cos{\left(\beta \right)} \left|{\sin{\left(\beta \right)}}\right|^{- \eta}}{\varphi{\left(\mathbf{r} \right)}}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.px_varphi_rx_beta_eqn">
<span class="sig-name descname"><span class="pre">px_varphi_rx_beta_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.px_varphi_rx_beta_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(p_{x} = \dfrac{\sin{\left(\beta \right)} \left|{\sin{\left(\beta \right)}}\right|^{- \eta}}{\varphi_0 \left(\varepsilon + \left(\dfrac{x_{1} - {r}^x}{x_{1}}\right)^{2 \mu}\right)}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.pz_varphi_rx_beta_eqn">
<span class="sig-name descname"><span class="pre">pz_varphi_rx_beta_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.pz_varphi_rx_beta_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(p_{z} = - \dfrac{\cos{\left(\beta \right)} \left|{\sin{\left(\beta \right)}}\right|^{- \eta}}{\varphi_0 \left(\varepsilon + \left(\dfrac{x_{1} - {r}^x}{x_{1}}\right)^{2 \mu}\right)}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="gme.core.equations.Equations.define_xi_eqns">
<span class="sig-name descname"><span class="pre">define_xi_eqns</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#gme.core.equations.Equations.define_xi_eqns" title="Permalink to this definition">¶</a></dt>
<dd><p>Define equations for surface erosion speed <span class="math notranslate nohighlight">\(\xi\)</span> and its vertical behavior</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.xi_p_eqn">
<span class="sig-name descname"><span class="pre">xi_p_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.xi_p_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\xi^{\perp} := \dfrac{1}{p}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.xiv_pz_eqn">
<span class="sig-name descname"><span class="pre">xiv_pz_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.xiv_pz_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\xi^{\downarrow} := -\dfrac{1}{p_z}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.p_xi_eqn">
<span class="sig-name descname"><span class="pre">p_xi_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.p_xi_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\({p} = \dfrac{1}{\xi^{\perp}}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.pz_xiv_eqn">
<span class="sig-name descname"><span class="pre">pz_xiv_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.pz_xiv_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\({p_z} = -\dfrac{1}{\xi^{\downarrow}}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="gme.core.equations.Equations.define_xi_model_eqn">
<span class="sig-name descname"><span class="pre">define_xi_model_eqn</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#gme.core.equations.Equations.define_xi_model_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p>Define the form of the surface erosion model,
giving the speed of surface motion in its normal direction <span class="math notranslate nohighlight">\(\xi^{\perp}\)</span>.
For now, the model must have a separable dependence on
position <span class="math notranslate nohighlight">\(\mathbf{r}\)</span> and surface tilt <span class="math notranslate nohighlight">\(\beta\)</span>.
The former sets the ‘flow’ dependence of the erosion model, and is given by
the function <span class="math notranslate nohighlight">\(\varphi(\mathbf{})\)</span>, which must be specified at some point.
The latter is specified in <cite>self.beta_type</cite> and may be <cite>sin</cite> or <cite>tan</cite>;
it is given a power exponent <span class="math notranslate nohighlight">\(\eta\)</span> which must take a rational value.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.xi_varphi_beta_eqn">
<span class="sig-name descname"><span class="pre">xi_varphi_beta_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.xi_varphi_beta_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\xi^{\perp} = \varphi(\mathbf{r}) \, \left| \sin\beta \right|^\eta\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="gme.core.equations.Equations.define_xi_related_eqns">
<span class="sig-name descname"><span class="pre">define_xi_related_eqns</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#gme.core.equations.Equations.define_xi_related_eqns" title="Permalink to this definition">¶</a></dt>
<dd><p>Define equations related to surface erosion speed <span class="math notranslate nohighlight">\(\xi\)</span>
and its vertical behavior.
The derivations below are for an erosion model with
<span class="math notranslate nohighlight">\(\left|\tan\beta\right|^\eta\)</span>, <span class="math notranslate nohighlight">\(\eta=3/2\)</span>.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.xiv_varphi_pxpz_eqn">
<span class="sig-name descname"><span class="pre">xiv_varphi_pxpz_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.xiv_varphi_pxpz_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\xi^{\downarrow} = - \dfrac{p_{x}^{\eta} \left(p_{x}^{2} + p_{z}^{2}\right)^{\tfrac{1}{2} - \tfrac{\eta}{2}} \varphi{\left(\mathbf{r} \right)}}{p_{z}}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.px_xiv_varphi_eqn">
<span class="sig-name descname"><span class="pre">px_xiv_varphi_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.px_xiv_varphi_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\left(\xi^{\downarrow}\right)^{2}\)</span>
<span class="math notranslate nohighlight">\(\left(p_{x}^{2} p_{x}^{2 \eta} \left(p_{x}^{2} \
+ \frac{1}{\left(\xi^{\downarrow}\right)^{2}}\right)^{- \eta} \varphi^{2}{\left(\mathbf{r} \right)} - 1 \
+ \dfrac{p_{x}^{2 \eta} \left(p_{x}^{2} \
+ \frac{1}{\left(\xi^{\downarrow}\right)^{2}}\right)^{- \eta} \varphi^{2}{\left(\mathbf{r} \right)}}{\left(\xi^{\downarrow}\right)^{2}}\right)\)</span>
<span class="math notranslate nohighlight">\(\times\,\,\,\left(p_{x}^{2} p_{x}^{2 \eta} \left(p_{x}^{2} \
+ \frac{1}{\left(\xi^{\downarrow}\right)^{2}}\right)^{- \eta} \varphi^{2}{\left(\mathbf{r} \right)} + 1 \
+ \dfrac{p_{x}^{2 \eta} \left(p_{x}^{2} \
+ \frac{1}{\left(\xi^{\downarrow}\right)^{2}}\right)^{- \eta} \varphi^{2}{\left(\mathbf{r} \right)}}{\left(\xi^{\downarrow}\right)^{2}}\right) = 0\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.eta_dbldenom">
<span class="sig-name descname"><span class="pre">eta_dbldenom</span></span><a class="headerlink" href="#gme.core.equations.Equations.eta_dbldenom" title="Permalink to this definition">¶</a></dt>
<dd><p>a convenience variable, recording double the denominator of <span class="math notranslate nohighlight">\(\eta\)</span>, which must itself be a rational number</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.numbers.Integer" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Int</span></code></a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="gme.core.equations.Equations.nondimensionalize">
<span class="sig-name descname"><span class="pre">nondimensionalize</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#gme.core.equations.Equations.nondimensionalize" title="Permalink to this definition">¶</a></dt>
<dd><p>Non-dimensionalize variables, Hamiltonian, and Hamilton’s equations;
define dimensionless channel incision number <span class="math notranslate nohighlight">\(\mathsf{Ci}\)</span>.</p>
<p>Attributes:</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="gme.core.equations.Equations.prep_geodesic_eqns">
<span class="sig-name descname"><span class="pre">prep_geodesic_eqns</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parameters</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#gme.core.equations.Equations.prep_geodesic_eqns" title="Permalink to this definition">¶</a></dt>
<dd><p>Define geodesic equations</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>parameters</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.10)"><em>dict</em></a>) – dictionary of model parameter values to be used for equation substitutions</p>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.gstar_ij_tanbeta_mat">
<span class="sig-name descname"><span class="pre">gstar_ij_tanbeta_mat</span></span><a class="headerlink" href="#gme.core.equations.Equations.gstar_ij_tanbeta_mat" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\dots\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/matrices/immutablematrices.html#sympy.matrices.immutable.ImmutableDenseMatrix" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.ImmutableDenseMatrix</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.g_ij_tanbeta_mat">
<span class="sig-name descname"><span class="pre">g_ij_tanbeta_mat</span></span><a class="headerlink" href="#gme.core.equations.Equations.g_ij_tanbeta_mat" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\dots\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/matrices/immutablematrices.html#sympy.matrices.immutable.ImmutableDenseMatrix" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.ImmutableDenseMatrix</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.tanbeta_poly_eqn">
<span class="sig-name descname"><span class="pre">tanbeta_poly_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.tanbeta_poly_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\dots\)</span> where <span class="math notranslate nohighlight">\(a := \tan\alpha\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.tanbeta_eqn">
<span class="sig-name descname"><span class="pre">tanbeta_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.tanbeta_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\tan{\left(\beta \right)} = \dots\)</span> where <span class="math notranslate nohighlight">\(a := \tan\alpha\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.gstar_ij_tanalpha_mat">
<span class="sig-name descname"><span class="pre">gstar_ij_tanalpha_mat</span></span><a class="headerlink" href="#gme.core.equations.Equations.gstar_ij_tanalpha_mat" title="Permalink to this definition">¶</a></dt>
<dd><p>a symmetric tensor with components (using shorthand <span class="math notranslate nohighlight">\(a := \tan\alpha\)</span>)</p>
<p><span class="math notranslate nohighlight">\(g^*[1,1] = \dots\)</span></p>
<p><span class="math notranslate nohighlight">\(g^*[1,2] = g^*[2,1] = \dots\)</span></p>
<p><span class="math notranslate nohighlight">\(g^*[2,2] = \dots\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/matrices/immutablematrices.html#sympy.matrices.immutable.ImmutableDenseMatrix" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.ImmutableDenseMatrix</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.gstar_ij_mat">
<span class="sig-name descname"><span class="pre">gstar_ij_mat</span></span><a class="headerlink" href="#gme.core.equations.Equations.gstar_ij_mat" title="Permalink to this definition">¶</a></dt>
<dd><p>a symmetric tensor with components
(using shorthand <span class="math notranslate nohighlight">\(a := \tan\alpha\)</span>, and with a particular choice of model parameters)</p>
<p><span class="math notranslate nohighlight">\(g^*[1,1] = \dots\)</span></p>
<p><span class="math notranslate nohighlight">\(g^*[1,2] = g^*[2,1] = \dots\)</span></p>
<p><span class="math notranslate nohighlight">\(g^*[2,2] =  \dots\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/matrices/immutablematrices.html#sympy.matrices.immutable.ImmutableDenseMatrix" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.ImmutableDenseMatrix</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.g_ij_tanalpha_mat">
<span class="sig-name descname"><span class="pre">g_ij_tanalpha_mat</span></span><a class="headerlink" href="#gme.core.equations.Equations.g_ij_tanalpha_mat" title="Permalink to this definition">¶</a></dt>
<dd><p>a symmetric tensor with components (using shorthand <span class="math notranslate nohighlight">\(a := \tan\alpha\)</span>)</p>
<p><span class="math notranslate nohighlight">\(g[1,1] = \dots\)</span></p>
<p><span class="math notranslate nohighlight">\(g[1,2] = g[2,1] = \dots\)</span></p>
<p><span class="math notranslate nohighlight">\(g[2,2] = \dots\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/matrices/immutablematrices.html#sympy.matrices.immutable.ImmutableDenseMatrix" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.ImmutableDenseMatrix</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.g_ij_mat">
<span class="sig-name descname"><span class="pre">g_ij_mat</span></span><a class="headerlink" href="#gme.core.equations.Equations.g_ij_mat" title="Permalink to this definition">¶</a></dt>
<dd><p>a symmetric tensor with components
(using shorthand <span class="math notranslate nohighlight">\(a := \tan\alpha\)</span>, and with a particular choice of model parameters)</p>
<p><span class="math notranslate nohighlight">\(g[1,1] =\dots\)</span></p>
<p><span class="math notranslate nohighlight">\(g[1,2] = g[2,1] = \dots\)</span></p>
<p><span class="math notranslate nohighlight">\(g[2,2] = \dots\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/matrices/immutablematrices.html#sympy.matrices.immutable.ImmutableDenseMatrix" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.ImmutableDenseMatrix</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.g_ij_mat_lambdified">
<span class="sig-name descname"><span class="pre">g_ij_mat_lambdified</span></span><a class="headerlink" href="#gme.core.equations.Equations.g_ij_mat_lambdified" title="Permalink to this definition">¶</a></dt>
<dd><p>lambdified version of <cite>g_ij_mat</cite></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>function</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.gstar_ij_mat_lambdified">
<span class="sig-name descname"><span class="pre">gstar_ij_mat_lambdified</span></span><a class="headerlink" href="#gme.core.equations.Equations.gstar_ij_mat_lambdified" title="Permalink to this definition">¶</a></dt>
<dd><p>lambdified version of <cite>gstar_ij_mat</cite></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>function</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="gme.core.equations.Equations.prep_ibc_eqns">
<span class="sig-name descname"><span class="pre">prep_ibc_eqns</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#gme.core.equations.Equations.prep_ibc_eqns" title="Permalink to this definition">¶</a></dt>
<dd><p>Define boundary (ray initial) condition equations</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.pz0_xiv0_eqn">
<span class="sig-name descname"><span class="pre">pz0_xiv0_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.pz0_xiv0_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(p_{z_0} = - \dfrac{1}{\xi^{\downarrow{0}}}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.pzpx_unity_eqn">
<span class="sig-name descname"><span class="pre">pzpx_unity_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.pzpx_unity_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\varphi^{2} p_{x}^{2} p_{x}^{2 \eta} \left(p_{x}^{2} + p_{z}^{2}\right)^{- \eta} + \varphi^{2} p_{x}^{2 \eta} p_{z}^{2} \left(p_{x}^{2} + p_{z}^{2}\right)^{- \eta} = 1\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="gme.core.equations.Equations.set_ibc_eqns">
<span class="sig-name descname"><span class="pre">set_ibc_eqns</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#gme.core.equations.Equations.set_ibc_eqns" title="Permalink to this definition">¶</a></dt>
<dd><p>Define initial condition equations</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.rz_initial_eqn">
<span class="sig-name descname"><span class="pre">rz_initial_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.rz_initial_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\({r}^z = \dfrac{h_{0} \tanh{\left(\frac{\kappa_\mathrm{h} {r}^x}{x_{1}} \right)}}{\tanh{\left(\frac{\kappa_\mathrm{h}}{x_{1}} \right)}}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.tanbeta_initial_eqn">
<span class="sig-name descname"><span class="pre">tanbeta_initial_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.tanbeta_initial_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(\tan{\left(\beta \right)} = \dfrac{\kappa_\mathrm{h} h_{0} \left(1 - \tanh^{2}{\left(\frac{\kappa_\mathrm{h} x}{x_{1}} \right)}\right)}{x_{1} \tanh{\left(\frac{\kappa_\mathrm{h}}{x_{1}} \right)}}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.p_initial_eqn">
<span class="sig-name descname"><span class="pre">p_initial_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.p_initial_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(p = \dfrac{x_{1}^{2 \mu} \left|{\sin{\left(\beta \right)}}\right|^{- \eta}}{\varphi_0 \left(\varepsilon x_{1}^{2 \mu} + \left(- x + x_{1}\right)^{2 \mu}\right)}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.px_initial_eqn">
<span class="sig-name descname"><span class="pre">px_initial_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.px_initial_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(p_{x} = \dfrac{\kappa_\mathrm{h} h_{0} x_{1}^{2 \mu} \left(\dfrac{1}{\kappa_\mathrm{h} h_{0} \left|{\tanh^{2}{\left(\frac{\kappa_\mathrm{h} x}{x_{1}} \right)} - 1}\right|}\right)^{\eta} \left(\kappa_\mathrm{h}^{2} h_{0}^{2} \left(\tanh^{2}{\left(\frac{\kappa_\mathrm{h} x}{x_{1}} \right)} - 1\right)^{2} + x_{1}^{2} \tanh^{2}{\left(\frac{\kappa_\mathrm{h}}{x_{1}} \right)}\right)^{\frac{\eta}{2} - \frac{1}{2}} \left|{\tanh^{2}{\left(\frac{\kappa_\mathrm{h} x}{x_{1}} \right)} - 1}\right|}{\varphi_0 \left(\varepsilon x_{1}^{2 \mu} + \left(- x + x_{1}\right)^{2 \mu}\right)}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="gme.core.equations.Equations.pz_initial_eqn">
<span class="sig-name descname"><span class="pre">pz_initial_eqn</span></span><a class="headerlink" href="#gme.core.equations.Equations.pz_initial_eqn" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(p_{z} = - \dfrac{x_{1}^{2 \mu + 1} \left(\dfrac{1}{\kappa_\mathrm{h} h_{0} \left|{\tanh^{2}{\left(\frac{\kappa_\mathrm{h} x}{x_{1}} \right)} - 1}\right|}\right)^{\eta} \left(\kappa_\mathrm{h}^{2} h_{0}^{2} \left(\tanh^{2}{\left(\frac{\kappa_\mathrm{h} x}{x_{1}} \right)} - 1\right)^{2} + x_{1}^{2} \tanh^{2}{\left(\frac{\kappa_\mathrm{h}}{x_{1}} \right)}\right)^{\frac{\eta}{2} - \frac{1}{2}} \tanh{\left(\frac{\kappa_\mathrm{h}}{x_{1}} \right)}}{\varphi_0 \left(\varepsilon x_{1}^{2 \mu} + \left(- x + x_{1}\right)^{2 \mu}\right)}\)</span></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.sympy.org/latest/modules/core.html#sympy.core.relational.Equality" title="(in SymPy v1.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sympy.Eq</span></code></a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</dd></dl>

<div class="section" id="code">
<h2>Code<a class="headerlink" href="#code" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">---------------------------------------------------------------------</span>

<span class="sd">Equation definitions and derivations using :mod:`SymPy &lt;sympy&gt;`.</span>

<span class="sd">---------------------------------------------------------------------</span>

<span class="sd">This module provides a derivation of GME theory using :mod:`SymPy &lt;sympy&gt;`</span>
<span class="sd">for a 2D slice of a 3D landscape along a channel transect.</span>

<span class="sd">Starting from a model equation for the surface-normal erosion rate in terms of</span>
<span class="sd">the tilt angle of the topographic surface and the distance downstream</span>
<span class="sd">(used to infer the flow component of the model erosion process), we derive</span>
<span class="sd">the fundamental function (of a co-Finsler metric space), the corresponding Hamiltonian,</span>
<span class="sd">and the equivalent metric tensor.</span>
<span class="sd">The rest of the equations are derived from these core results.</span>

<span class="sd">---------------------------------------------------------------------</span>


<span class="sd">Requires Python packages/modules:</span>
<span class="sd">  -  :mod:`scipy`, :mod:`sympy`</span>
<span class="sd">  -  :mod:`gmplib.utils`</span>
<span class="sd">  -  :mod:`gme.core.symbols`</span>

<span class="sd">---------------------------------------------------------------------</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># Disable these pylint errors because it doesn&#39;t understand SymPy syntax</span>
<span class="c1">#   - notably minus signs in equations flag an error</span>
<span class="c1"># pylint: disable=invalid-unary-operand-type, not-callable</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">reduce</span>

<span class="c1"># Typing</span>
<span class="c1"># from typing import Tuple, Dict, Any, List</span>

<span class="c1"># SymPy</span>
<span class="kn">import</span> <span class="nn">sympy</span> <span class="k">as</span> <span class="nn">sy</span>
<span class="c1"># Cut &#39;S&#39; because mypy complains</span>
<span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">Eq</span><span class="p">,</span> <span class="n">Rational</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> \
                    <span class="n">pi</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">numer</span><span class="p">,</span> <span class="n">denom</span><span class="p">,</span> \
                    <span class="n">simplify</span><span class="p">,</span> <span class="n">trigsimp</span><span class="p">,</span> <span class="n">factor</span><span class="p">,</span> <span class="n">expand</span><span class="p">,</span> <span class="n">lambdify</span><span class="p">,</span> <span class="n">expand_trig</span><span class="p">,</span> \
                    <span class="n">solve</span><span class="p">,</span> <span class="n">diff</span><span class="p">,</span> <span class="n">Matrix</span><span class="p">,</span> \
                    <span class="n">exp</span><span class="p">,</span> <span class="n">tan</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">asin</span><span class="p">,</span> <span class="n">deg</span><span class="p">,</span> <span class="n">tanh</span><span class="p">,</span>  \
                    <span class="n">Abs</span><span class="p">,</span> <span class="n">sign</span><span class="p">,</span> <span class="n">re</span><span class="p">,</span> <span class="n">im</span><span class="p">,</span> \
                    <span class="n">integrate</span><span class="p">,</span> <span class="n">derive_by_array</span><span class="p">,</span> <span class="n">Piecewise</span><span class="p">,</span> \
                    <span class="n">poly</span><span class="p">,</span> <span class="n">separatevars</span>

<span class="c1"># GMPLib</span>
<span class="kn">from</span> <span class="nn">gmplib.utils</span> <span class="kn">import</span> <span class="n">e2d</span><span class="p">,</span> <span class="n">omitdict</span>

<span class="c1"># GME</span>
<span class="c1"># yes, I know...</span>
<span class="kn">from</span> <span class="nn">gme.core.symbols</span> <span class="kn">import</span> <span class="o">*</span>
<span class="c1"># to keep mypy happy</span>
<span class="kn">from</span> <span class="nn">gme.core.symbols</span> <span class="kn">import</span> <span class="n">x</span><span class="p">,</span><span class="n">rx</span><span class="p">,</span><span class="n">px</span><span class="p">,</span><span class="n">pz</span><span class="p">,</span><span class="n">xiv</span><span class="p">,</span><span class="n">xiv_0</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Equations&#39;</span><span class="p">,</span> <span class="s1">&#39;EquationSubset&#39;</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">EquationSubset</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    TBD</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">gmeq</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">do_ndim</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">do_revert</span><span class="o">=</span><span class="kc">True</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sub</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">do_revert</span> <span class="ow">and</span> <span class="n">do_ndim</span><span class="p">:</span>
            <span class="n">undimsub</span> <span class="o">=</span> <span class="p">{</span><span class="n">pxhat</span><span class="p">:</span><span class="n">px</span><span class="p">,</span> <span class="n">pzhat</span><span class="p">:</span><span class="n">pz</span><span class="p">,</span> <span class="n">rxhat</span><span class="p">:</span><span class="n">rx</span><span class="p">,</span> <span class="n">xivhat</span><span class="p">:</span><span class="n">xiv</span><span class="p">,</span>
                        <span class="n">varphi_rhat</span><span class="p">:</span><span class="n">varphi_rx</span><span class="p">,</span> <span class="n">varphi_rxhat_fn</span><span class="p">:</span><span class="n">varphi_rx</span><span class="p">,</span>
                        <span class="n">rdotxhat_thatfn</span><span class="p">:</span><span class="n">rdotx_tfn</span><span class="p">,</span> <span class="n">rdotzhat_thatfn</span><span class="p">:</span><span class="n">rdotz_tfn</span><span class="p">,</span>
                        <span class="n">pdotxhat_thatfn</span><span class="p">:</span><span class="n">pdotx_tfn</span><span class="p">,</span> <span class="n">pdotzhat_thatfn</span><span class="p">:</span><span class="n">pdotz_tfn</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">undimsub</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">sub</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">mu</span><span class="p">:</span><span class="n">gmeq</span><span class="o">.</span><span class="n">mu_</span><span class="p">,</span> <span class="n">eta</span><span class="p">:</span><span class="n">gmeq</span><span class="o">.</span><span class="n">eta_</span><span class="p">})</span>
        <span class="c1"># xisub = {}</span>
        <span class="c1"># varphi0_xiv0_Lc_eqn = (gmeq.varphi0_Lc_xiv0_Ci_eqn</span>
        <span class="c1">#                .subs(omitdict(sub,[varphi_0,xiv_0,Lc]))</span>
        <span class="c1">#                .n() )</span>
        <span class="c1"># self.varphi_rx_eqn   = (gmeq.varphi_rxhat_eqn.subs(e2d(varphi0_xiv0_Lc_eqn))</span>
        <span class="c1">#                      .subs(omitdict(sub,[varphi_0,xiv_0,Lc])).n().subs(undimsub)</span>
        <span class="c1">#                      #gmeq.varphi_rxhat_eqn</span>
        <span class="c1">#                         if do_ndim else gmeq.varphi_rx_eqn.subs(sub).n()</span>
        <span class="c1">#                            .subs(undimsub) )</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pz_xiv_eqn</span>      <span class="o">=</span> <span class="p">((</span><span class="n">gmeq</span><span class="o">.</span><span class="n">pzhat_xiv_eqn</span> <span class="c1">#.subs(xisub)</span>
                                <span class="k">if</span> <span class="n">do_ndim</span> <span class="k">else</span> <span class="n">gmeq</span><span class="o">.</span><span class="n">pz_xiv_eqn</span><span class="p">)</span><span class="o">.</span><span class="n">n</span><span class="p">())</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">undimsub</span><span class="p">)</span>
                                <span class="c1">#.subs({pz:pz_0, xiv:xiv_0}) #.subs({xiv:xiv/xih_0})</span>
        <span class="c1">#Eq(simplify((gmeq.poly_pxhat_xiv_eqn.lhs.subs(xisub))/xih_0**2),0)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poly_px_xiv0_eqn</span> <span class="o">=</span> <span class="p">(</span><span class="n">gmeq</span><span class="o">.</span><span class="n">poly_pxhat_xiv0_eqn</span>
                                <span class="k">if</span> <span class="n">do_ndim</span> <span class="k">else</span> <span class="n">gmeq</span><span class="o">.</span><span class="n">poly_px_xiv_eqn</span><span class="p">)</span> \
                                <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span><span class="o">.</span><span class="n">n</span><span class="p">()</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">undimsub</span><span class="p">)</span><span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">xih_0</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xiv0_xih0_Ci_eqn</span> <span class="o">=</span> <span class="n">gmeq</span><span class="o">.</span><span class="n">xiv0_xih0_Ci_eqn</span>\
                                    <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">omitdict</span><span class="p">(</span><span class="n">sub</span><span class="p">,[</span><span class="n">xiv_0</span><span class="p">,</span><span class="n">xih_0</span><span class="p">]))</span><span class="o">.</span><span class="n">n</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hamiltons_eqns</span>  <span class="o">=</span> <span class="p">(</span><span class="n">gmeq</span><span class="o">.</span><span class="n">hamiltons_ndim_eqns</span> <span class="k">if</span> <span class="n">do_ndim</span>
                                <span class="k">else</span> <span class="n">gmeq</span><span class="o">.</span><span class="n">hamiltons_eqns</span><span class="p">)</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span><span class="o">.</span><span class="n">n</span><span class="p">()</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">undimsub</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Equations</span><span class="p">:</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to solve the set of GME equations (using :mod:`SymPy &lt;sympy&gt;`)</span>
<span class="sd">    and to provide them in a form (sometimes lambdified) that can be used for</span>
<span class="sd">    numerical evaluation.</span>

<span class="sd">    Much of the derivation sequence here keeps :math:`\eta` and :math:`\mu` unspecified,</span>
<span class="sd">    up until the Hamiltonian is defined, but eventually values for these</span>
<span class="sd">    parameters need to be substituted in order to make further progress.</span>
<span class="sd">    In this documentation, we set :math:`\eta=3/2`, for now.</span>

<span class="sd">    TODO: provide solutions for both :math:`\eta=1/2` and</span>
<span class="sd">          :math:`\eta=3/2` where appropriate.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">eta_</span><span class="o">=</span><span class="n">Rational</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">mu_</span><span class="o">=</span><span class="n">Rational</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span>
                  <span class="n">beta_type</span><span class="o">=</span><span class="s1">&#39;sin&#39;</span><span class="p">,</span> <span class="n">varphi_type</span><span class="o">=</span><span class="s1">&#39;ramp&#39;</span><span class="p">,</span> <span class="n">ibc_type</span><span class="o">=</span><span class="s1">&#39;convex-up&#39;</span><span class="p">,</span>
                  <span class="n">do_raw</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">do_idtx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">do_geodesic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="n">do_nothing</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">do_new_varphi_model</span><span class="o">=</span><span class="kc">True</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize class instance.</span>
<span class="sd">        Define/derive all the GME equations (unless `&#39;do_nothing&#39;` is true)</span>
<span class="sd">        using :mod:`SymPy &lt;sympy&gt;`.</span>

<span class="sd">        Args:</span>
<span class="sd">            parameters (dict): dictionary of model parameter values to be</span>
<span class="sd">                               used for equation substitutions</span>
<span class="sd">                               (used when defining geodesic equations)</span>
<span class="sd">            eta (:class:`sympy.Rational &lt;sympy.core.numbers.Rational&gt;`):</span>
<span class="sd">                exponent in slope component of erosion model (equivalent of</span>
<span class="sd">                gradient exponent :math:`n` in SPIM)</span>
<span class="sd">            mu (:class:`sympy.Rational &lt;sympy.core.numbers.Rational&gt;`):</span>
<span class="sd">                exponent in flow component of erosion model</span>
<span class="sd">                (equivalent of area exponent :math:`m` in SPIM)</span>
<span class="sd">            beta_type (str): choice of slope component of erosion model</span>
<span class="sd">                             (`&#39;sin&#39;` or `&#39;tan&#39;`)</span>
<span class="sd">            varphi_type (str): choice of flow component of erosion model</span>
<span class="sd">                               (`&#39;ramp&#39;` or `&#39;ramp-flat&#39;`)</span>
<span class="sd">            ibc_type (str): choice of initial boundary shape</span>
<span class="sd">                            (`&#39;convex-up&#39;` or `&#39;concave-up&#39;`,</span>
<span class="sd">                            i.e., concave vs convex in mathematical parlance)</span>
<span class="sd">            do_raw (bool): suppress substitution of :math:`eta` value</span>
<span class="sd">                            when defining `xi_varphi_beta_eqn`?</span>
<span class="sd">            do_idtx (bool): generate indicatrix and figuratrix equations?</span>
<span class="sd">            do_geodesic (bool): generate geodesic equations?</span>
<span class="sd">            do_nothing (bool): just create the class instance and set its data,</span>
<span class="sd">                               but don&#39;t run any of the equation definition methods</span>

<span class="sd">        Attributes:</span>
<span class="sd">            GME equations (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;` etc):</span>
<span class="sd">                See below</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">eta_</span> <span class="o">=</span> <span class="n">eta_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mu_</span> <span class="o">=</span> <span class="n">mu_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_raw</span> <span class="o">=</span> <span class="n">do_raw</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ibc_type</span> <span class="o">=</span> <span class="n">ibc_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta_type</span> <span class="o">=</span> <span class="n">beta_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">varphi_type</span> <span class="o">=</span> <span class="n">varphi_type</span>
        <span class="k">if</span> <span class="n">do_nothing</span><span class="p">:</span> <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">define_p_eqns</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">define_r_eqns</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">define_xi_eqns</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">define_xi_model_eqn</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">define_xi_related_eqns</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">define_varphi_model_eqn</span><span class="p">(</span><span class="n">do_new</span><span class="o">=</span><span class="n">do_new_varphi_model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">define_varphi_related_eqns</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">define_Fstar_eqns</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">define_H_eqns</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">define_rdot_eqns</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">define_pdot_eqns</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">define_Hamiltons_eqns</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nondimensionalize</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">define_nodimensionalized_Hamiltons_eqns</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">define_tanalpha_eqns</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">define_tanbeta_eqns</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">define_psi_eqns</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">define_g_eqns</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">do_idtx</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">define_idtx_fgtx_eqns</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">do_geodesic</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prep_geodesic_eqns</span><span class="p">(</span><span class="n">parameters</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">do_raw</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">define_geodesic_eqns</span><span class="p">()</span> <span class="c1">#parameters if not do_raw else None)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">define_px_poly_eqn</span><span class="p">(</span><span class="n">eta_choice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">eta_</span><span class="p">,</span> <span class="n">do_ndim</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">define_px_poly_eqn</span><span class="p">(</span><span class="n">eta_choice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">eta_</span><span class="p">,</span> <span class="n">do_ndim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prep_ibc_eqns</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">define_ibc_eqns</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_ibc_eqns</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">define_p_eqns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define normal slowness :math:`p` and derive related equations</span>

<span class="sd">        Attributes:</span>
<span class="sd">            p_covec_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`\mathbf{\widetilde{p}} := [p_x, p_z]`</span>
<span class="sd">            px_p_beta_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`p_x = p \sin\beta`</span>
<span class="sd">            pz_p_beta_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`p_z = p \cos\beta`</span>
<span class="sd">            p_norm_pxpz_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`p = \sqrt{p_x^2+p_z^2}`</span>
<span class="sd">            tanbeta_pxpz_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`\tan\beta = -\dfrac{p_x}{p_z}`</span>
<span class="sd">            sinbeta_pxpz_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`\sin\beta = \dfrac{p_x}{\sqrt{p_x^2+p_z^2}}`</span>
<span class="sd">            cosbeta_pxpz_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`\cos\beta = \dfrac{-p_z}{\sqrt{p_x^2+p_z^2}}`</span>
<span class="sd">            pz_px_tanbeta_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`p_z = -\dfrac{p_x}{\tan\beta}`</span>
<span class="sd">            px_pz_tanbeta_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`p_x = -{p_z}{\tan\beta}`</span>
<span class="sd">            p_pz_cosbeta_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`p = -\dfrac{p_z}{\cos\beta}`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_covec_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">pcovec</span><span class="p">,</span><span class="n">Matrix</span><span class="p">([</span><span class="n">px</span><span class="p">,</span><span class="n">pz</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">px_p_beta_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span> <span class="n">px</span><span class="p">,</span> <span class="n">p</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pz_p_beta_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span> <span class="n">pz</span><span class="p">,</span> <span class="o">-</span><span class="n">p</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_norm_pxpz_eqn</span> \
            <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span> <span class="n">trigsimp</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">px_p_beta_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pz_p_beta_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="o">**</span><span class="mi">2</span><span class="p">)),</span>
                        <span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">px_p_beta_eqn</span><span class="o">.</span><span class="n">lhs</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pz_p_beta_eqn</span><span class="o">.</span><span class="n">lhs</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tanbeta_pxpz_eqn</span> \
            <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span> <span class="n">simplify</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">px_p_beta_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">pz_p_beta_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">),</span>
                            <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">px_p_beta_eqn</span><span class="o">.</span><span class="n">lhs</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">pz_p_beta_eqn</span><span class="o">.</span><span class="n">lhs</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sinbeta_pxpz_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">beta</span><span class="p">),</span>
            <span class="n">solve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">px_p_beta_eqn</span><span class="p">,</span><span class="n">sin</span><span class="p">(</span><span class="n">beta</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p_norm_pxpz_eqn</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cosbeta_pxpz_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">beta</span><span class="p">),</span>
            <span class="n">solve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pz_p_beta_eqn</span><span class="p">,</span><span class="n">cos</span><span class="p">(</span><span class="n">beta</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p_norm_pxpz_eqn</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pz_px_tanbeta_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">pz</span><span class="p">,</span> <span class="n">solve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tanbeta_pxpz_eqn</span><span class="p">,</span><span class="n">pz</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">px_pz_tanbeta_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">px</span><span class="p">,</span> <span class="n">solve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tanbeta_pxpz_eqn</span><span class="p">,</span><span class="n">px</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_pz_cosbeta_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">solve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pz_p_beta_eqn</span><span class="p">,</span><span class="n">p</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>


    <span class="k">def</span> <span class="nf">define_r_eqns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define equations for ray position :math:`\vec{r}`</span>

<span class="sd">        Attributes:</span>
<span class="sd">            rx_r_alpha_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`r^x = r\cos\alpha`</span>
<span class="sd">            rz_r_alpha_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`r^z = r\sin\alpha`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rx_r_alpha_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span> <span class="n">rx</span><span class="p">,</span> <span class="n">r</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rz_r_alpha_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span> <span class="n">rz</span><span class="p">,</span> <span class="n">r</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="p">)</span>


    <span class="k">def</span> <span class="nf">define_xi_eqns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define equations for surface erosion speed :math:`\xi` and its vertical behavior</span>

<span class="sd">        Attributes:</span>
<span class="sd">            xi_p_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`\xi^{\perp} := \dfrac{1}{p}`</span>
<span class="sd">            xiv_pz_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`\xi^{\downarrow} := -\dfrac{1}{p_z}`</span>
<span class="sd">            p_xi_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`{p} = \dfrac{1}{\xi^{\perp}}`</span>
<span class="sd">            pz_xiv_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`{p_z} = -\dfrac{1}{\xi^{\downarrow}}`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xi_p_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span> <span class="n">xi</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">p</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xiv_pz_eqn</span> <span class="o">=</span> <span class="p">(</span><span class="n">Eq</span><span class="p">(</span> <span class="n">xiv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">pz</span> <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_xi_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">solve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_p_eqn</span><span class="p">,</span><span class="n">p</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pz_xiv_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">pz</span><span class="p">,</span> <span class="n">solve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xiv_pz_eqn</span><span class="p">,</span><span class="n">pz</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>


    <span class="k">def</span> <span class="nf">define_xi_model_eqn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define the form of the surface erosion model,</span>
<span class="sd">        giving the speed of surface motion in its normal direction :math:`\xi^{\perp}``.</span>
<span class="sd">        For now, the model must have a separable dependence on</span>
<span class="sd">        position :math:`\mathbf{r}` and surface tilt :math:`\beta`.</span>
<span class="sd">        The former sets the &#39;flow&#39; dependence of the erosion model, and is given by</span>
<span class="sd">        the function :math:`\varphi(\mathbf{})`, which must be specified at some point.</span>
<span class="sd">        The latter is specified in `self.beta_type` and may be `sin` or `tan`;</span>
<span class="sd">        it is given a power exponent :math:`\eta` which must take a rational value.</span>

<span class="sd">        Attributes:</span>
<span class="sd">            xi_varphi_beta_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`\xi^{\perp} = \varphi(\mathbf{r}) \, \left| \sin\beta \right|^\eta`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta_type</span><span class="o">==</span><span class="s1">&#39;sin&#39;</span><span class="p">:</span>
            <span class="n">xi_model</span> <span class="o">=</span> <span class="n">varphi_r</span><span class="p">(</span><span class="n">rvec</span><span class="p">)</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">beta</span><span class="p">))</span><span class="o">**</span><span class="n">eta</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xi_model</span> <span class="o">=</span> <span class="n">varphi_r</span><span class="p">(</span><span class="n">rvec</span><span class="p">)</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">tan</span><span class="p">(</span><span class="n">beta</span><span class="p">))</span><span class="o">**</span><span class="n">eta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xi_varphi_beta_raw_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">xi_model</span><span class="p">)</span>
        <span class="c1"># self.xi_varphi_beta_eqn = Eq(xi, xi_model)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_raw</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xi_varphi_beta_eqn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_varphi_beta_raw_eqn</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xi_varphi_beta_eqn</span> \
                <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_varphi_beta_raw_eqn</span><span class="o">.</span><span class="n">lhs</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">xi_varphi_beta_raw_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">eta</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta_</span><span class="p">}))</span>


    <span class="k">def</span> <span class="nf">define_xi_related_eqns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define equations related to surface erosion speed :math:`\xi`</span>
<span class="sd">        and its vertical behavior.</span>
<span class="sd">        The derivations below are for an erosion model with</span>
<span class="sd">        :math:`\left|\tan\beta\right|^\eta`, :math:`\eta=3/2`.</span>

<span class="sd">        Attributes:</span>
<span class="sd">            xiv_varphi_pxpz_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`\xi^{\downarrow} = - \dfrac{p_{x}^{\eta} \left(p_{x}^{2} + p_{z}^{2}\right)^{\tfrac{1}{2} - \tfrac{\eta}{2}} \varphi{\left(\mathbf{r} \right)}}{p_{z}}`</span>
<span class="sd">            px_xiv_varphi_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`\left(\xi^{\downarrow}\right)^{2}`</span>
<span class="sd">                :math:`\left(p_{x}^{2} p_{x}^{2 \eta} \left(p_{x}^{2} \</span>
<span class="sd">                + \frac{1}{\left(\xi^{\downarrow}\right)^{2}}\right)^{- \eta} \varphi^{2}{\left(\mathbf{r} \right)} - 1 \</span>
<span class="sd">                + \dfrac{p_{x}^{2 \eta} \left(p_{x}^{2} \</span>
<span class="sd">                + \frac{1}{\left(\xi^{\downarrow}\right)^{2}}\right)^{- \eta} \varphi^{2}{\left(\mathbf{r} \right)}}{\left(\xi^{\downarrow}\right)^{2}}\right)`</span>
<span class="sd">                :math:`\times\,\,\,\left(p_{x}^{2} p_{x}^{2 \eta} \left(p_{x}^{2} \</span>
<span class="sd">                + \frac{1}{\left(\xi^{\downarrow}\right)^{2}}\right)^{- \eta} \varphi^{2}{\left(\mathbf{r} \right)} + 1 \</span>
<span class="sd">                + \dfrac{p_{x}^{2 \eta} \left(p_{x}^{2} \</span>
<span class="sd">                + \frac{1}{\left(\xi^{\downarrow}\right)^{2}}\right)^{- \eta} \varphi^{2}{\left(\mathbf{r} \right)}}{\left(\xi^{\downarrow}\right)^{2}}\right) = 0`</span>
<span class="sd">            eta_dbldenom   (:class:`sympy.Int &lt;sympy.core.numbers.Integer&gt;`) :</span>
<span class="sd">                a convenience variable, recording double the denominator of :math:`\eta`, which must itself be a rational number</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">eta_dbldenom</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">denom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eta_</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xiv_varphi_pxpz_eqn</span> <span class="o">=</span> <span class="n">simplify</span><span class="p">(</span>
            <span class="n">Eq</span><span class="p">(</span> <span class="n">xiv</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_varphi_beta_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="o">/</span><span class="n">cos</span><span class="p">(</span><span class="n">beta</span><span class="p">))</span>
                                                <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tanbeta_pxpz_eqn</span><span class="p">))</span>
                                                <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cosbeta_pxpz_eqn</span><span class="p">))</span>
                                                <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sinbeta_pxpz_eqn</span><span class="p">))</span>
                                                <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">Abs</span><span class="p">(</span><span class="n">px</span><span class="p">):</span><span class="n">px</span><span class="p">})</span> <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">xiv_eqn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xiv_varphi_pxpz_eqn</span>
        <span class="n">px_xiv_varphi_eqn</span> <span class="o">=</span> <span class="n">simplify</span><span class="p">(</span>
            <span class="n">Eq</span><span class="p">(</span> <span class="p">(</span><span class="n">xiv_eqn</span><span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">Abs</span><span class="p">(</span><span class="n">px</span><span class="p">):</span><span class="n">px</span><span class="p">}))</span><span class="o">.</span><span class="n">rhs</span><span class="o">**</span><span class="n">eta_dbldenom</span>
                 <span class="o">-</span> <span class="n">xiv_eqn</span><span class="o">.</span><span class="n">lhs</span><span class="o">**</span><span class="n">eta_dbldenom</span> <span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pz_xiv_eqn</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="c1"># HACK!!  Get rid of xiv**2 multiplier... should be a cleaner way of doing this</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">px_xiv_varphi_eqn</span> <span class="o">=</span> <span class="n">factor</span><span class="p">(</span><span class="n">Eq</span><span class="p">(</span><span class="n">px_xiv_varphi_eqn</span><span class="o">.</span><span class="n">lhs</span><span class="o">/</span><span class="n">xiv</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eta__dbldenom</span> <span class="o">=</span> <span class="n">eta_dbldenom</span>


    <span class="k">def</span> <span class="nf">define_varphi_model_eqn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">do_new</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define flow component of erosion model function</span>


<span class="sd">        Attributes:</span>
<span class="sd">            varphi_model_ramp_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`\varphi{\left(\mathbf{r} \right)} = \varphi_0 \left(\varepsilon + \left(\dfrac{x_{1} - {r}^x}{x_{1}}\right)^{2 \mu}\right)`</span>
<span class="sd">            varphi_model_rampflat_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                    :math:`` TBD</span>
<span class="sd">            varphi_rx_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                specific choice of :math:`\varphi` model from the above</span>

<span class="sd">                - pure &quot;channel&quot; model `varphi_model_ramp_eqn` if `self.varphi_type==&#39;ramp&#39;`</span>

<span class="sd">                - &quot;hillslope-channel&quot; model `varphi_model_rampflat_eqn` if `self.varphi_type==&#39;ramp-flat&#39;`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># The implicit assumption here is that upstream area A ~ x^2,</span>
        <span class="c1">#   which will not be true for a &quot;hillslope&quot; component,</span>
        <span class="c1">#   and for which we should have a transition to A ~ x</span>
        <span class="k">if</span> <span class="n">do_new</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">varphi_model_ramp_eqn</span> \
                <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">varphi_r</span><span class="p">(</span><span class="n">rvec</span><span class="p">),</span> <span class="n">varphi_0</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">varepsilon</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">mu</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">x</span><span class="p">:</span><span class="n">Lc</span><span class="o">-</span><span class="n">rx</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">varphi_model_ramp_eqn</span> \
                <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">varphi_r</span><span class="p">(</span><span class="n">rvec</span><span class="p">),</span> <span class="n">varphi_0</span><span class="o">*</span><span class="p">((</span><span class="n">x</span><span class="o">/</span><span class="n">Lc</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">mu</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">varepsilon</span><span class="p">))</span><span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">x</span><span class="p">:</span><span class="n">Lc</span><span class="o">-</span><span class="n">rx</span><span class="p">})</span>


        <span class="c1"># self.varphi_model_rampmu_chi0_eqn \</span>
        <span class="c1">#  = Eq(varphi_r, varphi_0*((x/Lc)**(mu*2) + varepsilon)).subs({x:Lc-rx})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">varphi_model_rampflat_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">varphi_r</span><span class="p">(</span><span class="n">rvec</span><span class="p">),</span> <span class="n">simplify</span><span class="p">(</span>
            <span class="n">varphi_0</span><span class="o">*</span><span class="p">(</span>  <span class="p">(</span><span class="n">chi</span><span class="o">/</span><span class="p">(</span><span class="n">Lc</span><span class="p">))</span><span class="o">*</span><span class="n">integrate</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">/</span><span class="n">x_sigma</span><span class="p">)),</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">)</span>
                                <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">x</span><span class="p">:</span><span class="o">-</span><span class="n">rx</span><span class="o">+</span><span class="n">Lc</span><span class="p">})</span> <span class="p">))</span>
        <span class="n">smooth_step_fn</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">exp</span><span class="p">(((</span><span class="n">Lc</span><span class="o">-</span><span class="n">x_h</span><span class="p">)</span><span class="o">-</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">x_sigma</span><span class="p">))</span>
        <span class="c1"># smooth_break_fn = (1+(chi/(Lc))**mu*integrate(smooth_step_fn,x))</span>
        <span class="c1"># TODO: fix deprecated chi usage</span>
        <span class="n">smooth_break_fn</span> \
            <span class="o">=</span> <span class="n">simplify</span><span class="p">(</span>
                <span class="p">((</span><span class="n">chi</span><span class="o">/</span><span class="p">(</span><span class="n">Lc</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">integrate</span><span class="p">(</span><span class="n">smooth_step_fn</span><span class="p">,</span><span class="n">x</span><span class="p">))</span><span class="o">-</span><span class="n">chi</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">x_h</span><span class="o">/</span><span class="n">Lc</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">mu</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">varphi_model_rampflatmu_eqn</span> \
            <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">varphi_r</span><span class="p">(</span><span class="n">rvec</span><span class="p">),</span> <span class="n">simplify</span><span class="p">(</span>
                    <span class="n">varphi_0</span><span class="o">*</span><span class="n">smooth_break_fn</span><span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">x</span><span class="p">:</span><span class="n">Lc</span><span class="o">-</span><span class="n">x</span><span class="p">})</span><span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">x</span><span class="p">:</span><span class="n">rx</span><span class="p">})</span> <span class="p">)</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">varphi_type</span><span class="o">==</span><span class="s1">&#39;ramp&#39;</span><span class="p">:</span>
            <span class="n">varphi_model_eqn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">varphi_model_ramp_eqn</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">varphi_type</span><span class="o">==</span><span class="s1">&#39;ramp-flat&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu_</span><span class="o">==</span><span class="n">Rational</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
                <span class="n">varphi_model_eqn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">varphi_model_rampflat_eqn</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">varphi_model_eqn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">varphi_model_rampflatmu_eqn</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Unknown flow model&#39;</span><span class="p">)</span>
        <span class="c1"># self.varphi_rx_eqn = varphi_model_eqn.subs({varphi_r(rvec):varphi_rx})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">varphi_rx_eqn</span> <span class="o">=</span> <span class="n">varphi_model_eqn</span>


    <span class="k">def</span> <span class="nf">define_varphi_related_eqns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define further equations related to normal slowness :math:`p`</span>

<span class="sd">        Attributes:</span>
<span class="sd">            p_varphi_beta_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`p = \dfrac{1}{\varphi(\mathbf{r})|\sin\beta|^\eta}`</span>
<span class="sd">            p_varphi_pxpz_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`\sqrt{p_{x}^{2} + p_{z}^{2}} = \dfrac{\left(  {\sqrt{p_{x}^{2} + p_{z}^{2}}}  \right)^{\eta}}{\varphi{\left(\mathbf{r} \right)}{p_{x}}^\eta}`</span>
<span class="sd">            p_rx_pxpz_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`\sqrt{p_{x}^{2} + p_{z}^{2}}</span>
<span class="sd">                = \dfrac{p_{x}^{- \eta} x_{1}^{2 \mu} \left(p_{x}^{2} + p_{z}^{2}\right)^{\frac{\eta}{2}}}{\varphi_0 \left(\varepsilon x_{1}^{2 \mu} + \left(x_{1} - {r}^x\right)^{2 \mu}\right)}`</span>
<span class="sd">            p_rx_tanbeta_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`\sqrt{p_{x}^{2} + \dfrac{p_{x}^{2}}{\tan^{2}{\left(\beta \right)}}}</span>
<span class="sd">                = \dfrac{p_{x}^{- \eta} x_{1}^{2 \mu} \left(p_{x}^{2}</span>
<span class="sd">                + \dfrac{p_{x}^{2}}{\tan^{2}{\left(\beta \right)}}\right)^{\frac{\eta}{2}}}{\varphi_0 \left(\varepsilon x_{1}^{2 \mu} + \left(x_{1} - {r}^x\right)^{2 \mu}\right)}`</span>
<span class="sd">            px_beta_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`p_{x} = \dfrac{p_{x}^{- \eta} x_{1}^{2 \mu} \left(p_{x}^{2}</span>
<span class="sd">                + \dfrac{p_{x}^{2}}{\tan^{2}{\left(\beta \right)}}\right)^{\frac{\eta}{2}} \sin{\left(\beta \right)}}{\varphi_0 \left(\varepsilon x_{1}^{2 \mu} + \left(x_{1} - {r}^x\right)^{2 \mu}\right)}`</span>
<span class="sd">            pz_beta_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`p_{z} = - \dfrac{p_{x}^{- \eta} x_{1}^{2 \mu} \left(p_{x}^{2}</span>
<span class="sd">                + \dfrac{p_{x}^{2}}{\tan^{2}{\left(\beta \right)}}\right)^{\frac{\eta}{2}} \cos{\left(\beta \right)}}{\varphi_0 \left(\varepsilon x_{1}^{2 \mu} + \left(x_{1} - {r}^x\right)^{2 \mu}\right)}`</span>
<span class="sd">            xiv_pxpz_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`\xi^{\downarrow} = \dfrac{p_z}{p_x^{2} + p_z^{2}}`</span>
<span class="sd">            px_varphi_beta_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`p_{x} = \dfrac{\sin{\left(\beta \right)} \left|{\sin{\left(\beta \right)}}\right|^{- \eta}}{\varphi{\left(\mathbf{r} \right)}}`</span>
<span class="sd">            pz_varphi_beta_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`p_{z} = - \dfrac{\cos{\left(\beta \right)} \left|{\sin{\left(\beta \right)}}\right|^{- \eta}}{\varphi{\left(\mathbf{r} \right)}}`</span>
<span class="sd">            px_varphi_rx_beta_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`p_{x} = \dfrac{\sin{\left(\beta \right)} \left|{\sin{\left(\beta \right)}}\right|^{- \eta}}{\varphi_0 \left(\varepsilon + \left(\dfrac{x_{1} - {r}^x}{x_{1}}\right)^{2 \mu}\right)}`</span>
<span class="sd">            pz_varphi_rx_beta_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`p_{z} = - \dfrac{\cos{\left(\beta \right)} \left|{\sin{\left(\beta \right)}}\right|^{- \eta}}{\varphi_0 \left(\varepsilon + \left(\dfrac{x_{1} - {r}^x}{x_{1}}\right)^{2 \mu}\right)}`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_varphi_beta_eqn</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_xi_eqn</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_varphi_beta_eqn</span><span class="p">))</span>
        <span class="c1"># Note force px &gt;= 0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_varphi_pxpz_eqn</span>  <span class="o">=</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_varphi_beta_eqn</span>
                                          <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tanbeta_pxpz_eqn</span><span class="p">))</span>
                                          <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sinbeta_pxpz_eqn</span><span class="p">))</span>
                                          <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p_norm_pxpz_eqn</span><span class="p">))</span>
                                          <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">Abs</span><span class="p">(</span><span class="n">px</span><span class="p">):</span><span class="n">px</span><span class="p">})</span>
                                        <span class="p">)</span>
        <span class="c1"># Don&#39;t do this simplification step because it messes up</span>
        <span class="c1">#    later calc of rdotz_on_rdotx_eqn etc</span>
        <span class="c1"># if self.eta_==1 and self.beta_type==&#39;sin&#39;:</span>
        <span class="c1">#     self.p_varphi_pxpz_eqn \</span>
        <span class="c1">#   = simplify(Eq(self.p_varphi_pxpz_eqn.lhs/sqrt(px**2+pz**2),</span>
        <span class="c1">#                                  self.p_varphi_pxpz_eqn.rhs/sqrt(px**2+pz**2)))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">p_rx_pxpz_eqn</span> <span class="o">=</span> <span class="n">simplify</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p_varphi_pxpz_eqn</span><span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">varphi_r</span><span class="p">(</span><span class="n">rvec</span><span class="p">):</span><span class="bp">self</span><span class="o">.</span><span class="n">varphi_rx_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">})</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_rx_tanbeta_eqn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_rx_pxpz_eqn</span><span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">pz</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">pz_px_tanbeta_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">px_beta_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">px</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_rx_tanbeta_eqn</span><span class="o">.</span><span class="n">rhs</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pz_beta_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">pz</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">p_rx_tanbeta_eqn</span><span class="o">.</span><span class="n">rhs</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xiv_pxpz_eqn</span> <span class="o">=</span> <span class="n">simplify</span><span class="p">(</span><span class="n">Eq</span><span class="p">(</span><span class="n">xiv</span><span class="p">,</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="p">)</span>
               <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">cos</span><span class="p">(</span><span class="n">beta</span><span class="p">):</span><span class="mi">1</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">tan</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)})</span>
               <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="bp">self</span><span class="o">.</span><span class="n">tanbeta_pxpz_eqn</span><span class="o">.</span><span class="n">lhs</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">tanbeta_pxpz_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">})</span>
               <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="bp">self</span><span class="o">.</span><span class="n">p_norm_pxpz_eqn</span><span class="o">.</span><span class="n">lhs</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">p_norm_pxpz_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">}))</span>

        <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_varphi_beta_eqn</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_p_eqn</span><span class="p">))</span>\
                                     <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p_pz_cosbeta_eqn</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pz_varphi_beta_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">pz</span><span class="p">,</span> <span class="n">solve</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span><span class="n">pz</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pz_varphi_beta_eqn</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pz_px_tanbeta_eqn</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">px_varphi_beta_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">px</span><span class="p">,</span> <span class="n">solve</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span><span class="n">px</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pz_varphi_rx_beta_eqn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pz_varphi_beta_eqn</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">varphi_rx_eqn</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">px_varphi_rx_beta_eqn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">px_varphi_beta_eqn</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">varphi_rx_eqn</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">define_Fstar_eqns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define the fundamental function</span>

<span class="sd">        Attributes:</span>
<span class="sd">            Okubo_Fstar_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`\dfrac{\sqrt{p_{x}^{2} + p_{z}^{2}}}{F^{*}} = \dfrac{p_{x}^{- \eta} \left(p_{x}^{2} + p_{z}^{2}\right)^{\frac{\eta}{2}}}{\varphi{\left(\mathbf{r} \right)}}`</span>
<span class="sd">            Fstar_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`F^{*} = p_{x}^{\eta} \left(p_{x}^{2} + p_{z}^{2}\right)^{\frac{1}{2} - \frac{\eta}{2}} \varphi{\left(\mathbf{r} \right)}`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Note force px &gt;= 0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Okubo_Fstar_eqn</span> <span class="o">=</span> <span class="n">simplify</span><span class="p">(</span>
            <span class="n">Eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p_norm_pxpz_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="o">/</span><span class="n">Fstar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_varphi_pxpz_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">)</span> \
                <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">Abs</span><span class="p">(</span><span class="n">px</span><span class="p">):</span><span class="n">px</span><span class="p">,</span><span class="n">sign</span><span class="p">(</span><span class="n">px</span><span class="p">):</span><span class="mi">1</span><span class="p">})</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Fstar_eqn</span> \
          <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">Fstar</span><span class="p">,(</span><span class="n">solve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Okubo_Fstar_eqn</span><span class="p">,</span><span class="n">Fstar</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">varphi_rx</span><span class="p">(</span><span class="n">rx</span><span class="p">):</span><span class="n">varphi</span><span class="p">}))</span>\
                <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">Abs</span><span class="p">(</span><span class="n">px</span><span class="p">):</span><span class="n">px</span><span class="p">,</span><span class="n">sign</span><span class="p">(</span><span class="n">px</span><span class="p">):</span><span class="mi">1</span><span class="p">})</span>


    <span class="k">def</span> <span class="nf">define_H_eqns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define the Hamiltonian</span>


<span class="sd">        Attributes:</span>
<span class="sd">            H_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`H = \dfrac{p_{x}^{2 \eta} \left(p_{x}^{2} + p_{z}^{2}\right)^{1 - \eta} \varphi^{2}{\left(\mathbf{r} \right)}}{2}`</span>
<span class="sd">            H_varphi_rx_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`H = \dfrac{\varphi_0^{2} p_{x}^{2 \eta} x_{1}^{- 4 \mu} \left(p_{x}^{2} + p_{z}^{2}\right)^{1 - \eta} \left(\varepsilon x_{1}^{2 \mu} + \left(x_{1} - {r}^x\right)^{2 \mu}\right)^{2}}{2}`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H_eqn</span> <span class="o">=</span>  <span class="p">(</span> <span class="n">Eq</span><span class="p">(</span> <span class="n">H</span><span class="p">,</span> <span class="n">simplify</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Fstar_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>
                                <span class="c1"># .subs({Abs(px):px,sign(px):1})</span>
                            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H_varphi_rx_eqn</span> \
            <span class="o">=</span> <span class="n">simplify</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H_eqn</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">varphi_r</span><span class="p">(</span><span class="n">rvec</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">varphi_rx_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">define_rdot_eqns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define equations for :math:`\dot{r}`, the rate of change of position</span>



<span class="sd">        Attributes:</span>
<span class="sd">            rdotx_rdot_alpha_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`v^{x} = v \cos{\left(\alpha \right)}`</span>
<span class="sd">            rdotz_rdot_alpha_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`v^{z} = v \sin{\left(\alpha \right)}`</span>
<span class="sd">            rdotx_pxpz_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`v^{x} = p_{x}^{2 \eta - 1} \left(p_{x}^{2} + p_{z}^{2}\right)^{- \eta} \left(\eta p_{z}^{2} + p_{x}^{2}\right) \varphi^{2}{\left(\mathbf{r} \right)}`</span>
<span class="sd">            rdotz_pxpz_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`v^{z} = - p_{x}^{2 \eta} p_{z} \left(\eta - 1\right) \left(p_{x}^{2} + p_{z}^{2}\right)^{- \eta} \varphi^{2}{\left(\mathbf{r} \right)}`</span>
<span class="sd">            rdotz_on_rdotx_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`\dfrac{v^{z}}{v^{x}} = - \dfrac{p_{x} p_{z} \left(\eta - 1\right)}{\eta p_{z}^{2} + p_{x}^{2}}`</span>
<span class="sd">            rdotz_on_rdotx_tanbeta_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`\dfrac{v^{z}}{v^{x}} =   \dfrac{\left(\eta - 1\right) \tan{\left(\beta \right)}}{\eta + \tan^{2}{\left(\beta \right)}}`</span>
<span class="sd">            rdot_vec_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`\mathbf{v} = \left[\begin{matrix}p_{x}^{2 \eta - 1} \left(p_{x}^{2} + p_{z}^{2}\right)^{- \eta} \left(\eta p_{z}^{2} + p_{x}^{2}\right) \varphi^{2}{\left(\mathbf{r} \right)}\\- p_{x}^{2 \eta} p_{z} \left(\eta - 1\right) \left(p_{x}^{2} + p_{z}^{2}\right)^{- \eta} \varphi^{2}{\left(\mathbf{r} \right)}\end{matrix}\right]`</span>
<span class="sd">            rdot_p_unity_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`p_{x} v^{x} + p_{z} v^{z} = 1`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rdotx_rdot_alpha_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span> <span class="n">rdotx</span><span class="p">,</span> <span class="n">rdot</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rdotz_rdot_alpha_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span> <span class="n">rdotz</span><span class="p">,</span> <span class="n">rdot</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rdotx_pxpz_eqn</span> <span class="o">=</span> <span class="n">factor</span><span class="p">(</span> <span class="n">Eq</span><span class="p">(</span><span class="n">rdotx</span><span class="p">,</span> <span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">,</span><span class="n">px</span><span class="p">))</span> <span class="p">)</span>
                <span class="c1"># simplify(diff(self.H_eqn.rhs,px)).subs({Abs(px):px,sign(px):1}) ) )</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rdotz_pxpz_eqn</span> <span class="o">=</span> <span class="n">factor</span><span class="p">(</span> <span class="n">Eq</span><span class="p">(</span> <span class="n">rdotz</span><span class="p">,</span> <span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">,</span><span class="n">pz</span><span class="p">))</span> <span class="p">)</span>
        <span class="c1"># self.rdotz_pxpz_eqn \</span>
        <span class="c1">#     = simplify( simplify( Eq( rdotz, simplify(diff(self.H_eqn.rhs,pz))\</span>
        <span class="c1">#                                 .subs({Abs(px):px,sign(px):1}) ) )</span>
        <span class="c1">#                                     .subs({px:pxp}) ) \</span>
        <span class="c1">#                                         .subs({pxp:px})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rdotz_on_rdotx_eqn</span> \
            <span class="o">=</span> <span class="n">factor</span><span class="p">(</span> <span class="n">Eq</span><span class="p">(</span> <span class="n">rdotz</span><span class="o">/</span><span class="n">rdotx</span><span class="p">,</span>
                      <span class="n">simplify</span><span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rdotz_pxpz_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">rdotx_pxpz_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
                      <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">Abs</span><span class="p">(</span><span class="n">px</span><span class="p">):</span><span class="n">px</span><span class="p">})</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rdotz_on_rdotx_tanbeta_eqn</span> \
            <span class="o">=</span> <span class="n">factor</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">rdotz_on_rdotx_eqn</span><span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">px</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">px_pz_tanbeta_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">})</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rdot_vec_eqn</span> \
            <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">rdotvec</span><span class="p">,</span><span class="n">Matrix</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">rdotx_pxpz_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rdotz_pxpz_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rdot_p_unity_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span> <span class="n">rdotx</span><span class="o">*</span><span class="n">px</span><span class="o">+</span><span class="n">rdotz</span><span class="o">*</span><span class="n">pz</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">define_pdot_eqns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define equations for :math:`\dot{p}`, the rate of change of normal slowness</span>


<span class="sd">        Attributes:</span>
<span class="sd">            pdotx_pxpz_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`\dot{p}_x = 2 \mu \varphi_0^{2} p_{x}^{2 \eta} x_{1}^{- 4 \mu} \left(p_{x}^{2} + p_{z}^{2}\right)^{1 - \eta}</span>
<span class="sd">                \left(x_{1} - {r}^x\right)^{2 \mu - 1} \left(\varepsilon x_{1}^{2 \mu} + \left(x_{1} - {r}^x\right)^{2 \mu}\right)`</span>
<span class="sd">            pdotz_pxpz_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`\dot{p}_z = 0`</span>
<span class="sd">            pdot_covec_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`\mathbf{\dot{\widetilde{p}}} = \left[\begin{matrix}2 \mu \varphi_0^{2} p_{x}^{2 \eta} x_{1}^{- 4 \mu}</span>
<span class="sd">                \left(p_{x}^{2} + p_{z}^{2}\right)^{1 - \eta} \left(x_{1} - {r}^x\right)^{2 \mu - 1}</span>
<span class="sd">                \left(\varepsilon x_{1}^{2 \mu} + \left(x_{1} - {r}^x\right)^{2 \mu}\right) &amp; 0\end{matrix}\right]`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdotx_pxpz_eqn</span> \
            <span class="o">=</span> <span class="n">simplify</span><span class="p">(</span><span class="n">Eq</span><span class="p">(</span><span class="n">pdotx</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H_varphi_rx_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">,</span><span class="n">rx</span><span class="p">))</span> <span class="p">))</span>\
                    <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">Abs</span><span class="p">(</span><span class="n">pz</span><span class="p">):</span><span class="o">-</span><span class="n">pz</span><span class="p">,</span><span class="n">Abs</span><span class="p">(</span><span class="n">px</span><span class="p">):</span><span class="n">px</span><span class="p">,</span><span class="n">Abs</span><span class="p">(</span><span class="n">px</span><span class="o">*</span><span class="n">pz</span><span class="p">):</span><span class="o">-</span><span class="n">px</span><span class="o">*</span><span class="n">pz</span><span class="p">,</span><span class="n">Abs</span><span class="p">(</span><span class="n">px</span><span class="o">/</span><span class="n">pz</span><span class="p">):</span><span class="o">-</span><span class="n">px</span><span class="o">/</span><span class="n">pz</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdotz_pxpz_eqn</span> <span class="o">=</span> <span class="n">simplify</span><span class="p">(</span>
            <span class="n">Eq</span><span class="p">(</span><span class="n">pdotz</span><span class="p">,(</span><span class="mi">0</span><span class="o">*</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">varphi_rx_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">,</span><span class="n">rx</span><span class="p">)</span>
                       <span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">tanbeta_pxpz_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">)</span>
                       <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">H_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="o">/</span><span class="n">varphi_r</span><span class="p">(</span><span class="n">rvec</span><span class="p">)))</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdot_covec_eqn</span> \
            <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">pdotcovec</span><span class="p">,</span> <span class="n">Matrix</span><span class="p">([[</span><span class="bp">self</span><span class="o">.</span><span class="n">pdotx_pxpz_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">],</span>
                                    <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pdotz_pxpz_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">define_Hamiltons_eqns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define Hamilton&#39;s equations</span>


<span class="sd">        Attributes:</span>
<span class="sd">            hamiltons_eqns (:class:`sympy.Matrix &lt;sympy.matrices.immutable.ImmutableDenseMatrix&gt;` of :class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`\left[\begin{matrix}\</span>
<span class="sd">                \dot{r}^x = \varphi_0^{2} p_{x}^{2 \eta - 1} x_{1}^{- 4 \mu} \left(p_{x}^{2} + p_{z}^{2}\right)^{- \eta} \left(\eta p_{z}^{2} + p_{x}^{2}\right)</span>
<span class="sd">                \left(\varepsilon x_{1}^{2 \mu} + \left(x_{1} - {r}^x\right)^{2 \mu}\right)^{2}\\</span>
<span class="sd">                \dot{r}^z = - \varphi_0^{2} p_{x}^{2 \eta} p_{z} x_{1}^{- 4 \mu} \left(\eta - 1\right) \left(p_{x}^{2} + p_{z}^{2}\right)^{- \eta}</span>
<span class="sd">                \left(\varepsilon x_{1}^{2 \mu} + \left(x_{1} - {r}^x\right)^{2 \mu}\right)^{2}\\</span>
<span class="sd">                \dot{p}_x = 2 \mu \varphi_0^{2} p_{x}^{2 \eta} x_{1}^{- 4 \mu} \left(p_{x}^{2} + p_{z}^{2}\right)^{1 - \eta} \left(x_{1} - {r}^x\right)^{2 \mu - 1}</span>
<span class="sd">                \left(\varepsilon x_{1}^{2 \mu} + \left(x_{1} - {r}^x\right)^{2 \mu}\right)\\</span>
<span class="sd">                \dot{p}_z = 0</span>
<span class="sd">                \end{matrix}\right]`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hamiltons_eqns</span> \
            <span class="o">=</span> <span class="n">Matrix</span><span class="p">((</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rdotx_pxpz_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">varphi_rx_eqn</span><span class="p">)),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rdotz_pxpz_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">varphi_rx_eqn</span><span class="p">)),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pdotx_pxpz_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">varphi_rx_eqn</span><span class="p">)),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pdotz_pxpz_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">varphi_rx_eqn</span><span class="p">))</span>
                <span class="c1">#.subs({pdotz:pdotz_tfn})</span>
            <span class="p">))</span>


    <span class="k">def</span> <span class="nf">nondimensionalize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Non-dimensionalize variables, Hamiltonian, and Hamilton&#39;s equations;</span>
<span class="sd">        define dimensionless channel incision number :math:`\mathsf{Ci}`.</span>

<span class="sd">        Attributes:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">varsub</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rx_rxhat_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">rx</span><span class="p">,</span> <span class="n">Lc</span><span class="o">*</span><span class="n">rxhat</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rz_rzhat_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">rz</span><span class="p">,</span> <span class="n">Lc</span><span class="o">*</span><span class="n">rzhat</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">varepsilon_varepsilonhat_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">varepsilon</span><span class="p">,</span> <span class="n">Lc</span><span class="o">*</span><span class="n">varepsilonhat</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">varepsilonhat_varepsilon_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">varepsilonhat</span><span class="p">,</span>
            <span class="n">solve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">varepsilon_varepsilonhat_eqn</span><span class="p">,</span><span class="n">varepsilonhat</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">varphi_rxhat_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">varphi_rxhat_fn</span><span class="p">(</span><span class="n">rxhat</span><span class="p">),</span>
                                    <span class="n">factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">varphi_rx_eqn</span><span class="o">.</span><span class="n">rhs</span>
                                           <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rx_rxhat_eqn</span><span class="p">))</span>
                                           <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">varepsilon_varepsilonhat_eqn</span><span class="p">))</span>
                                           <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">varsub</span><span class="p">))</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">xi_rxhat_eqn</span> <span class="o">=</span> <span class="n">simplify</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_varphi_beta_eqn</span>
                                        <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">varphi_r</span><span class="p">(</span><span class="n">rvec</span><span class="p">):</span><span class="n">varphi_rxhat_fn</span><span class="p">(</span><span class="n">rxhat</span><span class="p">)})</span>
                                        <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">varphi_rxhat_eqn</span><span class="p">))</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">xih0_beta0_eqn</span> <span class="o">=</span> <span class="n">simplify</span><span class="p">(</span> <span class="n">Eq</span><span class="p">(</span><span class="n">xih_0</span><span class="p">,</span>
                                       <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_rxhat_eqn</span><span class="o">.</span><span class="n">rhs</span> <span class="o">/</span> <span class="n">sin</span><span class="p">(</span><span class="n">beta_0</span><span class="p">))</span>
                                           <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">varphi_rx_eqn</span><span class="p">))</span>
                                           <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">Abs</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">beta</span><span class="p">)):</span><span class="n">sin</span><span class="p">(</span><span class="n">beta_0</span><span class="p">)})</span>
                                           <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">rxhat</span><span class="p">:</span><span class="mi">0</span><span class="p">})</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">varsub</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xiv0_beta0_eqn</span> <span class="o">=</span> <span class="n">simplify</span><span class="p">(</span> <span class="n">Eq</span><span class="p">(</span><span class="n">xiv_0</span><span class="p">,</span>
                                       <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_rxhat_eqn</span><span class="o">.</span><span class="n">rhs</span> <span class="o">/</span> <span class="n">cos</span><span class="p">(</span><span class="n">beta_0</span><span class="p">))</span>
                                           <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">varphi_rx_eqn</span><span class="p">))</span>
                                           <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">Abs</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">beta</span><span class="p">)):</span><span class="n">sin</span><span class="p">(</span><span class="n">beta_0</span><span class="p">)})</span>
                                           <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">rxhat</span><span class="p">:</span><span class="mi">0</span><span class="p">})</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">varsub</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xih0_xiv0_beta0_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">((</span><span class="n">xih_0</span><span class="p">),</span>
                <span class="n">xiv_0</span><span class="o">*</span><span class="n">simplify</span><span class="p">(</span> <span class="p">(</span><span class="n">xih_0</span><span class="o">/</span><span class="n">xiv_0</span><span class="p">)</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xiv0_beta0_eqn</span><span class="p">))</span>
                                             <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xih0_beta0_eqn</span><span class="p">))</span> <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xih_xiv_tanbeta_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">xih</span><span class="p">,</span> <span class="n">xiv</span><span class="o">/</span><span class="n">tan</span><span class="p">(</span><span class="n">beta</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xiv_xih_tanbeta_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">xiv</span><span class="p">,</span> <span class="n">solve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xih_xiv_tanbeta_eqn</span><span class="p">,</span> <span class="n">xiv</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1">#Eq(xiv, xih*tan(beta))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">th0_xih0_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">th_0</span><span class="p">,</span> <span class="p">(</span><span class="n">Lc</span><span class="o">/</span><span class="n">xih_0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tv0_xiv0_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">tv_0</span><span class="p">,</span> <span class="p">(</span><span class="n">Lc</span><span class="o">/</span><span class="n">xiv_0</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">th0_beta0_eqn</span> <span class="o">=</span> <span class="n">factor</span><span class="p">(</span><span class="n">simplify</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">th0_xih0_eqn</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xih0_beta0_eqn</span><span class="p">))</span> <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tv0_beta0_eqn</span> <span class="o">=</span> <span class="n">simplify</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">tv0_xiv0_eqn</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xiv0_beta0_eqn</span><span class="p">))</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">t_that_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">th_0</span><span class="o">*</span><span class="n">that</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">px_pxhat_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">px</span><span class="p">,</span> <span class="n">pxhat</span><span class="o">/</span><span class="n">xih_0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pz_pzhat_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">pz</span><span class="p">,</span> <span class="n">pzhat</span><span class="o">/</span><span class="n">xih_0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pzhat_xiv_eqn</span> \
            <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">pzhat</span><span class="p">,</span> <span class="n">solve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pz_xiv_eqn</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pz_pzhat_eqn</span><span class="p">)),</span> <span class="n">pzhat</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">H_varphi_rxhat_eqn</span> <span class="o">=</span> <span class="n">factor</span><span class="p">(</span><span class="n">simplify</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H_varphi_rx_eqn</span>
                <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">varsub</span><span class="p">)</span>
                <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">varepsilon_varepsilonhat_eqn</span><span class="p">))</span>
                <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rx_rxhat_eqn</span><span class="p">))</span>
                <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">px_pxhat_eqn</span><span class="p">))</span>
                <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pz_pzhat_eqn</span><span class="p">))</span>
        <span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">H_split</span> <span class="o">=</span> <span class="p">(</span>
            <span class="mi">2</span><span class="o">*</span><span class="n">pxhat</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">eta</span><span class="p">)</span>
            <span class="o">*</span> <span class="p">(</span><span class="n">pxhat</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">pzhat</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">eta</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">rxhat</span><span class="o">+</span><span class="n">varepsilonhat</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">mu</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H_Ci_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">simplify</span><span class="p">(((</span><span class="n">sin</span><span class="p">(</span><span class="n">Ci</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">))</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">H_split</span><span class="p">)</span>
                                      <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H_varphi_rxhat_eqn</span><span class="p">)))</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">degCi_H0p5_eqn</span> \
            <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">Ci</span><span class="p">,</span> <span class="n">deg</span><span class="p">(</span><span class="n">solve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H_Ci_eqn</span><span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">H</span><span class="p">:</span><span class="n">Rational</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)}),</span><span class="n">Ci</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sinCi_xih0_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">Ci</span><span class="p">),</span> <span class="p">(((</span><span class="n">sqrt</span><span class="p">(</span><span class="n">simplify</span><span class="p">((</span><span class="n">H</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">H_split</span><span class="p">)</span>
                                <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H_varphi_rxhat_eqn</span><span class="p">)))))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">))))</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ci_xih0_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">Ci</span><span class="p">,</span> <span class="n">asin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sinCi_xih0_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sinCi_beta0_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">Ci</span><span class="p">),</span>
            <span class="n">factor</span><span class="p">(</span> <span class="n">simplify</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">sinCi_xih0_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xih0_beta0_eqn</span><span class="p">))</span> <span class="p">)</span> <span class="p">)</span>
                        <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">sin</span><span class="p">(</span><span class="n">beta_0</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">beta_0</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">eta</span><span class="p">):(</span><span class="n">sin</span><span class="p">(</span><span class="n">beta_0</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">))})</span>
                        <span class="o">.</span><span class="n">subs</span><span class="p">({(</span><span class="n">sin</span><span class="p">(</span><span class="n">beta_0</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">eta</span><span class="o">-</span><span class="mi">1</span><span class="p">)):</span><span class="n">sin</span><span class="p">(</span><span class="n">beta_0</span><span class="p">)})</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ci_beta0_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">Ci</span><span class="p">,</span> <span class="n">asin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sinCi_beta0_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta0_Ci_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">beta_0</span><span class="p">,</span> <span class="n">solve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ci_beta0_eqn</span><span class="p">,</span> <span class="n">beta_0</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rdotxhat_eqn</span> \
            <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">rdotxhat_thatfn</span><span class="p">(</span><span class="n">that</span><span class="p">),</span> <span class="n">simplify</span><span class="p">(</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H_Ci_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">,</span><span class="n">pxhat</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rdotzhat_eqn</span> \
            <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">rdotzhat_thatfn</span><span class="p">(</span><span class="n">that</span><span class="p">),</span> <span class="n">simplify</span><span class="p">(</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H_Ci_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">,</span><span class="n">pzhat</span><span class="p">)))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pdotxhat_eqn</span> \
            <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">pdotxhat_thatfn</span><span class="p">(</span><span class="n">that</span><span class="p">),</span> <span class="n">simplify</span><span class="p">(</span><span class="o">-</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H_Ci_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">,</span><span class="n">rxhat</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdotzhat_eqn</span> \
            <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">pdotzhat_thatfn</span><span class="p">(</span><span class="n">that</span><span class="p">),</span> <span class="n">simplify</span><span class="p">(</span><span class="o">-</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H_Ci_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">,</span><span class="n">rzhat</span><span class="p">)))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">xih0_Ci_eqn</span> <span class="o">=</span> <span class="n">factor</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">xih0_beta0_eqn</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beta0_Ci_eqn</span><span class="p">))</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">xih0_Lc_varphi0_Ci_eqn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xih0_Ci_eqn</span><span class="c1">#.subs({varepsilonhat:0})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xiv0_xih0_Ci_eqn</span> \
            <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xiv_xih_tanbeta_eqn</span><span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">xiv</span><span class="p">:</span><span class="n">xiv_0</span><span class="p">,</span> <span class="n">xih</span><span class="p">:</span><span class="n">xih_0</span><span class="p">,</span> <span class="n">beta</span><span class="p">:</span><span class="n">beta_0</span><span class="p">})</span> \
                                   <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beta0_Ci_eqn</span><span class="p">))</span>
                                   <span class="c1">#.subs({varepsilonhat:0})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xiv0_Lc_varphi0_Ci_eqn</span> <span class="o">=</span> <span class="n">simplify</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">xiv0_xih0_Ci_eqn</span>
                                               <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xih0_Lc_varphi0_Ci_eqn</span><span class="p">))</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">varphi0_Lc_xiv0_Ci_eqn</span> \
            <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">varphi_0</span><span class="p">,</span> <span class="n">solve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xiv0_Lc_varphi0_Ci_eqn</span><span class="p">,</span><span class="n">varphi_0</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> \
                                <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">Abs</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">Ci</span><span class="p">)):</span><span class="n">cos</span><span class="p">(</span><span class="n">Ci</span><span class="p">)})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ratio_xiv0_xih0_eqn</span> \
            <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">xiv_0</span><span class="o">/</span><span class="n">xih_0</span><span class="p">,</span> <span class="p">(</span><span class="n">xiv_0</span><span class="o">/</span><span class="n">xih_0</span><span class="p">)</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xiv0_xih0_Ci_eqn</span><span class="p">)))</span>


    <span class="k">def</span> <span class="nf">define_nodimensionalized_Hamiltons_eqns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hamiltons_ndim_eqns</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">((</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">rdotxhat_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">rdotzhat_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">pdotxhat_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">pdotzhat_eqn</span><span class="o">.</span><span class="n">rhs</span>
                                    <span class="p">))</span>


    <span class="k">def</span> <span class="nf">define_tanalpha_eqns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define equations for ray angle :math:`\tan(\alpha)`</span>


<span class="sd">        Attributes:</span>
<span class="sd">            tanalpha_pxpz_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`\tan{\left(\alpha \right)} = \dfrac{v^{z}}{v^{x}}`</span>
<span class="sd">            tanalpha_beta_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`\tan{\left(\alpha \right)} = - \dfrac{p_{x} p_{z} \left(\eta - 1\right)}{\eta p_{z}^{2} + p_{x}^{2}}`</span>
<span class="sd">            tanalpha_rdot_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`\tan{\left(\alpha \right)} = \dfrac{\left(\eta - 1\right) \tan{\left(\beta \right)}}{\eta + \tan^{2}{\left(\beta \right)}}`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tanalpha_rdot_eqn</span> \
            <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">simplify</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rdotz_rdot_alpha_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">rdotx_rdot_alpha_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">),</span>
                 <span class="n">rdotz</span><span class="o">/</span><span class="n">rdotx</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tanalpha_pxpz_eqn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tanalpha_rdot_eqn</span> \
            <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="bp">self</span><span class="o">.</span><span class="n">rdotz_on_rdotx_eqn</span><span class="o">.</span><span class="n">lhs</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">rdotz_on_rdotx_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tanalpha_beta_eqn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tanalpha_rdot_eqn</span> \
            <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="bp">self</span><span class="o">.</span><span class="n">rdotz_on_rdotx_eqn</span><span class="o">.</span><span class="n">lhs</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">rdotz_on_rdotx_tanbeta_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">})</span>


    <span class="k">def</span> <span class="nf">define_tanbeta_eqns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define equations for surface tilt angle :math:`\beta)`</span>




<span class="sd">        Attributes:</span>
<span class="sd">            tanbeta_alpha_eqns   (list of :class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`\left[ \tan{\left(\beta \right)} \</span>
<span class="sd">                = \dfrac{\eta - \sqrt{\eta^{2} - 4 \eta \tan^{2}{\left(\alpha \right)} - 2 \eta + 1} - 1}{2 \tan{\left(\alpha \right)}},</span>
<span class="sd">                \tan{\left(\beta \right)} = \dfrac{\eta + \sqrt{\eta^{2} - 4 \eta \tan^{2}{\left(\alpha \right)} - 2 \eta + 1} - 1}{2 \tan{\left(\alpha \right)}}\right]`</span>
<span class="sd">            tanbeta_alpha_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`\tan{\left(\beta \right)}</span>
<span class="sd">                = \dfrac{\eta - \sqrt{\eta^{2} - 4 \eta \tan^{2}{\left(\alpha \right)} - 2 \eta + 1} - 1}{2 \tan{\left(\alpha \right)}}`</span>
<span class="sd">            tanalpha_crit_eqns   (list of :class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`\left[ \tan{\left(\alpha_c \right)} = - \frac{\sqrt{\eta - 2 + \frac{1}{\eta}}}{2},</span>
<span class="sd">                \tan{\left(\alpha_c \right)} = \frac{\sqrt{\eta - 2 + \frac{1}{\eta}}}{2}\right]`</span>
<span class="sd">            tanalpha_crit_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`\tan{\left(\alpha_c \right)} = \dfrac{\eta - 1}{2 \sqrt{\eta}}`</span>
<span class="sd">            tanbeta_crit_eqns   (list of :class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`\left[ \tan{\left(\beta_c \right)} = - \dfrac{\eta - 1}{\sqrt{\eta - 2 + \frac{1}{\eta}}},</span>
<span class="sd">                \tan{\left(\beta_c \right)} = \dfrac{\eta - 1}{\sqrt{\eta - 2 + \frac{1}{\eta}}}\right]`</span>
<span class="sd">            tanbeta_crit_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`\tan{\left(\beta_c \right)} = \sqrt{\eta}`</span>
<span class="sd">            tanbeta_rdotxz_pz_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`\tan{\left(\beta \right)} = \dfrac{v^{z} - \frac{1}{p_{z}}}{v^{x}}`</span>
<span class="sd">            tanbeta_rdotxz_xiv_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`\tan{\left(\beta \right)} = \dfrac{\xi^{\downarrow} + v^{z}}{v^{x}}`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># eta_sub = {eta: self.eta_}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta_</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta_type</span><span class="o">==</span><span class="s1">&#39;sin&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span> <span class="sa">r</span><span class="s1">&#39;Cannot compute all $\beta$ equations &#39;</span>
                  <span class="o">+</span><span class="sa">r</span><span class="s1">&#39;for $\sin\beta$ model and $\eta=1$&#39;</span> <span class="p">)</span>
            <span class="k">return</span>
        <span class="n">solns</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tanalpha_beta_eqn</span><span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">tan</span><span class="p">(</span><span class="n">alpha</span><span class="p">):</span><span class="n">ta</span><span class="p">}),</span><span class="n">tan</span><span class="p">(</span><span class="n">beta</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tanbeta_alpha_eqns</span> \
            <span class="o">=</span> <span class="p">[</span><span class="n">Eq</span><span class="p">(</span><span class="n">tan</span><span class="p">(</span><span class="n">beta</span><span class="p">),</span> <span class="n">soln</span><span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">ta</span><span class="p">:</span><span class="n">tan</span><span class="p">(</span><span class="n">alpha</span><span class="p">)}))</span> <span class="k">for</span> <span class="n">soln</span> <span class="ow">in</span> <span class="n">solns</span><span class="p">]</span>
        <span class="c1"># Bit of a hack - extracts the square root term in tan(beta)</span>
        <span class="c1">#    as a fn of tan(alpha), which then gives the critical alpha</span>
        <span class="n">root_terms</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="n">arg_</span> <span class="k">for</span> <span class="n">arg__</span> <span class="ow">in</span> <span class="n">arg_</span><span class="o">.</span><span class="n">args</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg__</span><span class="p">,</span><span class="n">sy</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">Pow</span><span class="p">)</span>
                                          <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg_</span><span class="p">,</span><span class="n">sy</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">Pow</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">arg_</span> <span class="ow">in</span> <span class="n">numer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tanbeta_alpha_eqns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rhs</span><span class="p">)</span><span class="o">.</span><span class="n">args</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg_</span><span class="p">,(</span><span class="n">sy</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">mul</span><span class="o">.</span><span class="n">Mul</span><span class="p">,</span><span class="n">sy</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">Pow</span><span class="p">))</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tanalpha_crit_eqns</span> \
            <span class="o">=</span> <span class="p">[</span><span class="n">Eq</span><span class="p">(</span><span class="n">tan</span><span class="p">(</span><span class="n">alpha_crit</span><span class="p">),</span><span class="n">soln</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">soln</span> <span class="ow">in</span> <span class="n">solve</span><span class="p">(</span><span class="n">Eq</span><span class="p">(</span><span class="n">root_terms</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="mi">0</span><span class="p">),</span><span class="n">tan</span><span class="p">(</span><span class="n">alpha</span><span class="p">))</span> <span class="p">]</span>

        <span class="n">tac_lt1</span> <span class="o">=</span> <span class="n">simplify</span><span class="p">(</span> <span class="p">(</span><span class="n">factor</span><span class="p">(</span><span class="n">simplify</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tanalpha_crit_eqns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rhs</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">eta</span><span class="p">)</span>
                            <span class="p">))</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="n">eta</span><span class="p">))</span>
                <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">Abs</span><span class="p">(</span><span class="n">eta</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span><span class="mi">1</span><span class="o">-</span><span class="n">eta</span><span class="p">})</span>
        <span class="p">)</span>
        <span class="n">tac_gt1</span> <span class="o">=</span> <span class="n">simplify</span><span class="p">(</span>
            <span class="p">(</span><span class="n">factor</span><span class="p">(</span><span class="n">simplify</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tanalpha_crit_eqns</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rhs</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">eta</span><span class="p">)))</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="n">eta</span><span class="p">))</span>
                <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">Abs</span><span class="p">(</span><span class="n">eta</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span><span class="n">eta</span><span class="o">-</span><span class="mi">1</span><span class="p">})</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tanalpha_crit_eqn</span> \
            <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span> <span class="n">tan</span><span class="p">(</span><span class="n">alpha_crit</span><span class="p">),</span> <span class="n">Piecewise</span><span class="p">(</span> <span class="p">(</span><span class="n">tac_lt1</span><span class="p">,</span> <span class="n">eta</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">tac_gt1</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tanbeta_crit_eqns</span> \
            <span class="o">=</span> <span class="p">[</span><span class="n">factor</span><span class="p">(</span><span class="n">tanbeta_alpha_eqn_</span>
                        <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">beta</span><span class="p">:</span><span class="n">beta_crit</span><span class="p">,</span><span class="n">alpha</span><span class="p">:</span><span class="n">alpha_crit</span><span class="p">})</span>
                        <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="n">tanalpha_crit_eqn_</span><span class="p">)))</span>
                <span class="k">for</span> <span class="n">tanalpha_crit_eqn_</span><span class="p">,</span><span class="n">tanbeta_alpha_eqn_</span>
                <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tanalpha_crit_eqns</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tanbeta_alpha_eqns</span><span class="p">)]</span>
        <span class="c1"># This is a hack, because SymPy simplify can&#39;t handle it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tanbeta_crit_eqn</span> \
            <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">tan</span><span class="p">(</span><span class="n">beta_crit</span><span class="p">),</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">simplify</span><span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tanbeta_crit_eqns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rhs</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tanbeta_rdotxz_pz_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">tan</span><span class="p">(</span><span class="n">beta</span><span class="p">),</span> <span class="p">(</span><span class="n">rdotz</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="n">pz</span><span class="p">)</span><span class="o">/</span><span class="n">rdotx</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tanbeta_rdotxz_xiv_eqn</span> \
            <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tanbeta_rdotxz_pz_eqn</span><span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">pz</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">pz_xiv_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tanalpha_crit</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">N</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tanalpha_crit_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">eta</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta_</span><span class="p">})))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tanbeta_crit</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">N</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tanbeta_crit_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">eta</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta_</span><span class="p">})))</span>


    <span class="k">def</span> <span class="nf">define_psi_eqns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define equations for anisotropy angle :math:`\psi)`</span>

<span class="sd">        Attributes:</span>
<span class="sd">            psi_alpha_beta_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`\tan{\left(\beta \right)} = \dfrac{\xi^{\downarrow} + v^{z}}{v^{x}}`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">psi_alpha_beta_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="n">alpha</span><span class="o">-</span><span class="n">beta</span><span class="o">+</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">define_g_eqns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define equations for the metric tensor :math:`g` and its dual  :math:`g^*`</span>

<span class="sd">        Attributes:</span>
<span class="sd">            gstar_varphi_pxpz_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`g^{*} = \left[\begin{matrix}\</span>
<span class="sd">                \dfrac{2 p_{x}^{3} \varphi^{2}{\left(\mathbf{r} \right)}}{\left(p_{x}^{2} + p_{z}^{2}\right)^{\frac{3}{2}}} \</span>
<span class="sd">                - \dfrac{3 p_{x}^{3} \left(p_{x}^{2} + \dfrac{3 p_{z}^{2}}{2}\right) \varphi^{2}{\left(\mathbf{r} \right)}}{\left(p_{x}^{2} + p_{z}^{2}\right)^{\frac{5}{2}}} \</span>
<span class="sd">                + \dfrac{2 p_{x} \left(p_{x}^{2} + \dfrac{3 p_{z}^{2}}{2}\right) \varphi^{2}{\left(\mathbf{r} \right)}}{\left(p_{x}^{2} + p_{z}^{2}\right)^{\frac{3}{2}}} \</span>
<span class="sd">                &amp; \dfrac{3 p_{x}^{4} p_{z} \varphi^{2}{\left(\mathbf{r} \right)}}{2 \left(p_{x}^{2} + p_{z}^{2}\right)^{\frac{5}{2}}} \</span>
<span class="sd">                - \dfrac{3 p_{x}^{2} p_{z} \varphi^{2}{\left(\mathbf{r} \right)}}{2 \left(p_{x}^{2} + p_{z}^{2}\right)^{\frac{3}{2}}}\\ \</span>
<span class="sd">                \dfrac{3 p_{x}^{2} p_{z} \varphi^{2}{\left(\mathbf{r} \right)}}{\left(p_{x}^{2} + p_{z}^{2}\right)^{\frac{3}{2}}} \</span>
<span class="sd">                - \dfrac{3 p_{x}^{2} p_{z} \left(p_{x}^{2} + \dfrac{3 p_{z}^{2}}{2}\right) \varphi^{2}{\left(\mathbf{r} \right)}}{\left(p_{x}^{2} + p_{z}^{2}\right)^{\frac{5}{2}}} \</span>
<span class="sd">                &amp; \dfrac{3 p_{x}^{3} p_{z}^{2} \varphi^{2}{\left(\mathbf{r} \right)}}{2 \left(p_{x}^{2} + p_{z}^{2}\right)^{\frac{5}{2}}} \</span>
<span class="sd">                - \dfrac{p_{x}^{3} \varphi^{2}{\left(\mathbf{r} \right)}}{2 \left(p_{x}^{2} + p_{z}^{2}\right)^{\frac{3}{2}}}\</span>
<span class="sd">                \end{matrix}\right]`</span>
<span class="sd">            det_gstar_varphi_pxpz_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`\det\left(g^*\right) \</span>
<span class="sd">                = \dfrac{p_{x}^{4} \left(- \dfrac{p_{x}^{2}}{2} \</span>
<span class="sd">                + \dfrac{3 p_{z}^{2}}{4}\right) \varphi^{4}{\left(\mathbf{r} \right)}}{p_{x}^{6} + 3 p_{x}^{4} p_{z}^{2} + 3 p_{x}^{2} p_{z}^{4} + p_{z}^{6}}`</span>
<span class="sd">            g_varphi_pxpz_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`g = \left[\begin{matrix}\</span>
<span class="sd">                \dfrac{2 \left(p_{x}^{2} - 2 p_{z}^{2}\right) \sqrt{p_{x}^{2} + p_{z}^{2}}}{p_{x} \left(2 p_{x}^{2} - 3 p_{z}^{2}\right) \varphi^{2}{\left(\mathbf{r} \right)}} \</span>
<span class="sd">                &amp; - \dfrac{6 p_{z}^{3} \sqrt{p_{x}^{2} + p_{z}^{2}}}{p_{x}^{2} \left(2 p_{x}^{2} - 3 p_{z}^{2}\right) \varphi^{2}{\left(\mathbf{r} \right)}}\\ \</span>
<span class="sd">                - \dfrac{6 p_{z}^{3} \sqrt{p_{x}^{2} + p_{z}^{2}}}{p_{x}^{2} \left(2 p_{x}^{2} - 3 p_{z}^{2}\right) \varphi^{2}{\left(\mathbf{r} \right)}} \</span>
<span class="sd">                &amp; - \dfrac{4 p_{x}^{6} + 14 p_{x}^{4} p_{z}^{2} + 22 p_{x}^{2} p_{z}^{4} + 12 p_{z}^{6}}{p_{x}^{3} \sqrt{p_{x}^{2} + p_{z}^{2}} \left(2 p_{x}^{2} - 3 p_{z}^{2}\right) \varphi^{2}{\left(\mathbf{r} \right)}}\</span>
<span class="sd">                \end{matrix}\right]`</span>
<span class="sd">            gstar_eigen_varphi_pxpz   (list of :class:`sympy.Expr &lt;sympy.core.expr.Expr&gt;`) :</span>
<span class="sd">                eigenvalues and eigenvectors of :math:`g^{*}` in one object</span>
<span class="sd">            gstar_eigenvalues   (:class:`sympy.Matrix &lt;sympy.matrices.immutable.ImmutableDenseMatrix&gt;`) :</span>
<span class="sd">                :math:`\left[\begin{matrix}\</span>
<span class="sd">                \dfrac{\varphi_0^{2} p_{x} x_{1}^{- 4 \mu} \left(\varepsilon x_{1}^{2 \mu} + \left(x_{1} - {r}^x\right)^{2 \mu}\right)^{2} \left(- 3 \left(p_{x}^{2} + p_{z}^{2}\right) \sqrt{p_{x}^{12} + 4 p_{x}^{10} p_{z}^{2} + 10 p_{x}^{8} p_{z}^{4} + 20 p_{x}^{6} p_{z}^{6} + 25 p_{x}^{4} p_{z}^{8} + 16 p_{x}^{2} p_{z}^{10} + 4 p_{z}^{12}} + \left(p_{x}^{2} + 6 p_{z}^{2}\right) \left(p_{x}^{6} + 3 p_{x}^{4} p_{z}^{2} + 3 p_{x}^{2} p_{z}^{4} + p_{z}^{6}\right)\right)}{4 \left(p_{x}^{2} + p_{z}^{2}\right)^{\frac{3}{2}} \left(p_{x}^{6} + 3 p_{x}^{4} p_{z}^{2} + 3 p_{x}^{2} p_{z}^{4} + p_{z}^{6}\right)}\\\</span>
<span class="sd">                \dfrac{\varphi_0^{2} p_{x} x_{1}^{- 4 \mu} \left(\varepsilon x_{1}^{2 \mu} + \left(x_{1} - {r}^x\right)^{2 \mu}\right)^{2} \left(3 \left(p_{x}^{2} + p_{z}^{2}\right) \sqrt{p_{x}^{12} + 4 p_{x}^{10} p_{z}^{2} + 10 p_{x}^{8} p_{z}^{4} + 20 p_{x}^{6} p_{z}^{6} + 25 p_{x}^{4} p_{z}^{8} + 16 p_{x}^{2} p_{z}^{10} + 4 p_{z}^{12}} + \left(p_{x}^{2} + 6 p_{z}^{2}\right) \left(p_{x}^{6} + 3 p_{x}^{4} p_{z}^{2} + 3 p_{x}^{2} p_{z}^{4} + p_{z}^{6}\right)\right)}{4 \left(p_{x}^{2} + p_{z}^{2}\right)^{\frac{3}{2}} \left(p_{x}^{6} + 3 p_{x}^{4} p_{z}^{2} + 3 p_{x}^{2} p_{z}^{4} + p_{z}^{6}\right)}\</span>
<span class="sd">                \end{matrix}\right]`</span>
<span class="sd">            gstar_eigenvectors   (list containing pair of :class:`sympy.Matrix &lt;sympy.matrices.immutable.ImmutableDenseMatrix&gt;`) :</span>
<span class="sd">                :math:`\left[\</span>
<span class="sd">                \begin{matrix}\dfrac{p_{x} p_{z}^{3} \left(p_{x}^{6} + 2 p_{x}^{4} p_{z}^{2} + 3 p_{x}^{2} p_{z}^{4} + 2 p_{z}^{6} + \sqrt{p_{x}^{12} + 4 p_{x}^{10} p_{z}^{2} + 10 p_{x}^{8} p_{z}^{4} + 20 p_{x}^{6} p_{z}^{6} + 25 p_{x}^{4} p_{z}^{8} + 16 p_{x}^{2} p_{z}^{10} + 4 p_{z}^{12}}\right)}{p_{x}^{10} + 3 p_{x}^{8} p_{z}^{2} + 7 p_{x}^{6} p_{z}^{4} + 11 p_{x}^{4} p_{z}^{6} + p_{x}^{4} \sqrt{p_{x}^{12} + 4 p_{x}^{10} p_{z}^{2} + 10 p_{x}^{8} p_{z}^{4} + 20 p_{x}^{6} p_{z}^{6} + 25 p_{x}^{4} p_{z}^{8} + 16 p_{x}^{2} p_{z}^{10} + 4 p_{z}^{12}} + 10 p_{x}^{2} p_{z}^{8} + p_{x}^{2} p_{z}^{2} \sqrt{p_{x}^{12} + 4 p_{x}^{10} p_{z}^{2} + 10 p_{x}^{8} p_{z}^{4} + 20 p_{x}^{6} p_{z}^{6} + 25 p_{x}^{4} p_{z}^{8} + 16 p_{x}^{2} p_{z}^{10} + 4 p_{z}^{12}} + 4 p_{z}^{10} + 2 p_{z}^{4} \sqrt{p_{x}^{12} + 4 p_{x}^{10} p_{z}^{2} + 10 p_{x}^{8} p_{z}^{4} + 20 p_{x}^{6} p_{z}^{6} + 25 p_{x}^{4} p_{z}^{8} + 16 p_{x}^{2} p_{z}^{10} + 4 p_{z}^{12}}}\\ \</span>
<span class="sd">                1 \</span>
<span class="sd">                \end{matrix}\</span>
<span class="sd">                \right] \\ \</span>
<span class="sd">                \left[\</span>
<span class="sd">                \begin{matrix}\dfrac{p_{x} p_{z}^{3} \left(p_{x}^{6} + 2 p_{x}^{4} p_{z}^{2} + 3 p_{x}^{2} p_{z}^{4} + 2 p_{z}^{6} - \sqrt{p_{x}^{12} + 4 p_{x}^{10} p_{z}^{2} + 10 p_{x}^{8} p_{z}^{4} + 20 p_{x}^{6} p_{z}^{6} + 25 p_{x}^{4} p_{z}^{8} + 16 p_{x}^{2} p_{z}^{10} + 4 p_{z}^{12}}\right)}{p_{x}^{10} + 3 p_{x}^{8} p_{z}^{2} + 7 p_{x}^{6} p_{z}^{4} + 11 p_{x}^{4} p_{z}^{6} - p_{x}^{4} \sqrt{p_{x}^{12} + 4 p_{x}^{10} p_{z}^{2} + 10 p_{x}^{8} p_{z}^{4} + 20 p_{x}^{6} p_{z}^{6} + 25 p_{x}^{4} p_{z}^{8} + 16 p_{x}^{2} p_{z}^{10} + 4 p_{z}^{12}} + 10 p_{x}^{2} p_{z}^{8} - p_{x}^{2} p_{z}^{2} \sqrt{p_{x}^{12} + 4 p_{x}^{10} p_{z}^{2} + 10 p_{x}^{8} p_{z}^{4} + 20 p_{x}^{6} p_{z}^{6} + 25 p_{x}^{4} p_{z}^{8} + 16 p_{x}^{2} p_{z}^{10} + 4 p_{z}^{12}} + 4 p_{z}^{10} - 2 p_{z}^{4} \sqrt{p_{x}^{12} + 4 p_{x}^{10} p_{z}^{2} + 10 p_{x}^{8} p_{z}^{4} + 20 p_{x}^{6} p_{z}^{6} + 25 p_{x}^{4} p_{z}^{8} + 16 p_{x}^{2} p_{z}^{10} + 4 p_{z}^{12}}}\\ \</span>
<span class="sd">                1 \</span>
<span class="sd">                \end{matrix}\right]`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gstar_varphi_pxpz_eqn</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">det_gstar_varphi_pxpz_eqn</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g_varphi_pxpz_eqn</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gstar_eigen_varphi_pxpz</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gstar_eigenvalues</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gstar_eigenvectors</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">eta_sub</span> <span class="o">=</span> <span class="p">{</span><span class="n">eta</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta_</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gstar_varphi_pxpz_eqn</span> \
            <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">gstar</span><span class="p">,</span> <span class="n">factor</span><span class="p">(</span>
                    <span class="n">Matrix</span><span class="p">([</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rdot_vec_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_covec_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                            <span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rdot_vec_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_covec_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">])</span>
                <span class="p">))</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">eta_sub</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">det_gstar_varphi_pxpz_eqn</span> \
            <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">det_gstar</span><span class="p">,(</span><span class="n">simplify</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gstar_varphi_pxpz_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">eta_sub</span><span class="p">)</span><span class="o">.</span><span class="n">det</span><span class="p">())))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta_</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta_type</span><span class="o">==</span><span class="s1">&#39;sin&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Cannot compute all metric tensor $g^</span><span class="si">{ij}</span><span class="s1">$ equations &#39;</span><span class="o">+</span>
                  <span class="sa">r</span><span class="s1">&#39;for $\sin\beta$ model and $\eta=1$&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g_varphi_pxpz_eqn</span> \
            <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">simplify</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">gstar_varphi_pxpz_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">eta_sub</span><span class="p">)</span><span class="o">.</span><span class="n">inverse</span><span class="p">()</span> <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gstar_eigen_varphi_pxpz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gstar_varphi_pxpz_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="o">.</span><span class="n">eigenvects</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gstar_eigenvalues</span> <span class="o">=</span> <span class="n">simplify</span><span class="p">(</span>
            <span class="n">Matrix</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">gstar_eigen_varphi_pxpz</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gstar_eigen_varphi_pxpz</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span>
                    <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">varphi_r</span><span class="p">(</span><span class="n">rvec</span><span class="p">):</span><span class="bp">self</span><span class="o">.</span><span class="n">varphi_rx_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">})</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gstar_eigenvectors</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">[</span><span class="n">simplify</span><span class="p">(</span><span class="n">Matrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gstar_eigen_varphi_pxpz</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                            <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">varphi_r</span><span class="p">(</span><span class="n">rvec</span><span class="p">):</span><span class="bp">self</span><span class="o">.</span><span class="n">varphi_rx_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">})),</span>
             <span class="n">simplify</span><span class="p">(</span><span class="n">Matrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gstar_eigen_varphi_pxpz</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                            <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">varphi_r</span><span class="p">(</span><span class="n">rvec</span><span class="p">):</span><span class="bp">self</span><span class="o">.</span><span class="n">varphi_rx_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">}))]</span> <span class="p">)</span>


    <span class="k">def</span> <span class="nf">define_idtx_fgtx_eqns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define indicatrix and figuratrix equations</span>



<span class="sd">        Attributes:</span>
<span class="sd">            pz_cosbeta_varphi_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`p_{z}^{4} = \dfrac{\cos^{4}{\left(\beta \right)}}{\varphi^{4} \left(1 - \cos^{2}{\left(\beta \right)}\right)^{3}}`</span>
<span class="sd">            cosbetasqrd_pz_varphi_solns  (list of :class:`sympy.Expr &lt;sympy.core.expr.Expr&gt;`) :</span>
<span class="sd">                :math:`\left[</span>
<span class="sd">                -\frac{ \left(  -6 \varphi^{4} p_{z}^{4} \sqrt[3]{27 \varphi^{8} p_{z}^{8} - 18 \varphi^{4} p_{z}^{4}</span>
<span class="sd">                + \sqrt{729 \varphi^{16} p_{z}^{16} - 108 \varphi^{12} p_{z}^{12}} + 2} - 12 \sqrt[3]{2} \varphi^{4} p_{z}^{4}</span>
<span class="sd">                + 2^{\frac{2}{3}} \left(27 \varphi^{8} p_{z}^{8} - 18 \varphi^{4} p_{z}^{4}</span>
<span class="sd">                + \sqrt{729 \varphi^{16} p_{z}^{16} - 108 \varphi^{12} p_{z}^{12}} + 2\right)^{\frac{2}{3}}</span>
<span class="sd">                + 2 \sqrt[3]{27 \varphi^{8} p_{z}^{8} - 18 \varphi^{4} p_{z}^{4} + \sqrt{729 \varphi^{16} p_{z}^{16}</span>
<span class="sd">                - 108 \varphi^{12} p_{z}^{12}} + 2} + 2 \sqrt[3]{2} \right)</span>
<span class="sd">                }{6 \varphi^{4} p_{z}^{4} \sqrt[3]{27 \varphi^{8} p_{z}^{8}</span>
<span class="sd">                - 18 \varphi^{4} p_{z}^{4} + \sqrt{729 \varphi^{16} p_{z}^{16} - 108 \varphi^{12} p_{z}^{12}} + 2}}</span>
<span class="sd">                ,\dots \right]`</span>
<span class="sd">            fgtx_cossqrdbeta_pz_varphi_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`\cos^{2}{\left(\beta \right)}</span>
<span class="sd">                = - \frac{- 6 \varphi^{4} p_{z}^{4} \sqrt[3]{27 \varphi^{8} p_{z}^{8} - 18 \varphi^{4} p_{z}^{4}</span>
<span class="sd">                + \sqrt{729 \varphi^{16} p_{z}^{16} - 108 \varphi^{12} p_{z}^{12}} + 2} - 12 \sqrt[3]{2} \varphi^{4} p_{z}^{4}</span>
<span class="sd">                + 2^{\frac{2}{3}} \left(27 \varphi^{8} p_{z}^{8} - 18 \varphi^{4} p_{z}^{4} + \sqrt{729 \varphi^{16} p_{z}^{16}</span>
<span class="sd">                - 108 \varphi^{12} p_{z}^{12}} + 2\right)^{\frac{2}{3}} + 2 \sqrt[3]{27 \varphi^{8} p_{z}^{8}</span>
<span class="sd">                - 18 \varphi^{4} p_{z}^{4} + \sqrt{729 \varphi^{16} p_{z}^{16} - 108 \varphi^{12} p_{z}^{12}} + 2}</span>
<span class="sd">                + 2 \sqrt[3]{2}}{6 \varphi^{4} p_{z}^{4} \sqrt[3]{27 \varphi^{8} p_{z}^{8} - 18 \varphi^{4} p_{z}^{4}</span>
<span class="sd">                + \sqrt{729 \varphi^{16} p_{z}^{16} - 108 \varphi^{12} p_{z}^{12}} + 2}}`</span>
<span class="sd">            fgtx_tanbeta_pz_varphi_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`\tan{\left(\beta \right)}</span>
<span class="sd">                = \sqrt{\frac{- 12 \sqrt[3]{2} \varphi^{4} p_{z}^{4} + 2^{\frac{2}{3}} \left(27 \varphi^{8} p_{z}^{8}</span>
<span class="sd">                - 18 \varphi^{4} p_{z}^{4} + \sqrt{729 \varphi^{16} p_{z}^{16} - 108 \varphi^{12} p_{z}^{12}} + 2\right)^{\frac{2}{3}}</span>
<span class="sd">                + 2 \sqrt[3]{27 \varphi^{8} p_{z}^{8} - 18 \varphi^{4} p_{z}^{4} + \sqrt{729 \varphi^{16} p_{z}^{16}</span>
<span class="sd">                - 108 \varphi^{12} p_{z}^{12}} + 2} + 2 \sqrt[3]{2}}{6 \varphi^{4} p_{z}^{4} \sqrt[3]{27 \varphi^{8} p_{z}^{8}</span>
<span class="sd">                - 18 \varphi^{4} p_{z}^{4} + \sqrt{729 \varphi^{16} p_{z}^{16} - 108 \varphi^{12} p_{z}^{12}} + 2}</span>
<span class="sd">                + 12 \sqrt[3]{2} \varphi^{4} p_{z}^{4} - 2^{\frac{2}{3}} \left(27 \varphi^{8} p_{z}^{8}</span>
<span class="sd">                - 18 \varphi^{4} p_{z}^{4} + \sqrt{729 \varphi^{16} p_{z}^{16} - 108 \varphi^{12} p_{z}^{12}} + 2\right)^{\frac{2}{3}}</span>
<span class="sd">                - 2 \sqrt[3]{27 \varphi^{8} p_{z}^{8} - 18 \varphi^{4} p_{z}^{4} + \sqrt{729 \varphi^{16} p_{z}^{16}</span>
<span class="sd">                - 108 \varphi^{12} p_{z}^{12}} + 2} - 2 \sqrt[3]{2}}}`</span>
<span class="sd">            fgtx_px_pz_varphi_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`p_{x}</span>
<span class="sd">                = - p_{z} \sqrt{\frac{- 12 \sqrt[3]{2} \varphi^{4} p_{z}^{4} + 2^{\frac{2}{3}} \left(27 \varphi^{8} p_{z}^{8}</span>
<span class="sd">                - 18 \varphi^{4} p_{z}^{4} + \sqrt{729 \varphi^{16} p_{z}^{16} - 108 \varphi^{12} p_{z}^{12}} + 2\right)^{\frac{2}{3}}</span>
<span class="sd">                + 2 \sqrt[3]{27 \varphi^{8} p_{z}^{8} - 18 \varphi^{4} p_{z}^{4} + \sqrt{729 \varphi^{16} p_{z}^{16}</span>
<span class="sd">                - 108 \varphi^{12} p_{z}^{12}} + 2} + 2 \sqrt[3]{2}}{6 \varphi^{4} p_{z}^{4} \sqrt[3]{27 \varphi^{8} p_{z}^{8}</span>
<span class="sd">                - 18 \varphi^{4} p_{z}^{4} + \sqrt{729 \varphi^{16} p_{z}^{16} - 108 \varphi^{12} p_{z}^{12}} + 2}</span>
<span class="sd">                + 12 \sqrt[3]{2} \varphi^{4} p_{z}^{4} - 2^{\frac{2}{3}} \left(27 \varphi^{8} p_{z}^{8}</span>
<span class="sd">                - 18 \varphi^{4} p_{z}^{4} + \sqrt{729 \varphi^{16} p_{z}^{16} - 108 \varphi^{12} p_{z}^{12}} + 2\right)^{\frac{2}{3}}</span>
<span class="sd">                - 2 \sqrt[3]{27 \varphi^{8} p_{z}^{8} - 18 \varphi^{4} p_{z}^{4} + \sqrt{729 \varphi^{16} p_{z}^{16}</span>
<span class="sd">                - 108 \varphi^{12} p_{z}^{12}} + 2} - 2 \sqrt[3]{2}}}`</span>
<span class="sd">            idtx_rdotx_pz_varphi_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`{r}^x = \dfrac{\sqrt{6} \left(- 81 \cdot 2^{\frac{2}{3}} \varphi^{12} p_{z}^{12} \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} - 378 \varphi^{12} p_{z}^{12} - 9 \cdot 2^{\frac{2}{3}} \sqrt{3} \varphi^{10} p_{z}^{10} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} - 42 \sqrt{3} \varphi^{10} p_{z}^{10} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} + 45 \sqrt[3]{2} \varphi^{8} p_{z}^{8} \left(27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2\right)^{\frac{2}{3}} + 96 \cdot 2^{\frac{2}{3}} \varphi^{8} p_{z}^{8} \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} + 306 \varphi^{8} p_{z}^{8} + \sqrt[3]{2} \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} \left(27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2\right)^{\frac{2}{3}} + 2 \cdot 2^{\frac{2}{3}} \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} + 6 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 20 \sqrt[3]{2} \varphi^{4} p_{z}^{4} \left(27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2\right)^{\frac{2}{3}} - 26 \cdot 2^{\frac{2}{3}} \varphi^{4} p_{z}^{4} \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} - 64 \varphi^{4} p_{z}^{4} + 2 \sqrt[3]{2} \left(27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2\right)^{\frac{2}{3}} + 2 \cdot 2^{\frac{2}{3}} \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} + 4\right)}{72 \varphi^{4} p_{z}^{5} \left(\frac{\sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2}}{6 \varphi^{4} p_{z}^{4} \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} + 12 \sqrt[3]{2} \varphi^{4} p_{z}^{4} - 2^{\frac{2}{3}} \left(27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2\right)^{\frac{2}{3}} - 2 \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} - 2 \sqrt[3]{2}}\right)^{\frac{3}{2}} \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} \left(- 54 \cdot 2^{\frac{2}{3}} \varphi^{12} p_{z}^{12} - 6 \cdot 2^{\frac{2}{3}} \sqrt{3} \varphi^{10} p_{z}^{10} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} + 6 \varphi^{8} p_{z}^{8} \left(27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2\right)^{\frac{2}{3}} + 33 \sqrt[3]{2} \varphi^{8} p_{z}^{8} \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} + 78 \cdot 2^{\frac{2}{3}} \varphi^{8} p_{z}^{8} + \sqrt[3]{2} \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} + 2 \cdot 2^{\frac{2}{3}} \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 12 \varphi^{4} p_{z}^{4} \left(27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2\right)^{\frac{2}{3}} - 18 \sqrt[3]{2} \varphi^{4} p_{z}^{4} \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} - 24 \cdot 2^{\frac{2}{3}} \varphi^{4} p_{z}^{4} + 2 \left(27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2\right)^{\frac{2}{3}} + 2 \sqrt[3]{2} \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} + 2 \cdot 2^{\frac{2}{3}}\right)}`</span>
<span class="sd">            idtx_rdotz_pz_varphi_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`{r}^z = \dfrac{\sqrt{6} \sqrt{\frac{- 12 \sqrt[3]{2} \varphi^{4} p_{z}^{4} + 2^{\frac{2}{3}} \left(27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2\right)^{\frac{2}{3}} + 2 \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} + 2 \sqrt[3]{2}}{6 \varphi^{4} p_{z}^{4} \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} + 12 \sqrt[3]{2} \varphi^{4} p_{z}^{4} - 2^{\frac{2}{3}} \left(27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2\right)^{\frac{2}{3}} - 2 \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} - 2 \sqrt[3]{2}}} \left(27 \cdot 2^{\frac{2}{3}} \varphi^{8} p_{z}^{8} + 3 \cdot 2^{\frac{2}{3}} \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 12 \sqrt[3]{2} \varphi^{4} p_{z}^{4} \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} - 18 \cdot 2^{\frac{2}{3}} \varphi^{4} p_{z}^{4} + 2 \left(27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2\right)^{\frac{2}{3}} + 2 \sqrt[3]{2} \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} + 2 \cdot 2^{\frac{2}{3}}\right)}{72 \varphi^{4} p_{z}^{5} \left(\frac{\sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2}}{6 \varphi^{4} p_{z}^{4} \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} + 12 \sqrt[3]{2} \varphi^{4} p_{z}^{4} - 2^{\frac{2}{3}} \left(27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2\right)^{\frac{2}{3}} - 2 \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} - 2 \sqrt[3]{2}}\right)^{\frac{3}{2}} \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} \left(- 6 \varphi^{4} p_{z}^{4} \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} - 12 \sqrt[3]{2} \varphi^{4} p_{z}^{4} + 2^{\frac{2}{3}} \left(27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2\right)^{\frac{2}{3}} + 2 \sqrt[3]{27 \varphi^{8} p_{z}^{8} + 3 \sqrt{3} \varphi^{6} p_{z}^{6} \sqrt{27 \varphi^{4} p_{z}^{4} - 4} - 18 \varphi^{4} p_{z}^{4} + 2} + 2 \sqrt[3]{2}\right)}`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if self.eta_ == 2:</span>
        <span class="c1">#     pz_tanbeta_varphi_eqn = ( self.pz_p_beta_eqn</span>
        <span class="c1">#      .subs({p:self.p_varphi_beta_eqn.rhs})</span>
        <span class="c1">#      .subs({varphi_r(rvec):varphi})</span>
        <span class="c1">#      .subs({cos(beta):sqrt(1/(1+tan(beta)**2))})</span>
        <span class="c1">#      .subs({Abs(tan(beta)):tan(beta)})</span>
        <span class="c1">#     )</span>
        <span class="c1">#     tanbeta_pz_varphi_solns = solve( pz_tanbeta_varphi_eqn, tan(beta) )</span>
        <span class="c1">#     tanbeta_pz_varphi_eqn = Eq(tan(beta), ([soln for soln in tanbeta_pz_varphi_solns</span>
        <span class="c1">#                                         if Abs(im(N(soln.subs({varphi:1,pz:1}))))&lt;1e-20][0]) )</span>
        <span class="c1">#     self.fgtx_tanbeta_pz_varphi_eqn = tanbeta_pz_varphi_eqn</span>
        <span class="c1">#     self.fgtx_cossqrdbeta_pz_varphi_eqn = Eq(cos(beta)**2, 1/(1+tanbeta_pz_varphi_eqn.rhs**2))</span>
        <span class="c1"># else:</span>
        <span class="n">eta_sub</span> <span class="o">=</span> <span class="p">{</span><span class="n">eta</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta_</span><span class="p">}</span>
        <span class="n">pz_cosbeta_varphi_tmp_eqn</span> <span class="o">=</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">pz_p_beta_eqn</span>
         <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">p</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">p_varphi_beta_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">})</span>
         <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">varphi_r</span><span class="p">(</span><span class="n">rvec</span><span class="p">):</span><span class="n">varphi</span><span class="p">})</span>
         <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">eta_sub</span><span class="p">)</span>
         <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">Abs</span><span class="p">(</span><span class="n">tan</span><span class="p">(</span><span class="n">beta</span><span class="p">)):</span><span class="n">Abs</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">beta</span><span class="p">))</span><span class="o">/</span><span class="n">Abs</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">beta</span><span class="p">))})</span>
         <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">Abs</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">beta</span><span class="p">)):</span><span class="n">cos</span><span class="p">(</span><span class="n">beta</span><span class="p">),</span> <span class="n">Abs</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">beta</span><span class="p">)):</span><span class="n">sin</span><span class="p">(</span><span class="n">beta</span><span class="p">)})</span>
         <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">sin</span><span class="p">(</span><span class="n">beta</span><span class="p">):</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)})</span>
        <span class="p">)</span>
        <span class="n">pz_cosbeta_varphi_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span> <span class="n">pz_cosbeta_varphi_tmp_eqn</span><span class="o">.</span><span class="n">lhs</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">eta__dbldenom</span><span class="p">,</span>
                                    <span class="n">pz_cosbeta_varphi_tmp_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">eta__dbldenom</span> <span class="p">)</span>

        <span class="c1"># New</span>
        <span class="c1"># pz_cosbeta_varphi_eqn \</span>
        <span class="c1"># = (self.pz_varphi_beta_eqn.subs({Abs(sin(beta)**self.eta_):sin(beta)**self.eta_})</span>
        <span class="c1">#                                  .subs({varphi_r(rvec):varphi})</span>
        <span class="c1">#                                  .subs({sin(beta):sqrt(1-cos(beta)**2)}))</span>
        <span class="c1"># cosbetasqrd_pz_varphi_soln = (solve( pz_cosbeta_varphi_eqn, cos(beta)**2 ))[0]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pz_cosbeta_varphi_eqn</span> <span class="o">=</span> <span class="n">pz_cosbeta_varphi_eqn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cosbetasqrd_pz_varphi_solns</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cosbetasqrd_pz_varphi_soln</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fgtx_cossqrdbeta_pz_varphi_eqn</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fgtx_tanbeta_pz_varphi_eqn</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fgtx_px_pz_varphi_eqn</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idtx_rdotx_pz_varphi_eqn</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idtx_rdotz_pz_varphi_eqn</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cosbetasqrd_pz_varphi_solns</span> \
            <span class="o">=</span> <span class="n">solve</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">pz_cosbeta_varphi_eqn</span><span class="p">,</span> <span class="n">cos</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eta_</span><span class="o">==</span><span class="n">Rational</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta_</span><span class="o">==</span><span class="n">Rational</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> \
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta_type</span><span class="o">==</span><span class="s1">&#39;tan&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;Cannot compute all indicatrix equations for &#39;</span>
                  <span class="o">+</span><span class="sa">rf</span><span class="s1">&#39;$\tan\beta$ model and $\eta=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">eta_</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">def</span> <span class="nf">find_cosbetasqrd_root</span><span class="p">(</span><span class="n">sub</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span> <span class="n">soln</span> <span class="k">for</span> <span class="n">soln</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cosbetasqrd_pz_varphi_solns</span>
                     <span class="k">if</span> <span class="n">Abs</span><span class="p">(</span><span class="n">im</span><span class="p">(</span><span class="n">N</span><span class="p">(</span><span class="n">soln</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">sub</span><span class="p">))))</span><span class="o">&lt;</span><span class="mf">1e-20</span> <span class="ow">and</span> <span class="p">(</span><span class="n">re</span><span class="p">(</span><span class="n">N</span><span class="p">(</span><span class="n">soln</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">sub</span><span class="p">))))</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="p">]</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">cosbetasqrd_pz_varphi_soln</span> <span class="o">=</span> <span class="n">find_cosbetasqrd_root</span><span class="p">({</span><span class="n">varphi</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="n">pz</span><span class="p">:</span><span class="o">-</span><span class="mf">0.01</span><span class="p">})</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cosbetasqrd_pz_varphi_soln</span><span class="o">==</span><span class="p">[]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cosbetasqrd_pz_varphi_soln</span> <span class="o">=</span> <span class="n">find_cosbetasqrd_root</span><span class="p">({</span><span class="n">varphi</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="n">pz</span><span class="p">:</span><span class="o">-</span><span class="mf">0.5</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fgtx_cossqrdbeta_pz_varphi_eqn</span> \
            <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cosbetasqrd_pz_varphi_soln</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fgtx_tanbeta_pz_varphi_eqn</span> \
            <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span> <span class="n">tan</span><span class="p">(</span><span class="n">beta</span><span class="p">),</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fgtx_cossqrdbeta_pz_varphi_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fgtx_px_pz_varphi_eqn</span> \
            <span class="o">=</span> <span class="n">factor</span><span class="p">(</span> <span class="n">Eq</span><span class="p">(</span><span class="n">px</span><span class="p">,</span> <span class="o">-</span><span class="n">pz</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">fgtx_tanbeta_pz_varphi_eqn</span><span class="o">.</span><span class="n">rhs</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">g_xx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gstar_varphi_pxpz_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">g_zx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gstar_varphi_pxpz_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">g_xz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gstar_varphi_pxpz_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">g_zz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gstar_varphi_pxpz_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idtx_rdotx_pz_varphi_eqn</span> <span class="o">=</span> <span class="n">factor</span><span class="p">(</span>
            <span class="n">Eq</span><span class="p">(</span><span class="n">rx</span><span class="p">,</span> <span class="p">(</span><span class="n">g_xx</span><span class="o">*</span><span class="n">px</span><span class="o">+</span><span class="n">g_xz</span><span class="o">*</span><span class="n">pz</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">px</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">fgtx_px_pz_varphi_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">,</span><span class="n">varphi_r</span><span class="p">(</span><span class="n">rvec</span><span class="p">):</span><span class="n">varphi</span><span class="p">}))</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idtx_rdotz_pz_varphi_eqn</span> <span class="o">=</span> <span class="n">factor</span><span class="p">(</span><span class="n">factor</span><span class="p">(</span>
            <span class="n">Eq</span><span class="p">(</span><span class="n">rz</span><span class="p">,</span> <span class="p">(</span><span class="n">g_zx</span><span class="o">*</span><span class="n">px</span><span class="o">+</span><span class="n">g_zz</span><span class="o">*</span><span class="n">pz</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">px</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">fgtx_px_pz_varphi_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">,</span><span class="n">varphi_r</span><span class="p">(</span><span class="n">rvec</span><span class="p">):</span><span class="n">varphi</span><span class="p">}))</span>
        <span class="p">))</span>


    <span class="k">def</span> <span class="nf">prep_geodesic_eqns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define geodesic equations</span>

<span class="sd">        Args:</span>
<span class="sd">            parameters (dict): dictionary of model parameter values to be used for equation substitutions</span>

<span class="sd">        Attributes:</span>
<span class="sd">            gstar_ij_tanbeta_mat   (:class:`sympy.ImmutableDenseMatrix &lt;sympy.matrices.immutable.ImmutableDenseMatrix&gt;`) :</span>
<span class="sd">                :math:`\dots`</span>
<span class="sd">            g_ij_tanbeta_mat   (:class:`sympy.ImmutableDenseMatrix &lt;sympy.matrices.immutable.ImmutableDenseMatrix&gt;`) :</span>
<span class="sd">                :math:`\dots`</span>
<span class="sd">            tanbeta_poly_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`\dots` where :math:`a := \tan\alpha`</span>
<span class="sd">            tanbeta_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`\tan{\left(\beta \right)} = \dots` where :math:`a := \tan\alpha`</span>
<span class="sd">            gstar_ij_tanalpha_mat   (:class:`sympy.ImmutableDenseMatrix &lt;sympy.matrices.immutable.ImmutableDenseMatrix&gt;`) :</span>
<span class="sd">                a symmetric tensor with components (using shorthand :math:`a := \tan\alpha`)</span>

<span class="sd">                :math:`g^*[1,1] = \dots`</span>

<span class="sd">                :math:`g^*[1,2] = g^*[2,1] = \dots`</span>

<span class="sd">                :math:`g^*[2,2] = \dots`</span>
<span class="sd">            gstar_ij_mat   (:class:`sympy.ImmutableDenseMatrix &lt;sympy.matrices.immutable.ImmutableDenseMatrix&gt;`) :</span>
<span class="sd">                a symmetric tensor with components</span>
<span class="sd">                (using shorthand :math:`a := \tan\alpha`, and with a particular choice of model parameters)</span>

<span class="sd">                :math:`g^*[1,1] = \dots`</span>

<span class="sd">                :math:`g^*[1,2] = g^*[2,1] = \dots`</span>

<span class="sd">                :math:`g^*[2,2] =  \dots`</span>
<span class="sd">            g_ij_tanalpha_mat   (:class:`sympy.ImmutableDenseMatrix &lt;sympy.matrices.immutable.ImmutableDenseMatrix&gt;`) :</span>
<span class="sd">                a symmetric tensor with components (using shorthand :math:`a := \tan\alpha`)</span>

<span class="sd">                :math:`g[1,1] = \dots`</span>

<span class="sd">                :math:`g[1,2] = g[2,1] = \dots`</span>

<span class="sd">                :math:`g[2,2] = \dots`</span>
<span class="sd">            g_ij_mat   (:class:`sympy.ImmutableDenseMatrix &lt;sympy.matrices.immutable.ImmutableDenseMatrix&gt;`) :</span>
<span class="sd">                a symmetric tensor with components</span>
<span class="sd">                (using shorthand :math:`a := \tan\alpha`, and with a particular choice of model parameters)</span>

<span class="sd">                :math:`g[1,1] =\dots`</span>

<span class="sd">                :math:`g[1,2] = g[2,1] = \dots`</span>

<span class="sd">                :math:`g[2,2] = \dots`</span>
<span class="sd">            g_ij_mat_lambdified   (function) :</span>
<span class="sd">                lambdified version of `g_ij_mat`</span>
<span class="sd">            gstar_ij_mat_lambdified   (function) :</span>
<span class="sd">                lambdified version of `gstar_ij_mat`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gstar_ij_tanbeta_mat</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g_ij_tanbeta_mat</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tanbeta_poly_eqn</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tanbeta_eqn</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gstar_ij_tanalpha_mat</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gstar_ij_mat</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g_ij_tanalpha_mat</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g_ij_mat</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g_ij_mat_lambdified</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gstar_ij_mat_lambdified</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">mu_eta_sub</span> <span class="o">=</span> <span class="p">{</span><span class="n">mu</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu_</span><span class="p">,</span> <span class="n">eta</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta_</span><span class="p">}</span>

        <span class="c1"># if parameters is None: return</span>
        <span class="n">H_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">mu_eta_sub</span><span class="p">)</span>
        <span class="c1"># Assume indexing here ranges in [1,2]</span>
        <span class="n">p_i_lambda</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="p">[</span><span class="n">px</span><span class="p">,</span> <span class="n">pz</span><span class="p">][</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># r_i_lambda = lambda i: [rx, rz][i-1]</span>
        <span class="c1"># rdot_i_lambda = lambda i: [rdotx, rdotz][i-1]</span>
        <span class="n">gstar_ij_lambda</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">:</span> <span class="n">simplify</span><span class="p">(</span>
            <span class="n">Rational</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">diff</span><span class="p">(</span><span class="n">diff</span><span class="p">(</span><span class="n">H_</span><span class="p">,</span><span class="n">p_i_lambda</span><span class="p">(</span><span class="n">i</span><span class="p">)),</span><span class="n">p_i_lambda</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">gstar_ij_mat</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">([[</span><span class="n">gstar_ij_lambda</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">gstar_ij_lambda</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)],</span>
                               <span class="p">[</span><span class="n">gstar_ij_lambda</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">gstar_ij_lambda</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)]])</span>
        <span class="n">gstar_ij_pxpz_mat</span> <span class="o">=</span> <span class="n">gstar_ij_mat</span><span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">varphi_r</span><span class="p">(</span><span class="n">rvec</span><span class="p">):</span><span class="n">varphi</span><span class="p">})</span>
        <span class="n">g_ij_pxpz_mat</span> <span class="o">=</span> <span class="n">gstar_ij_mat</span><span class="o">.</span><span class="n">inv</span><span class="p">()</span><span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">varphi_r</span><span class="p">(</span><span class="n">rvec</span><span class="p">):</span><span class="n">varphi</span><span class="p">})</span>

        <span class="n">cosbeta_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">beta</span><span class="p">),</span> <span class="mi">1</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">tan</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">sinbeta_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">beta</span><span class="p">),</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">tan</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
        <span class="n">sintwobeta_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">beta</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">sin</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gstar_ij_tanbeta_mat</span> <span class="o">=</span> <span class="n">expand_trig</span><span class="p">(</span><span class="n">simplify</span><span class="p">(</span>
            <span class="n">gstar_ij_pxpz_mat</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">px_pz_tanbeta_eqn</span><span class="p">))</span>
        <span class="p">))</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="n">cosbeta_eqn</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g_ij_tanbeta_mat</span> <span class="o">=</span>  <span class="n">expand_trig</span><span class="p">(</span><span class="n">simplify</span><span class="p">(</span>
            <span class="n">g_ij_pxpz_mat</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">px_pz_tanbeta_eqn</span><span class="p">))</span>
        <span class="p">))</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="n">cosbeta_eqn</span><span class="p">))</span>

        <span class="n">tanalpha_beta_eqn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tanalpha_beta_eqn</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">mu_eta_sub</span><span class="p">)</span>
        <span class="n">tanbeta_poly_eqn</span> \
            <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">numer</span><span class="p">(</span><span class="n">tanalpha_beta_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">)</span>
                        <span class="o">-</span><span class="n">tanalpha_beta_eqn</span><span class="o">.</span><span class="n">lhs</span><span class="o">*</span><span class="n">denom</span><span class="p">(</span><span class="n">tanalpha_beta_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span> \
                    <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">tan</span><span class="p">(</span><span class="n">alpha</span><span class="p">):</span><span class="n">ta</span><span class="p">})</span>

        <span class="n">tanbeta_eqn</span>  <span class="o">=</span> <span class="p">(</span><span class="n">Eq</span><span class="p">(</span><span class="n">tan</span><span class="p">(</span><span class="n">beta</span><span class="p">),</span> <span class="n">solve</span><span class="p">(</span><span class="n">tanbeta_poly_eqn</span><span class="p">,</span> <span class="n">tan</span><span class="p">(</span><span class="n">beta</span><span class="p">))[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tanbeta_poly_eqn</span> <span class="o">=</span> <span class="n">tanbeta_poly_eqn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tanbeta_eqn</span> <span class="o">=</span> <span class="n">tanbeta_eqn</span>

        <span class="c1"># Replace all refs to beta with refs to alpha</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gstar_ij_tanalpha_mat</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gstar_ij_tanbeta_mat</span>
                <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="n">sintwobeta_eqn</span><span class="p">))</span>
                <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="n">sinbeta_eqn</span><span class="p">))</span>
                <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="n">cosbeta_eqn</span><span class="p">))</span>
                <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="n">tanbeta_eqn</span><span class="p">))</span>
        <span class="p">)</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">mu_eta_sub</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gstar_ij_mat</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gstar_ij_tanalpha_mat</span>
                <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">ta</span><span class="p">:</span><span class="n">tan</span><span class="p">(</span><span class="n">alpha</span><span class="p">)})</span>
                <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tanalpha_rdot_eqn</span><span class="p">))</span>
                <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">varphi_rx_eqn</span><span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">varphi_r</span><span class="p">(</span><span class="n">rvec</span><span class="p">):</span><span class="n">varphi</span><span class="p">})))</span>
                <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">mu_eta_sub</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g_ij_tanalpha_mat</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">expand_trig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g_ij_tanbeta_mat</span><span class="p">)</span>
                <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="n">sintwobeta_eqn</span><span class="p">))</span>
                <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="n">sinbeta_eqn</span><span class="p">))</span>
                <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="n">cosbeta_eqn</span><span class="p">))</span>
                <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="n">tanbeta_eqn</span><span class="p">))</span>
        <span class="p">)</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">mu_eta_sub</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g_ij_mat</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">g_ij_tanalpha_mat</span>
                <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">ta</span><span class="p">:</span><span class="n">rdotz</span><span class="o">/</span><span class="n">rdotx</span><span class="p">})</span>
                <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">varphi_rx_eqn</span><span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">varphi_r</span><span class="p">(</span><span class="n">rvec</span><span class="p">):</span><span class="n">varphi</span><span class="p">})))</span>
                <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">mu_eta_sub</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g_ij_mat_lambdified</span> \
            <span class="o">=</span> <span class="n">lambdify</span><span class="p">(</span> <span class="p">(</span><span class="n">rx</span><span class="p">,</span><span class="n">rdotx</span><span class="p">,</span><span class="n">rdotz</span><span class="p">,</span> <span class="n">varepsilon</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">g_ij_mat</span><span class="p">,</span> <span class="s1">&#39;numpy&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gstar_ij_mat_lambdified</span> \
            <span class="o">=</span> <span class="n">lambdify</span><span class="p">(</span> <span class="p">(</span><span class="n">rx</span><span class="p">,</span><span class="n">rdotx</span><span class="p">,</span><span class="n">rdotz</span><span class="p">,</span> <span class="n">varepsilon</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">gstar_ij_mat</span><span class="p">,</span> <span class="s1">&#39;numpy&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">define_geodesic_eqns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1">#, parameters=None</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define geodesic equations</span>

<span class="sd">        Args:</span>
<span class="sd">            parameters (dict): dictionary of model parameter values to be used for equation substitutions</span>

<span class="sd">        Attributes:</span>
<span class="sd">            dg_rk_ij_mat   (:class:`sympy.ImmutableDenseMatrix &lt;sympy.matrices.immutable.ImmutableDenseMatrix&gt;`) :</span>
<span class="sd">                Derivatives of the components of the metric tensor:</span>
<span class="sd">                these values are used to construct the Christoffel tensor.</span>
<span class="sd">                Too unwieldy to display here.</span>
<span class="sd">            christoffel_ij_k_rx_rdot_lambda   (function) :</span>
<span class="sd">                The Christoffel tensor coefficients, as a `lambda` function,</span>
<span class="sd">                for each component :math:`r^x`, :math:`{\dot{r}^x}` and :math:`{\dot{r}^z}`.</span>
<span class="sd">            christoffel_ij_k_lambda   (function) :</span>
<span class="sd">                The Christoffel tensor coefficients, as a `lambda` function, in a compact and indexable form.</span>
<span class="sd">            geodesic_eqns (list of :class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                Ray geodesic equations, but expressed indirectly as a pair of coupled 1st-order vector ODEs</span>
<span class="sd">                rather than a 2nd-order vector ODE for ray acceleration.</span>
<span class="sd">                The 1st-order ODE form is easier to solve numerically.</span>

<span class="sd">                :math:`\dot{r}^x = v^{x}`</span>

<span class="sd">                :math:`\dot{r}^z = v^{z}`</span>

<span class="sd">                :math:`\dot{v}^x = \dots`</span>

<span class="sd">                :math:`\dot{v}^z = \dots`</span>
<span class="sd">            vdotx_lambdified   (function) :</span>
<span class="sd">                lambdified version of :math:`\dot{v}^x`</span>
<span class="sd">            vdotz_lambdified   (function) :</span>
<span class="sd">                lambdified version of :math:`\dot{v}^z`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dg_rk_ij_mat</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">christoffel_ij_k_rx_rdot_lambda</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">christoffel_ij_k_lambda</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">geodesic_eqns</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vdotx_lambdified</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vdotz_lambdified</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># if self.eta_&gt;=1 and self.beta_type==&#39;sin&#39;:</span>
        <span class="c1">#     print(r&#39;Cannot compute geodesic equations</span>
        <span class="c1">#               for $\sin\beta$ model and $\eta&gt;=1$&#39;)</span>
        <span class="c1">#     return</span>
        <span class="c1"># eta_sub = {eta: self.eta_}</span>

        <span class="c1"># Manipulate metric tensors</span>
        <span class="n">gstar_ij_lambda</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i_</span><span class="p">,</span><span class="n">j_</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">gstar_ij_mat</span><span class="p">[</span><span class="n">i_</span><span class="p">,</span><span class="n">j_</span><span class="p">]</span>
        <span class="c1"># g_ij_lambda = lambda i_,j_: self.g_ij_mat[i_,j_]</span>
        <span class="n">r_k_mat</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">([</span><span class="n">rx</span><span class="p">,</span> <span class="n">rz</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dg_rk_ij_mat</span> <span class="o">=</span> <span class="p">(</span><span class="n">derive_by_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g_ij_mat</span><span class="p">,</span><span class="n">r_k_mat</span><span class="p">))</span>
        <span class="n">dg_ij_rk_lambda</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i_</span><span class="p">,</span><span class="n">j_</span><span class="p">,</span><span class="n">k_</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dg_rk_ij_mat</span><span class="p">[</span><span class="n">k_</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">i_</span><span class="p">,</span><span class="n">j_</span><span class="p">]</span>

        <span class="c1"># Generate Christoffel &quot;symbols&quot; tensor</span>
        <span class="n">christoffel_ij_k_raw</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i_</span><span class="p">,</span><span class="n">j_</span><span class="p">,</span><span class="n">k_</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="n">Rational</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">gstar_ij_lambda</span><span class="p">(</span><span class="n">k_</span><span class="p">,</span><span class="n">m_</span><span class="p">)</span><span class="o">*</span><span class="p">(</span>
                                          <span class="n">dg_ij_rk_lambda</span><span class="p">(</span><span class="n">m_</span><span class="p">,</span><span class="n">i_</span><span class="p">,</span><span class="n">j_</span><span class="p">)</span>
                                        <span class="o">+</span> <span class="n">dg_ij_rk_lambda</span><span class="p">(</span><span class="n">m_</span><span class="p">,</span><span class="n">j_</span><span class="p">,</span><span class="n">i_</span><span class="p">)</span>
                                        <span class="o">-</span> <span class="n">dg_ij_rk_lambda</span><span class="p">(</span><span class="n">i_</span><span class="p">,</span><span class="n">j_</span><span class="p">,</span><span class="n">m_</span><span class="p">))</span>
                                    <span class="k">for</span> <span class="n">m_</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="p">]</span>
        <span class="c1"># Use of &#39;factor&#39; here messes things up for eta&lt;1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">christoffel_ij_k_rx_rdot_lambda</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i_</span><span class="p">,</span><span class="n">j_</span><span class="p">,</span><span class="n">k_</span><span class="p">:</span> \
            <span class="p">(</span><span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">:</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">,</span> <span class="n">christoffel_ij_k_raw</span><span class="p">(</span><span class="n">i_</span><span class="p">,</span><span class="n">j_</span><span class="p">,</span><span class="n">k_</span><span class="p">)))</span>
        <span class="n">christoffel_ij_k_rx_rdot_list</span> <span class="o">=</span> <span class="p">[[[</span>
            <span class="n">lambdify</span><span class="p">(</span> <span class="p">(</span><span class="n">rx</span><span class="p">,</span> <span class="n">rdotx</span><span class="p">,</span> <span class="n">rdotz</span><span class="p">,</span> <span class="n">varepsilon</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">christoffel_ij_k_rx_rdot_lambda</span><span class="p">(</span><span class="n">i_</span><span class="p">,</span><span class="n">j_</span><span class="p">,</span><span class="n">k_</span><span class="p">)</span> <span class="p">)</span>
                                               <span class="k">for</span> <span class="n">i_</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]]</span>
                                              <span class="k">for</span> <span class="n">j_</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]]</span>
                                             <span class="k">for</span> <span class="n">k_</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">christoffel_ij_k_lambda</span> \
            <span class="o">=</span> <span class="k">lambda</span> <span class="n">i_</span><span class="p">,</span><span class="n">j_</span><span class="p">,</span><span class="n">k_</span><span class="p">,</span> <span class="n">varepsilon_</span><span class="p">:</span> <span class="n">christoffel_ij_k_rx_rdot_list</span><span class="p">[</span><span class="n">i_</span><span class="p">][</span><span class="n">j_</span><span class="p">][</span><span class="n">k_</span><span class="p">]</span>

        <span class="c1"># Obtain geodesic equations as a set of coupled 1st order ODEs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">geodesic_eqns</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">([</span>
            <span class="n">rdotx</span><span class="p">,</span>
            <span class="n">rdotz</span><span class="p">,</span>
            <span class="c1"># Use symmetry to abbreviate sum of diagonal terms</span>
            <span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">christoffel_ij_k_rx_rdot_lambda</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">rdotx</span><span class="o">*</span><span class="n">rdotx</span>
                   <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">christoffel_ij_k_rx_rdot_lambda</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">rdotx</span><span class="o">*</span><span class="n">rdotz</span>
                   <span class="c1">#-christoffel_ij_k_rx_rdot_lambda(1,0,0)*rdotz*rdotx</span>
                   <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">christoffel_ij_k_rx_rdot_lambda</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">rdotz</span><span class="o">*</span><span class="n">rdotz</span><span class="p">)</span> <span class="p">,</span>
            <span class="c1"># Use symmetry to abbreviate sum of diagonal terms</span>
            <span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">christoffel_ij_k_rx_rdot_lambda</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">rdotx</span><span class="o">*</span><span class="n">rdotx</span>
                   <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">christoffel_ij_k_rx_rdot_lambda</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">rdotx</span><span class="o">*</span><span class="n">rdotz</span>
                   <span class="c1">#-christoffel_ij_k_rx_rdot_lambda(1,0,1)*rdotz*rdotx</span>
                   <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">christoffel_ij_k_rx_rdot_lambda</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">rdotz</span><span class="o">*</span><span class="n">rdotz</span><span class="p">)</span>
        <span class="p">])</span>
        <span class="c1"># self.geodesic_eqns = Matrix([</span>
        <span class="c1">#     Eq(rdotx_true, rdotx),</span>
        <span class="c1">#     Eq(rdotz_true, rdotz),</span>
        <span class="c1">#     # Use symmetry to abbreviate sum of diagonal terms</span>
        <span class="c1">#     Eq(vdotx, (-self.christoffel_ij_k_rx_rdot_lambda(0,0,0)*rdotx*rdotx</span>
        <span class="c1">#                -2*self.christoffel_ij_k_rx_rdot_lambda(0,1,0)*rdotx*rdotz</span>
        <span class="c1">#                #-christoffel_ij_k_rx_rdot_lambda(1,0,0)*rdotz*rdotx</span>
        <span class="c1">#                -self.christoffel_ij_k_rx_rdot_lambda(1,1,0)*rdotz*rdotz) ),</span>
        <span class="c1">#     # Use symmetry to abbreviate sum of diagonal terms</span>
        <span class="c1">#     Eq(vdotz, (-self.christoffel_ij_k_rx_rdot_lambda(0,0,1)*rdotx*rdotx</span>
        <span class="c1">#                -2*self.christoffel_ij_k_rx_rdot_lambda(0,1,1)*rdotx*rdotz</span>
        <span class="c1">#                #-christoffel_ij_k_rx_rdot_lambda(1,0,1)*rdotz*rdotx</span>
        <span class="c1">#                -self.christoffel_ij_k_rx_rdot_lambda(1,1,1)*rdotz*rdotz) )</span>
        <span class="c1"># ])</span>
        <span class="c1"># Use of &#39;factor&#39; here messes things up for eta&lt;1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vdotx_lambdified</span> \
            <span class="o">=</span> <span class="n">lambdify</span><span class="p">(</span> <span class="p">(</span><span class="n">rx</span><span class="p">,</span> <span class="n">rdotx</span><span class="p">,</span><span class="n">rdotz</span><span class="p">,</span> <span class="n">varepsilon</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geodesic_eqns</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="s1">&#39;numpy&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vdotz_lambdified</span> \
            <span class="o">=</span> <span class="n">lambdify</span><span class="p">(</span> <span class="p">(</span><span class="n">rx</span><span class="p">,</span> <span class="n">rdotx</span><span class="p">,</span><span class="n">rdotz</span><span class="p">,</span> <span class="n">varepsilon</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geodesic_eqns</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span> <span class="s1">&#39;numpy&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">define_px_poly_eqn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eta_choice</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">do_ndim</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TODO: remove ref to xiv_0</span>

<span class="sd">        Define polynomial form of function combining normal-slowness covector components :math:`(p_x,p_z)`</span>
<span class="sd">        (where the latter is given in terms of the vertical erosion rate :math:`\xi^{\downarrow} = -\dfrac{1}{p_z}`)</span>
<span class="sd">        and the erosion model flow component :math:`\varphi(\mathbf{r})`</span>


<span class="sd">        Args:</span>
<span class="sd">            eta_choice (:class:`sympy.Rational &lt;sympy.core.numbers.Rational&gt;`):</span>
<span class="sd">                value of :math:`\eta` to use instead value given at instantiation; otherwise the latter value is used</span>

<span class="sd">        Attributes:</span>
<span class="sd">            poly_px_xiv_varphi_eqn   (:class:`sympy.Poly &lt;sympy.polys.polytools.Poly&gt;`) :</span>
<span class="sd">                :math:`\operatorname{Poly}{\left( \left(\xi^{\downarrow}\right)^{4} \varphi^{4}{\left(\mathbf{r} \right)} p_{x}^{6}</span>
<span class="sd">                -  \left(\xi^{\downarrow}\right)^{4} p_{x}^{2} -  \left(\xi^{\downarrow}\right)^{2}, p_{x},</span>
<span class="sd">                domain=\mathbb{Z}\left[\varphi{\left(\mathbf{r} \right)}, \xi^{\downarrow}\right] \right)}`</span>
<span class="sd">            poly_px_xiv_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`\varphi_0^{4} \left(\xi^{\downarrow{0}}\right)^{4} p_{x}^{6} \left(\varepsilon</span>
<span class="sd">                + \left(\frac{x_{1} - {r}^x}{x_{1}}\right)^{2 \mu}\right)^{4}</span>
<span class="sd">                - \left(\xi^{\downarrow{0}}\right)^{4} p_{x}^{2}</span>
<span class="sd">                - \left(\xi^{\downarrow{0}}\right)^{2} = 0`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">do_ndim</span><span class="p">:</span>
            <span class="c1"># Non-dimensionalized version</span>
            <span class="n">varphi0_solns</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">sinCi_xih0_eqn</span><span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">eta</span><span class="p">:</span><span class="n">eta_choice</span><span class="p">}),</span> <span class="n">varphi_0</span><span class="p">)</span>
            <span class="n">varphi0_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">varphi_0</span><span class="p">,</span> <span class="n">varphi0_solns</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">eta_choice</span><span class="o">&lt;=</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">tmp_eqn</span> <span class="o">=</span> <span class="n">separatevars</span><span class="p">(</span><span class="n">simplify</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">px_xiv_varphi_eqn</span>
                       <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">eta</span><span class="p">:</span><span class="n">eta_choice</span><span class="p">})</span>
                       <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">varphi_r</span><span class="p">(</span><span class="n">rvec</span><span class="p">):</span><span class="bp">self</span><span class="o">.</span><span class="n">varphi_rxhat_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">})</span>
                       <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">px_pxhat_eqn</span><span class="p">))</span>
                       <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="n">varphi0_eqn</span><span class="p">)))</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">poly_pxhat_xiv_eqn</span> <span class="o">=</span> <span class="n">simplify</span><span class="p">(</span>
                    <span class="n">Eq</span><span class="p">(</span> <span class="p">(</span><span class="n">numer</span><span class="p">(</span><span class="n">tmp_eqn</span><span class="o">.</span><span class="n">lhs</span><span class="p">)</span><span class="o">-</span><span class="n">denom</span><span class="p">(</span><span class="n">tmp_eqn</span><span class="o">.</span><span class="n">lhs</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">tmp_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">))</span><span class="o">/</span><span class="n">xiv</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">poly_pxhat_xiv0_eqn</span> \
                    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">poly_pxhat_xiv_eqn</span>\
                        <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">xiv</span><span class="p">:</span><span class="n">xiv_0</span><span class="p">})</span>\
                        <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xiv0_xih0_Ci_eqn</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tmp_eqn</span> <span class="o">=</span> <span class="n">separatevars</span><span class="p">(</span><span class="n">simplify</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">px_xiv_varphi_eqn</span>
                       <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">eta</span><span class="p">:</span><span class="n">eta_choice</span><span class="p">})</span>
                       <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">varphi_r</span><span class="p">(</span><span class="n">rvec</span><span class="p">):</span><span class="bp">self</span><span class="o">.</span><span class="n">varphi_rxhat_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">})</span>
                       <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">px_pxhat_eqn</span><span class="p">))</span>
                       <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="n">varphi0_eqn</span><span class="p">)))</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">poly_pxhat_xiv_eqn</span> <span class="o">=</span> <span class="n">simplify</span><span class="p">(</span>
                    <span class="n">Eq</span><span class="p">((</span><span class="n">numer</span><span class="p">(</span><span class="n">tmp_eqn</span><span class="o">.</span><span class="n">lhs</span><span class="p">)</span><span class="o">-</span><span class="n">denom</span><span class="p">(</span><span class="n">tmp_eqn</span><span class="o">.</span><span class="n">lhs</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">tmp_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">))</span><span class="o">/</span><span class="n">xiv</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">poly_pxhat_xiv0_eqn</span> <span class="o">=</span> <span class="n">simplify</span><span class="p">(</span>
                    <span class="n">Eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">poly_pxhat_xiv_eqn</span><span class="o">.</span><span class="n">lhs</span>
                        <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">xiv</span><span class="p">:</span><span class="n">xiv_0</span><span class="p">})</span>
                        <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xiv0_xih0_Ci_eqn</span><span class="p">))</span><span class="o">/</span><span class="n">xih_0</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Dimensioned version</span>
            <span class="n">tmp_eqn</span> <span class="o">=</span> <span class="n">simplify</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">px_xiv_varphi_eqn</span><span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">eta</span><span class="p">:</span><span class="n">eta_choice</span><span class="p">}))</span>
            <span class="k">if</span> <span class="n">eta_choice</span><span class="o">&lt;=</span><span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">poly_px_xiv_varphi_eqn</span> <span class="o">=</span> <span class="n">poly</span><span class="p">(</span> <span class="n">tmp_eqn</span><span class="o">.</span><span class="n">lhs</span><span class="p">,</span> <span class="n">px</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">poly_px_xiv_varphi_eqn</span> \
                    <span class="o">=</span> <span class="n">poly</span><span class="p">(</span><span class="n">numer</span><span class="p">(</span><span class="n">tmp_eqn</span><span class="o">.</span><span class="n">lhs</span><span class="p">)</span><span class="o">-</span><span class="n">denom</span><span class="p">(</span><span class="n">tmp_eqn</span><span class="o">.</span><span class="n">lhs</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">tmp_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">),</span> <span class="n">px</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">poly_px_xiv_eqn</span> \
                <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">poly_px_xiv_varphi_eqn</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">varphi_rx_eqn</span><span class="p">)),</span> <span class="mi">0</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">prep_ibc_eqns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define boundary (ray initial) condition equations</span>

<span class="sd">        Attributes:</span>
<span class="sd">            pz0_xiv0_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`p_{z_0} = - \dfrac{1}{\xi^{\downarrow{0}}}`</span>
<span class="sd">            pzpx_unity_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`\varphi^{2} p_{x}^{2} p_{x}^{2 \eta} \left(p_{x}^{2} + p_{z}^{2}\right)^{- \eta} + \varphi^{2} p_{x}^{2 \eta} p_{z}^{2} \left(p_{x}^{2} + p_{z}^{2}\right)^{- \eta} = 1`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pz0_xiv0_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">pz_0</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">xiv_0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pzpx_unity_eqn</span> <span class="o">=</span> <span class="n">expand</span><span class="p">(</span><span class="n">simplify</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rdot_p_unity_eqn</span>
                <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">rdotx</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">rdotx_pxpz_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">,</span> <span class="n">rdotz</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">rdotz_pxpz_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">})</span>
                <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">varphi_r</span><span class="p">(</span><span class="n">rvec</span><span class="p">):</span><span class="n">varphi</span><span class="p">})</span>
        <span class="p">))</span><span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">Abs</span><span class="p">(</span><span class="n">pz</span><span class="p">):</span><span class="o">-</span><span class="n">pz</span><span class="p">})</span>


    <span class="k">def</span> <span class="nf">define_ibc_eqns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define initial profile equations</span>

<span class="sd">        Attributes:</span>
<span class="sd">            boundary_eqns   (`dict` of :class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>

<span class="sd">                &#39;planar&#39;:</span>
<span class="sd">                    &#39;h&#39;: :math:`h = \dfrac{h_{0} x}{x_{1}}`</span>

<span class="sd">                    &#39;gradh&#39;: :math:`\dfrac{d}{d x} h{\left(x \right)} = \dfrac{h_{0}}{x_{1}}`</span>

<span class="sd">                &#39;convex-up&#39;:</span>
<span class="sd">                    &#39;h&#39;: :math:`h = \dfrac{h_{0} \tanh{\left(\dfrac{\kappa_\mathrm{h} x}{x_{1}} \right)}}{\tanh{\left(\dfrac{\kappa_\mathrm{h}}{x_{1}} \right)}}`</span>

<span class="sd">                    &#39;gradh&#39;: :math:`\dfrac{d}{d x} h{\left(x \right)} = \dfrac{\kappa_\mathrm{h} h_{0} \left(1 - \tanh^{2}{\left(\dfrac{\kappa_\mathrm{h} x}{x_{1}} \right)}\right)}{x_{1} \tanh{\left(\dfrac{\kappa_\mathrm{h}}{x_{1}} \right)}}`</span>

<span class="sd">                &#39;concave-up&#39;:</span>
<span class="sd">                    &#39;h&#39;: :math:`h = h_{0} \left(1 + \dfrac{\tanh{\left(\dfrac{\kappa_\mathrm{h} x}{x_{1}} - \kappa_\mathrm{h} \right)}}{\tanh{\left(\dfrac{\kappa_\mathrm{h}}{x_{1}} \right)}}\right)`</span>

<span class="sd">                    &#39;gradh&#39;: :math:`\dfrac{d}{d x} h{\left(x \right)} = \dfrac{\kappa_\mathrm{h} h_{0} \left(1 - \tanh^{2}{\left(\dfrac{\kappa_\mathrm{h} x}{x_{1}} - \kappa_\mathrm{h} \right)}\right)}{x_{1} \tanh{\left(\dfrac{\kappa_\mathrm{h}}{x_{1}} \right)}}`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boundary_eqns</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;planar&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;h&#39;</span><span class="p">:</span> <span class="n">Eq</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="p">(</span><span class="n">h_0</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="n">Lc</span><span class="p">))},</span>
            <span class="s1">&#39;convex-up&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;h&#39;</span><span class="p">:</span> <span class="n">simplify</span><span class="p">(</span><span class="n">Eq</span><span class="p">(</span><span class="n">h</span><span class="p">,</span>
                                    <span class="n">h_0</span><span class="o">*</span><span class="n">tanh</span><span class="p">(</span><span class="n">kappa_h</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="n">Lc</span><span class="p">)</span><span class="o">/</span><span class="n">tanh</span><span class="p">(</span><span class="n">kappa_h</span><span class="o">/</span><span class="n">Lc</span><span class="p">)))},</span>
            <span class="s1">&#39;concave-up&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;h&#39;</span><span class="p">:</span> <span class="n">simplify</span><span class="p">(</span><span class="n">Eq</span><span class="p">(</span><span class="n">h</span><span class="p">,</span>
                                    <span class="n">h_0</span><span class="o">+</span><span class="n">h_0</span><span class="o">*</span><span class="n">tanh</span><span class="p">(</span><span class="o">-</span><span class="n">kappa_h</span><span class="o">*</span><span class="p">(</span><span class="n">Lc</span><span class="o">-</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">Lc</span><span class="p">)</span><span class="o">/</span><span class="n">tanh</span><span class="p">(</span><span class="n">kappa_h</span><span class="o">/</span><span class="n">Lc</span><span class="p">)))}</span>
        <span class="p">}</span>
        <span class="c1"># Math concave-up not geo concave-up, i.e., with minimum</span>
        <span class="c1"># Math convex-up not geo convex-up, i.e., with maximum</span>
        <span class="k">for</span> <span class="n">ibc_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;planar&#39;</span><span class="p">,</span><span class="s1">&#39;convex-up&#39;</span><span class="p">,</span><span class="s1">&#39;concave-up&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">boundary_eqns</span><span class="p">[</span><span class="n">ibc_type</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
                <span class="s1">&#39;gradh&#39;</span><span class="p">:</span> <span class="n">Eq</span><span class="p">(</span><span class="n">diff</span><span class="p">(</span><span class="n">h_fn</span><span class="p">,</span><span class="n">x</span><span class="p">),</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundary_eqns</span><span class="p">[</span><span class="n">ibc_type</span><span class="p">][</span><span class="s1">&#39;h&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rhs</span><span class="p">,</span><span class="n">x</span><span class="p">))</span>
                <span class="p">})</span>


    <span class="k">def</span> <span class="nf">set_ibc_eqns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define initial condition equations</span>

<span class="sd">        Attributes:</span>
<span class="sd">            rz_initial_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`{r}^z = \dfrac{h_{0} \tanh{\left(\frac{\kappa_\mathrm{h} {r}^x}{x_{1}} \right)}}{\tanh{\left(\frac{\kappa_\mathrm{h}}{x_{1}} \right)}}`</span>
<span class="sd">            tanbeta_initial_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`\tan{\left(\beta \right)} = \dfrac{\kappa_\mathrm{h} h_{0} \left(1 - \tanh^{2}{\left(\frac{\kappa_\mathrm{h} x}{x_{1}} \right)}\right)}{x_{1} \tanh{\left(\frac{\kappa_\mathrm{h}}{x_{1}} \right)}}`</span>
<span class="sd">            p_initial_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`p = \dfrac{x_{1}^{2 \mu} \left|{\sin{\left(\beta \right)}}\right|^{- \eta}}{\varphi_0 \left(\varepsilon x_{1}^{2 \mu} + \left(- x + x_{1}\right)^{2 \mu}\right)}`</span>
<span class="sd">            px_initial_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`p_{x} = \dfrac{\kappa_\mathrm{h} h_{0} x_{1}^{2 \mu} \left(\dfrac{1}{\kappa_\mathrm{h} h_{0} \left|{\tanh^{2}{\left(\frac{\kappa_\mathrm{h} x}{x_{1}} \right)} - 1}\right|}\right)^{\eta} \left(\kappa_\mathrm{h}^{2} h_{0}^{2} \left(\tanh^{2}{\left(\frac{\kappa_\mathrm{h} x}{x_{1}} \right)} - 1\right)^{2} + x_{1}^{2} \tanh^{2}{\left(\frac{\kappa_\mathrm{h}}{x_{1}} \right)}\right)^{\frac{\eta}{2} - \frac{1}{2}} \left|{\tanh^{2}{\left(\frac{\kappa_\mathrm{h} x}{x_{1}} \right)} - 1}\right|}{\varphi_0 \left(\varepsilon x_{1}^{2 \mu} + \left(- x + x_{1}\right)^{2 \mu}\right)}`</span>
<span class="sd">            pz_initial_eqn   (:class:`sympy.Eq &lt;sympy.core.relational.Equality&gt;`) :</span>
<span class="sd">                :math:`p_{z} = - \dfrac{x_{1}^{2 \mu + 1} \left(\dfrac{1}{\kappa_\mathrm{h} h_{0} \left|{\tanh^{2}{\left(\frac{\kappa_\mathrm{h} x}{x_{1}} \right)} - 1}\right|}\right)^{\eta} \left(\kappa_\mathrm{h}^{2} h_{0}^{2} \left(\tanh^{2}{\left(\frac{\kappa_\mathrm{h} x}{x_{1}} \right)} - 1\right)^{2} + x_{1}^{2} \tanh^{2}{\left(\frac{\kappa_\mathrm{h}}{x_{1}} \right)}\right)^{\frac{\eta}{2} - \frac{1}{2}} \tanh{\left(\frac{\kappa_\mathrm{h}}{x_{1}} \right)}}{\varphi_0 \left(\varepsilon x_{1}^{2 \mu} + \left(- x + x_{1}\right)^{2 \mu}\right)}`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cosbeta_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">beta</span><span class="p">),</span> <span class="mi">1</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">tan</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">sinbeta_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">beta</span><span class="p">),</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">tan</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
        <span class="c1"># sintwobeta_eqn = Eq(sin(2*beta), cos(beta)**2-sin(beta)**2)</span>

        <span class="n">ibc_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ibc_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rz_initial_eqn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundary_eqns</span><span class="p">[</span><span class="n">ibc_type</span><span class="p">][</span><span class="s1">&#39;h&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">h</span><span class="p">:</span><span class="n">rz</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span><span class="n">rx</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tanbeta_initial_eqn</span> \
            <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">tan</span><span class="p">(</span><span class="n">beta</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundary_eqns</span><span class="p">[</span><span class="n">ibc_type</span><span class="p">][</span><span class="s1">&#39;gradh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rhs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_initial_eqn</span> <span class="o">=</span> <span class="n">simplify</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p_varphi_beta_eqn</span>
                  <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">varphi_rx_eqn</span><span class="p">))</span>
                  <span class="c1"># .subs({varphi_r(rvec):self.varphi_rx_eqn.rhs})</span>
                  <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="bp">self</span><span class="o">.</span><span class="n">tanbeta_initial_eqn</span><span class="o">.</span><span class="n">lhs</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tanbeta_initial_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">})</span>
                  <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">rx</span><span class="p">:</span><span class="n">x</span><span class="p">})</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">px_initial_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">px</span><span class="p">,</span> <span class="n">simplify</span><span class="p">(</span>
            <span class="p">(</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">p_initial_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">beta</span><span class="p">))</span>
            <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="n">sinbeta_eqn</span><span class="p">))</span>
            <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="n">cosbeta_eqn</span><span class="p">))</span>
            <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">tan</span><span class="p">(</span><span class="n">beta</span><span class="p">):</span><span class="bp">self</span><span class="o">.</span><span class="n">tanbeta_initial_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">,</span> <span class="n">rx</span><span class="p">:</span><span class="n">x</span><span class="p">}))</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pz_initial_eqn</span> <span class="o">=</span> <span class="n">Eq</span><span class="p">(</span><span class="n">pz</span><span class="p">,</span> <span class="n">simplify</span><span class="p">(</span>
            <span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">p_initial_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">beta</span><span class="p">))</span>
            <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="n">sinbeta_eqn</span><span class="p">))</span>
            <span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">e2d</span><span class="p">(</span><span class="n">cosbeta_eqn</span><span class="p">))</span>
            <span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="n">tan</span><span class="p">(</span><span class="n">beta</span><span class="p">):</span><span class="bp">self</span><span class="o">.</span><span class="n">tanbeta_initial_eqn</span><span class="o">.</span><span class="n">rhs</span><span class="p">,</span> <span class="n">rx</span><span class="p">:</span><span class="n">x</span><span class="p">}))</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
    <a id="sidebar-anchor"></a>
    

<div id="searchbox" style="display: none" role="search">
    <a class="biglink" href="../../index.html">
        <img src="../../_static/gme_icon_varphi_rx.png" />
    </a>
  <h3></h3>
    <form class="search" action="../../search.html" method="get">
      <div class="ui action left icon input">
        <i class="search icon"></i>
        <input type="text" name="q" placeholder="Search...">
        <div class="ui teal button"></div>
      </div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<!-- <br> -->
<script type="text/javascript">$('#searchbox').show(0);</script><h3><a href="../../index.html">Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Presentations.html">  Presentations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Publications.html">  Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Design.html">  Software design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Dependencies.html">  Dependencies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Installation.html">  Installation and set-up</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Running.html">  Running the notebooks</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../Python.html">  Python package docs</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Core</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ode/index.html">ODE integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plot/index.html">Plotting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../knickpoints/index.html">Knickpoint detection and tracking [in development]</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Notebooks.html">  Notebook docs</a></li>
</ul>

    <!-- <h3><a href="../../index.html">This page</a></h3> -->
    <!-- <ul>
<li><a class="reference internal" href="#"><code class="docutils literal notranslate"><span class="pre">equations.py</span></code></a><ul>
<li><a class="reference internal" href="#code">Code</a></li>
</ul>
</li>
</ul>
 -->
    <p class="biglink">
        <h3><a href="../../genindex.html"> Index</a></h3>
    </p>
  <br>
  <!-- <p class="biglink"><a class="biglink" href="../../py-modindex.html">
         Module index</a>
  <br><br> -->
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="equation_utils.html" title="equation_utils.py"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="symbols.html" title="symbols.py"
             accesskey="P">previous</a> |</li>
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2021, CPS.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.0.3.
    </div>
  </body>
</html>